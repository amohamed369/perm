---
phase: 25-settings-preferences
plan: 01
type: execute
---

<objective>
Set up settings page infrastructure with tabbed navigation and data layer integration.

Purpose: Create the settings page shell with proper navigation structure and connect to existing userProfiles data layer. This establishes the foundation that all subsequent plans build upon.

Output: Working settings page with tab navigation, profile data loading, and one functional section (Profile).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-settings-preferences/25-CONTEXT.md

**Codebase Context:**
@.planning/codebase/STACK.md
@.planning/codebase/CONVENTIONS.md

**Design Reference (MANDATORY):**
@.planning/FRONTEND_DESIGN_SKILL.md

**Existing Implementation:**
@v2/src/app/(authenticated)/settings/page.tsx
@v2/src/components/settings/DeadlineEnforcementToggle.tsx
@v2/convex/users.ts
@v2/convex/schema.ts (lines 66-160 for userProfiles)

**Prior Decisions:**
- DeadlineEnforcementToggle pattern shows how settings components work
- userProfiles table has ALL settings fields pre-defined in schema
- updateUserProfile mutation already works for partial updates
- neobrutalist design: 2px borders, 4px shadows, Forest Green accent

**PERM Source of Truth:**
@perm_flow.md
</context>

## Required Reading (MANDATORY for all implementers)
- `.planning/FRONTEND_DESIGN_SKILL.md`
- `.planning/phases/17-design-system/design*` (all 5 design docs)
- `perm_flow.md`
- `v2/CLAUDE.md`

## Implementation Rules
1. Explore existing code BEFORE creating anything new
2. No clashing, duplicate, or non-integrated implementations
3. DRY, KISS, minimal - use existing patterns
4. Refactor as needed to fit changes
5. Check v1 for feature parity
6. Clean up thoroughly after

## Subagent Instructions
All Task and Explore subagents MUST receive these rules in their prompts.

<tasks>

<task type="auto">
  <name>Task 1: Create settings page layout with tab navigation</name>
  <files>v2/src/app/(authenticated)/settings/page.tsx, v2/src/components/settings/SettingsLayout.tsx</files>
  <exploration>
    Use Explore agent to:
    - Find existing tab/navigation patterns in the codebase (Tabs from shadcn/ui?)
    - Review DeadlineEnforcementToggle.tsx for styling patterns
    - Check how other pages handle loading states
    - Understand the AuthContext pattern (isSigningOut)
  </exploration>
  <action>
    **Create SettingsLayout component:**
    - Left sidebar navigation (on desktop) / top tabs (on mobile)
    - 7 nav items: Profile, Notifications, Quiet Hours, Calendar Sync, Auto-Close, Account, Support
    - Each nav item is a button that scrolls to section OR switches content
    - Use neobrutalist styling (2px border, 4px shadow on active)
    - Icons from lucide-react for each section

    **Refactor settings/page.tsx:**
    - Replace placeholder sections with SettingsLayout
    - Load userProfile via useQuery(api.users.currentUserProfile)
    - Handle loading state with skeleton
    - Handle isSigningOut to skip query
    - Pass profile data down to sections

    **Design pattern (from Linear/Notion):**
    - Clean, minimal sidebar navigation
    - Section content takes majority of width
    - Smooth scroll-to-section behavior
    - Active section highlighted in nav
  </action>
  <verify>
    - Settings page loads without errors
    - Tab navigation visible on desktop
    - Clicking tabs shows different sections (even if placeholder)
    - Loading skeleton shows while profile loads
    - No TypeScript errors: `pnpm tsc --noEmit`
  </verify>
  <done>Settings page has working tabbed navigation with 7 sections, profile data loads, neobrutalist styling applied</done>
</task>

<task type="auto">
  <name>Task 2: Build Profile section component</name>
  <files>v2/src/components/settings/ProfileSection.tsx</files>
  <exploration>
    Use Explore agent to:
    - Find existing form patterns (FormField component?)
    - Check how Input component is styled
    - Look for profile photo patterns (or create initials fallback)
    - Find timezone list/selector patterns
  </exploration>
  <action>
    **Create ProfileSection component:**

    1. **Profile Photo/Initials Display:**
       - If profilePhotoUrl exists (from Google OAuth): display circular photo
       - Else: display initials in circle (first letters of full name)
       - Neobrutalist styling: 2px border, 4px shadow
       - No upload functionality (out of scope per CONTEXT.md)

    2. **Name Field:**
       - Input for fullName (editable)
       - Use FormField wrapper if exists, else create inline
       - Label: "Full Name"

    3. **Email Field (read-only):**
       - Display email from users table (not editable)
       - Show "Signed in with Google" badge if applicable
       - Use disabled input styling

    4. **Timezone Selector:**
       - Dropdown with common US timezones (PERM is US immigration):
         - America/New_York (Eastern)
         - America/Chicago (Central)
         - America/Denver (Mountain)
         - America/Los_Angeles (Pacific)
         - America/Anchorage (Alaska)
         - America/Honolulu (Hawaii)
       - Auto-detect default: `Intl.DateTimeFormat().resolvedOptions().timeZone`
       - Store in userProfile.timezone

    5. **Save handling:**
       - useMutation(api.users.updateUserProfile)
       - Show loading state during save
       - Toast/snackbar on success
       - Only save changed fields (track dirty state)

    **Styling:** Match DeadlineEnforcementToggle card styling (border-2, shadow-hard)
  </action>
  <verify>
    - Profile section renders with photo/initials
    - Name field is editable
    - Email field is read-only
    - Timezone dropdown works
    - Save updates database (check Convex dashboard)
    - No TypeScript errors
  </verify>
  <done>Profile section fully functional with name editing, email display, timezone selection, and save functionality</done>
</task>

<task type="auto">
  <name>Task 3: Add Motion library and snappy transitions</name>
  <files>v2/package.json, v2/src/components/settings/SettingsLayout.tsx, v2/src/components/settings/ProfileSection.tsx</files>
  <exploration>
    Use researcher agent to:
    - Get latest Motion (motion.dev) installation and usage patterns
    - Find examples of snappy 150-200ms transitions
    - Check if Framer Motion is already installed (motion was formerly framer-motion)
  </exploration>
  <action>
    **Install Motion if not present:**
    ```bash
    cd v2 && pnpm add motion
    ```

    **Add transitions to SettingsLayout:**
    - Tab switch animation (fade + slight slide)
    - Section entrance animation (staggered children)
    - 150-200ms duration for snappy feel

    **Add micro-interactions to ProfileSection:**
    - Input focus animation (subtle scale or border glow)
    - Save button press effect (scale down on press)
    - Success feedback animation (checkmark or pulse)

    **Pattern:**
    ```tsx
    import { motion } from "motion/react";

    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.15 }}
    >
      {content}
    </motion.div>
    ```

    **IMPORTANT:** Keep transitions SNAPPY (150-200ms), not slow/floaty
  </action>
  <verify>
    - Motion package installed: `pnpm list motion`
    - Tab switching has smooth transition
    - Save interactions feel responsive
    - No layout shift or jank
    - Animations are snappy (not slow)
  </verify>
  <done>Motion library integrated, snappy 150-200ms transitions on tab switches and micro-interactions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm build` succeeds without errors
- [ ] `pnpm tsc --noEmit` passes
- [ ] Settings page loads at /settings
- [ ] Tab navigation works (7 sections visible)
- [ ] Profile section edits save to database
- [ ] Timezone updates persist
- [ ] Motion animations are snappy
- [ ] Matches neobrutalist design system
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Settings page structure in place
- Profile section fully functional
- Ready for subsequent plans to add remaining sections
</success_criteria>

<output>
After completion, create `.planning/phases/25-settings-preferences/25-01-SUMMARY.md`:

# Phase 25 Plan 01: Settings Infrastructure Summary

**[One-liner describing what shipped]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale]

## Issues Encountered
[Problems and resolutions]

## Next Step
Ready for 25-02-PLAN.md (Notification Preferences sections)
</output>
