---
phase: 22-case-forms
plan: 02
type: execute
domain: forms
---

<objective>
Build first half of form sections: Basic Info, PWD, and Recruitment sections with full validation and auto-calculation.

Purpose: Create the core form sections that handle the first three case stages with all v1 features.
Output: BasicInfoSection, PWDSection, RecruitmentSection components with tests and Storybook stories.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<cascading_requirements>
## CRITICAL: These Requirements Apply to ALL Work in This Plan

### Mandatory Documentation (Must Read Before Any Work)

| Document | Path | Purpose |
|----------|------|---------|
| **perm_flow.md** | `/perm_flow.md` | **SOURCE OF TRUTH** - Case statuses, progress statuses, date validation, deadline logic |
| **FRONTEND_DESIGN_SKILL.md** | `.planning/FRONTEND_DESIGN_SKILL.md` | Design guidance, neobrutalist aesthetic, status colors |
| **Design Inspiration 1-5** | `.planning/phases/17-design-system/design1-5` | Design examples, hard shadows, animations |
| **Phase Context** | `.planning/phases/22-case-forms/22-CONTEXT.md` | Phase requirements |
| **V2 Design System** | `v2/docs/DESIGN_SYSTEM.md` | Component library, utility classes |

### Code Quality Standards (Non-Negotiable)

- **Clean** - No clutter, no dead code
- **Organized** - Logical structure, proper separation of concerns
- **Minimal** - No over-engineering, no unnecessary abstraction
- **Abstractable** - Reusable patterns where appropriate
- **Scalable** - Handles growth without refactoring
- **Maintainable** - Easy to modify and extend
- **Readable** - Self-documenting, clear naming
- **Global fixes** - Fix at the source, never repeat patterns

### TDD Requirements

- Tests BEFORE implementation (red-green-refactor)
- Full coverage of validation logic
- Edge case coverage

### Subagent/Task Tool Requirements

**ALL Task tools and subagents MUST have these instructions explicitly in their prompts:**

```
CRITICAL REQUIREMENTS:
1. Read these docs FIRST: perm_flow.md, .planning/FRONTEND_DESIGN_SKILL.md,
   .planning/phases/17-design-system/design1-5, .planning/phases/22-case-forms/22-CONTEXT.md
2. perm_flow.md is SOURCE OF TRUTH for all case logic
3. V1 feature parity - all features must be preserved
4. Code quality: clean, organized, minimal, abstractable, scalable, maintainable, readable
5. Global fixes only - no repeated patterns
6. Full TDD - tests before implementation
7. UI: animations, transitions, microinteractions per design docs
8. Use Explore and Task subagents for research and complex work
```
</cascading_requirements>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-case-forms/22-CONTEXT.md
@.planning/FRONTEND_DESIGN_SKILL.md
@perm_flow.md

**Prior plan context:**
@.planning/phases/22-case-forms/22-01-SUMMARY.md

**Infrastructure from 22-01:**
@v2/src/lib/forms/case-form-schema.ts
@v2/src/components/forms/FormField.tsx
@v2/src/components/forms/FormSection.tsx
@v2/src/components/forms/DateInput.tsx
@v2/src/components/forms/SelectInput.tsx
@v2/src/hooks/useFormCalculations.ts

**Design system:**
@v2/docs/DESIGN_SYSTEM.md

**V1 Features (from 22-CONTEXT.md):**
- Basic Info: employer_name, position_title, case_number, case_status, progress_status
- PWD: pwd_filing_date, pwd_determination_date, pwd_expiration_date (auto)
- Recruitment: sunday_ad_first/second_date, job_order_start/end, notice_of_filing_start/end
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BasicInfoSection component</name>
  <files>
    v2/src/components/forms/sections/BasicInfoSection.tsx
    v2/src/components/forms/sections/__tests__/BasicInfoSection.test.tsx
    v2/src/components/forms/sections/BasicInfoSection.stories.tsx
    v2/src/components/forms/sections/index.ts
  </files>
  <exploration>
    Use Explore agent to:
    - Study v1 add-case.html for Basic Info field layout
    - Check status dropdown options (perm_flow.md: 5 case statuses, 6 progress statuses)
    - Review FormField, SelectInput from 22-01
    - Look at design docs for form section styling
  </exploration>
  <action>
    Create BasicInfoSection component:

    1. **Fields from v1:**
       - `employerName` - Text input (required, prominently styled)
       - `beneficiaryIdentifier` - Text input (required, placeholder: "Initials or unique ID")
       - `positionTitle` - Text input (required)
       - `caseNumber` - Text input (optional, internal reference)
       - `caseStatus` - Select dropdown with 5 options:
         - PWD (blue indicator)
         - Recruitment (purple indicator)
         - ETA 9089 (orange indicator)
         - I-140 (green indicator)
         - Closed (gray indicator)
       - `progressStatus` - Select dropdown with 6 options:
         - Working
         - Waiting for Intake
         - Filed
         - Approved
         - Under Review
         - RFI/RFE

    2. **Layout:**
       - FormSection wrapper with title "Basic Information"
       - 2-column grid on desktop, single column on mobile
       - Required field indicators (red asterisks)
       - Employer name and position title most prominent

    3. **Validation display:**
       - Use FormField for each input
       - Show errors inline with red border + message
       - Real-time validation on blur

    4. **Status color indicators:**
       - Small color dot next to status dropdown options
       - Match stage status colors from FRONTEND_DESIGN_SKILL.md

    TDD: Write tests FIRST covering:
    - Renders all required fields
    - Shows required indicators
    - Displays validation errors
    - Status dropdowns have correct options
    - onChange callbacks fire correctly
  </action>
  <verify>npm run test -- v2/src/components/forms/sections/__tests__/BasicInfoSection.test.tsx</verify>
  <done>BasicInfoSection renders all fields, validates correctly, matches v1 features</done>
</task>

<task type="auto">
  <name>Task 2: Create PWDSection with auto-calculation</name>
  <files>
    v2/src/components/forms/sections/PWDSection.tsx
    v2/src/components/forms/sections/__tests__/PWDSection.test.tsx
    v2/src/components/forms/sections/PWDSection.stories.tsx
  </files>
  <exploration>
    Use Explore agent to:
    - Study calculatePWDExpiration from perm-engine/calculators/pwd.ts
    - Check perm_flow.md for PWD validation rules
    - Review useFormCalculations hook from 22-01
    - Look at v1 add-case.html PWD section layout
  </exploration>
  <action>
    Create PWDSection component with auto-calculation:

    1. **Fields from v1:**
       - `pwdFilingDate` - Date input (optional)
       - `pwdDeterminationDate` - Date input (optional, must be after filing)
       - `pwdExpirationDate` - Date input (AUTO-CALCULATED, read-only style)
       - `pwdCaseNumber` - Text input (optional)
       - `pwdWageAmount` - Number input (optional)
       - `pwdWageLevel` - Select: Level I, II, III, IV (optional)

    2. **Auto-calculation (from perm_flow.md):**
       - When pwdDeterminationDate changes:
         - If Apr 2 - Jun 30: expiration = determination + 90 days
         - Otherwise: expiration = next Jun 30
       - Show pulse animation when expiration auto-fills
       - Read-only styling for auto-calculated field

    3. **Validation (from perm_flow.md):**
       - pwdFilingDate cannot be in future
       - pwdDeterminationDate must be after pwdFilingDate
       - pwdDeterminationDate cannot be in future
       - Show contextual hints (e.g., "Determination date triggers expiration calculation")

    4. **Layout:**
       - FormSection with title "PWD (Prevailing Wage Determination)"
       - PWD status color indicator (blue)
       - Dates in first row, wage info in second row
       - Clear visual indicator that expiration is auto-calculated

    TDD: Write tests FIRST covering:
    - Expiration auto-calculates from determination
    - Apr-Jun dates get +90 days
    - Other dates get next Jun 30
    - Validation errors for future dates
    - Validation errors for determination before filing
    - Auto-calculated field shows pulse indicator
  </action>
  <verify>npm run test -- v2/src/components/forms/sections/__tests__/PWDSection.test.tsx</verify>
  <done>PWDSection auto-calculates expiration, validates per perm_flow.md, tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Create RecruitmentSection with Sunday validation</name>
  <files>
    v2/src/components/forms/sections/RecruitmentSection.tsx
    v2/src/components/forms/sections/__tests__/RecruitmentSection.test.tsx
    v2/src/components/forms/sections/RecruitmentSection.stories.tsx
  </files>
  <exploration>
    Use Explore agent to:
    - Study perm_flow.md recruitment validation rules in detail
    - Check calculateNoticeOfFilingEnd, calculateJobOrderEnd from calculators
    - Review v1 add-case.html recruitment section fields
    - Look at US states list for job order state dropdown
  </exploration>
  <action>
    Create RecruitmentSection with comprehensive validation:

    1. **Fields from v1:**
       - `sundayAdFirstDate` - Date input (must be Sunday)
       - `sundayAdSecondDate` - Date input (must be Sunday, after first)
       - `sundayAdNewspaper` - Text input (optional)
       - `jobOrderStartDate` - Date input
       - `jobOrderEndDate` - Date input (AUTO-SUGGEST +30 days, extendable)
       - `jobOrderState` - Select (all 50 states + DC)
       - `noticeOfFilingStartDate` - Date input
       - `noticeOfFilingEndDate` - Date input (AUTO-CALCULATE +10 business days)
       - `recruitmentApplicantsCount` - Number input (default 0)

    2. **Auto-calculation:**
       - noticeOfFilingEndDate = start + 10 business days (calculateNoticeOfFilingEnd)
       - jobOrderEndDate suggestion = start + 30 days (can extend, not shorten)
       - Show pulse animation on auto-calculated fields

    3. **Validation (from perm_flow.md):**
       - Sunday ads MUST be on Sundays (isSunday check)
       - Second Sunday ad MUST be after first
       - Second Sunday ad at least 1 week after first
       - Job order duration >= 30 days
       - Notice of filing >= 10 business days
       - All recruitment dates must be after PWD determination

    4. **Layout:**
       - FormSection with title "Recruitment"
       - Purple status indicator
       - Sunday Ads subsection
       - Job Order subsection
       - Notice of Filing subsection
       - Recruitment Results subsection (applicants count)

    5. **UX enhancements:**
       - "Must be Sunday" hint under Sunday ad fields
       - Calendar icon that highlights Sundays
       - Duration display (e.g., "32 days" next to job order)

    TDD: Write tests FIRST covering:
    - Sunday validation catches non-Sundays
    - Second Sunday must be after first
    - Job order end auto-suggests +30 days
    - Job order duration validation (>= 30 days)
    - Notice of filing end calculates correctly
    - Business day calculation excludes weekends/holidays
    - All states render in dropdown
  </action>
  <verify>npm run test -- v2/src/components/forms/sections/__tests__/RecruitmentSection.test.tsx</verify>
  <done>RecruitmentSection validates per perm_flow.md, auto-calculates dates, tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test -- v2/src/components/forms/sections/` passes all tests
- [ ] `npm run build` succeeds without errors
- [ ] No TypeScript errors
- [ ] All v1 features from Basic Info, PWD, Recruitment sections present
- [ ] Auto-calculations match perm_flow.md rules exactly
- [ ] Sunday validation works correctly
- [ ] Business day calculation excludes weekends and federal holidays
- [ ] Storybook stories render correctly: `npm run storybook`
</verification>

<success_criteria>
- All tests pass (expect 25+ new tests)
- Three form sections complete with all v1 fields
- Auto-calculation uses perm-engine calculators (no duplicate logic)
- Validation matches perm_flow.md exactly
- UI matches neobrutalist design system
- Components are reusable and well-organized
</success_criteria>

<output>
After completion, create `.planning/phases/22-case-forms/22-02-SUMMARY.md`:

# Phase 22-02: Form Sections Part 1 Summary

**[Substantive one-liner]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale]

## Issues Encountered
[Problems and resolutions]

## Next Step
Ready for 22-03-PLAN.md (Form Sections Part 2)
</output>
