---
phase: 22-case-forms
plan: 05
type: execute
domain: forms
---

<objective>
Polish form with Professional Occupation toggle, remove mock data, and verify empty states work correctly.

Purpose: Complete Phase 22 with all v1 features, clean database state, and verified empty state UX.
Output: Professional occupation with additional methods, mock data removed, empty states polished.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<cascading_requirements>
## CRITICAL: These Requirements Apply to ALL Work in This Plan

### Mandatory Documentation (Must Read Before Any Work)

| Document | Path | Purpose |
|----------|------|---------|
| **perm_flow.md** | `/perm_flow.md` | **SOURCE OF TRUTH** - Case statuses, progress statuses, date validation, deadline logic |
| **FRONTEND_DESIGN_SKILL.md** | `.planning/FRONTEND_DESIGN_SKILL.md` | Design guidance, neobrutalist aesthetic, status colors |
| **Design Inspiration 1-5** | `.planning/phases/17-design-system/design1-5` | Design examples, hard shadows, animations |
| **Phase Context** | `.planning/phases/22-case-forms/22-CONTEXT.md` | Phase requirements |
| **V2 Design System** | `v2/docs/DESIGN_SYSTEM.md` | Component library, utility classes |

### Code Quality Standards (Non-Negotiable)

- **Clean** - No clutter, no dead code
- **Organized** - Logical structure, proper separation of concerns
- **Minimal** - No over-engineering, no unnecessary abstraction
- **Abstractable** - Reusable patterns where appropriate
- **Scalable** - Handles growth without refactoring
- **Maintainable** - Easy to modify and extend
- **Readable** - Self-documenting, clear naming
- **Global fixes** - Fix at the source, never repeat patterns

### TDD Requirements

- Tests BEFORE implementation (red-green-refactor)
- Full coverage of validation logic
- Edge case coverage

### Subagent/Task Tool Requirements

**ALL Task tools and subagents MUST have these instructions explicitly in their prompts:**

```
CRITICAL REQUIREMENTS:
1. Read these docs FIRST: perm_flow.md, .planning/FRONTEND_DESIGN_SKILL.md,
   .planning/phases/17-design-system/design1-5, .planning/phases/22-case-forms/22-CONTEXT.md
2. perm_flow.md is SOURCE OF TRUTH for all case logic
3. V1 feature parity - all features must be preserved
4. Code quality: clean, organized, minimal, abstractable, scalable, maintainable, readable
5. Global fixes only - no repeated patterns
6. Full TDD - tests before implementation
7. UI: animations, transitions, microinteractions per design docs
8. Use Explore and Task subagents for research and complex work
```
</cascading_requirements>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-case-forms/22-CONTEXT.md
@.planning/FRONTEND_DESIGN_SKILL.md
@perm_flow.md

**Prior plan context:**
@.planning/phases/22-case-forms/22-01-SUMMARY.md
@.planning/phases/22-case-forms/22-02-SUMMARY.md
@.planning/phases/22-case-forms/22-03-SUMMARY.md
@.planning/phases/22-case-forms/22-04-SUMMARY.md

**Current form sections:**
@v2/src/components/forms/sections/RecruitmentSection.tsx

**Seed data to remove:**
@v2/convex/seed.ts

**Empty state components:**
@v2/src/app/(authenticated)/dashboard/page.tsx
@v2/src/app/(authenticated)/cases/page.tsx

**V1 Features (from 22-CONTEXT.md):**
- isProfessionalOccupation toggle
- 3 additional recruitment methods (required when professional)
- 11 method types with different configurations
- Dynamic add/remove with animations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Professional Occupation toggle with additional recruitment methods</name>
  <files>
    v2/src/components/forms/sections/AdditionalRecruitmentSection.tsx
    v2/src/components/forms/sections/__tests__/AdditionalRecruitmentSection.test.tsx
    v2/src/components/forms/sections/AdditionalRecruitmentSection.stories.tsx
    v2/src/components/forms/sections/RecruitmentSection.tsx (modify)
  </files>
  <exploration>
    Use Explore agent to:
    - Study perm_flow.md for Professional Occupation rules
    - Check v1 add-case.html for additional recruitment method types
    - Review Convex schema additionalRecruitmentMethods array structure
    - Look at Framer Motion patterns for section reveal animation
  </exploration>
  <action>
    Create Professional Occupation toggle with 3 additional methods:

    1. **isProfessionalOccupation toggle (in RecruitmentSection):**
       - Checkbox with label "Professional Occupation"
       - Tooltip: "Check if position requires Bachelor's degree or higher"
       - When checked, reveal AdditionalRecruitmentSection with animation
       - When unchecked, hide section (with fade-out)

    2. **AdditionalRecruitmentSection component:**
       - Title: "Additional Recruitment Methods (3 Required)"
       - Three method entry slots (all required for professional)
       - Each method has:
         - `method` - Select from 11 types (see below)
         - `date` - Date input
         - `description` - Text input (for certain method types)

    3. **11 Method Types (from perm_flow.md/v1):**
       - Job fair
       - Employer's website
       - Job search website
       - On-campus recruiting
       - Trade or professional organization
       - Private employment firm
       - Employee referral program
       - Campus placement office
       - Local/ethnic newspaper
       - Radio/TV ad
       - Other (requires description)

    4. **Validation rules:**
       - Each method must be different (no duplicates)
       - Once selected, method disappears from other dropdowns
       - All 3 required when isProfessionalOccupation is true
       - Can save without all 3, but show warning
       - Date required for each method

    5. **Animation:**
       - Framer Motion slide-in when section reveals
       - Smooth height animation
       - Each method slot can animate independently

    6. **Professional tag indicator:**
       - When isProfessionalOccupation is true, show "Professional" badge
       - Black/white grayscale badge style (from FRONTEND_DESIGN_SKILL.md)

    TDD: Write tests FIRST covering:
    - Toggle reveals/hides section
    - All 11 method types available
    - Duplicate methods prevented
    - Selected method removed from other dropdowns
    - Warning shown if <3 methods
    - Date required for each method
  </action>
  <verify>npm run test -- v2/src/components/forms/sections/__tests__/AdditionalRecruitmentSection.test.tsx</verify>
  <done>Professional occupation toggle works, additional methods validated correctly</done>
</task>

<task type="auto">
  <name>Task 2: Remove mock data and update empty state components</name>
  <files>
    v2/convex/seed.ts (modify or delete)
    v2/src/app/(authenticated)/dashboard/page.tsx (modify)
    v2/src/app/(authenticated)/cases/page.tsx (modify)
    v2/src/components/empty-states/NoCasesYet.tsx
    v2/src/components/empty-states/__tests__/NoCasesYet.test.tsx
    v2/src/components/empty-states/index.ts
  </files>
  <exploration>
    Use Explore agent to:
    - Study existing seed.ts to understand what to remove
    - Check dashboard and cases pages for empty state handling
    - Look at empty state patterns from design docs
    - Review "Add Case" CTA button styling
  </exploration>
  <action>
    Remove mock data and polish empty states:

    1. **Remove/disable seed data (v2/convex/seed.ts):**
       - Delete seed mutations OR
       - Keep for test-utils but disable production seeding
       - Ensure no auto-seeding on app load
       - Database should have 0 cases for new users

    2. **Create NoCasesYet empty state component:**
       - Friendly illustration (use existing or simple SVG)
       - Title: "No Cases Yet"
       - Subtitle: "Add your first PERM case to get started"
       - Primary CTA: "Add Your First Case" → /cases/new
       - Neobrutalist styling (hard shadow, Forest Green button)

    3. **Update Dashboard empty state:**
       - When 0 cases:
         - Summary tiles show 0 with muted styling
         - Deadline widget shows "No upcoming deadlines"
         - Recent activity shows "No recent activity"
         - Prominent "Add Your First Case" CTA
       - Helpful guidance text for new users

    4. **Update Cases page empty state:**
       - When 0 cases (after filters applied = 0):
         - Show NoCasesYet component
         - "Add Case" button prominent
       - When filters result in 0 (but cases exist):
         - "No cases match your filters"
         - "Clear filters" link

    5. **Ensure smooth onboarding:**
       - New user flow: Dashboard (empty) → Add Case → Case List (1 case) → Dashboard (populated)
       - No broken layouts with 0 data

    TDD: Write tests FIRST covering:
    - Dashboard renders correctly with 0 cases
    - Cases page shows NoCasesYet with 0 cases
    - CTA button navigates to /cases/new
    - Filter empty state shows "clear filters"
  </action>
  <verify>npm run test -- v2/src/components/empty-states/__tests__/NoCasesYet.test.tsx</verify>
  <done>Mock data removed, empty states work perfectly, onboarding smooth</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete case form with all v1 features:
    - Add Case page (/cases/new)
    - Edit Case page (/cases/:id/edit)
    - All form sections (Basic Info, PWD, Recruitment, ETA 9089, I-140, RFI/RFE)
    - Auto-calculation cascade (PWD expiration, notice of filing end, etc.)
    - Professional occupation with 3 additional recruitment methods
    - Filing window and deadline indicators
    - Duplicate detection
    - Empty states for dashboard and cases list
  </what-built>
  <how-to-verify>
    **Full Flow Test:**

    1. **Start dev server:**
       ```bash
       cd v2 && npm run dev
       ```

    2. **Test Empty States (fresh start):**
       - Visit http://localhost:3000/dashboard
       - Confirm: Summary tiles show 0, "Add Your First Case" CTA visible
       - Visit http://localhost:3000/cases
       - Confirm: "No Cases Yet" empty state with CTA

    3. **Test Add Case:**
       - Click "Add Your First Case"
       - Confirm: Form renders with all sections
       - Fill in required fields: Employer, Beneficiary, Position
       - Check "Professional Occupation" - confirm 3 method slots appear
       - Add PWD determination date - confirm expiration auto-calculates
       - Add recruitment dates - confirm Sunday validation, auto-calculations
       - Click Save - confirm success toast and redirect

    4. **Test Edit Case:**
       - From case detail, click Edit
       - Confirm: Form pre-populates with existing data
       - Change a field
       - Cancel - confirm dirty form warning
       - Save changes - confirm updates persist

    5. **Test Validation:**
       - Try to set Sunday ad on a weekday - confirm error
       - Try to set second Sunday before first - confirm error
       - Leave required field empty - confirm error blocks save

    6. **Visual Check:**
       - Neobrutalist styling: hard shadows, black borders
       - Auto-calculated fields pulse when updated
       - Animations smooth (section reveals, error shakes)
       - Status color indicators correct
       - Responsive layout on mobile

  </how-to-verify>
  <resume-signal>Type "approved" if everything works, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test` passes all tests in v2
- [ ] `npm run build` succeeds without errors
- [ ] No TypeScript errors
- [ ] Professional occupation with 3 methods works
- [ ] Mock data removed from database
- [ ] Empty states render correctly
- [ ] Human verification checkpoint passed
- [ ] All v1 features present (per 22-CONTEXT.md checklist)
</verification>

<success_criteria>
- All tests pass
- Human verification approved
- Complete v1 feature parity for case forms
- Empty states work for new users
- No mock data in production database
- Code is clean, organized, minimal
- Phase 22 fully complete
</success_criteria>

<output>
After completion, create `.planning/phases/22-case-forms/22-05-SUMMARY.md`:

# Phase 22-05: Polish + Cleanup Summary

**[Substantive one-liner]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale]

## Issues Encountered
[Problems and resolutions]

## Phase 22 Complete

All case form functionality implemented:
- Add/Edit pages
- All form sections with validation
- Auto-calculation cascade
- Professional occupation with additional methods
- Filing window/deadline indicators
- Empty states for new users

## Next Step
Phase 22 complete. Ready for Phase 23 (Case Detail + Timeline).
</output>
