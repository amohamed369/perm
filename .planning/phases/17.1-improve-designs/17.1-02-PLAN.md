---
phase: 17.1-improve-designs
plan: 02
type: execute
domain: frontend-design
---

<objective>
Add new design system components: Skeleton loading, Divider, and dark card variant. Plus the signature stage progression hover effect.

Purpose: Complete the design polish with new primitives and the signature interaction from design4.
Output: Skeleton component, Divider component, CardDark variant, and StageProgression component with hover animation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/FRONTEND_DESIGN_SKILL.md
@.planning/phases/17.1-improve-designs/17.1-CONTEXT.md
@.planning/phases/17.1-improve-designs/17.1-01-SUMMARY.md

**MANDATORY FOR ALL SUBAGENTS:**
Every subagent executing tasks in this plan MUST read the following before implementation:

1. **frontend-design skill (its a plug-in):** @.planning/FRONTEND_DESIGN_SKILL.md
2. **All design references:**
   - @.planning/phases/17-design-system/design1 (Tectonic UI - slab shadows, mesh backgrounds)
   - @.planning/phases/17-design-system/design2 (Modular Assembly - grain overlay, skeleton shimmer)
   - @.planning/phases/17-design-system/design3 (Brainstorming - skeleton states, animations)
   - @.planning/phases/17-design-system/design4 (PERM Progression - stage tags, hover effects) **PRIMARY**
   - @.planning/phases/17-design-system/design5 (PERM Tracker Core - hazard stripes, glass panels)

**CSS patterns from design4:**
```css
/* Skeleton shimmer animation */
.skeleton-pulse {
  background: linear-gradient(90deg, #eeeeee 25%, #dddddd 50%, #eeeeee 75%);
  background-size: 200% 100%;
  animation: skeleton-move 1.5s infinite;
}
@keyframes skeleton-move {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Stage hover effect - expanding underline */
.w-0.group-hover\:w-full { transition-all duration-500 }
```

**Existing component files:**
@v2/src/components/ui/card.tsx

**Prior decisions:**
- Phase 17 used shadcn/ui as the component foundation
- Storybook set up for component documentation
- All components use CVA (class-variance-authority) for variants
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Skeleton component</name>
  <files>v2/src/components/ui/skeleton.tsx, v2/src/app/globals.css</files>
  <action>
    1. First, add skeleton animation keyframes to globals.css in @layer utilities:
    ```css
    @keyframes skeleton-shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .animate-skeleton {
      background: linear-gradient(90deg, #eeeeee 25%, #dddddd 50%, #eeeeee 75%);
      background-size: 200% 100%;
      animation: skeleton-shimmer 1.5s infinite;
    }

    .dark .animate-skeleton {
      background: linear-gradient(90deg, #333333 25%, #444444 50%, #333333 75%);
    }
    ```

    2. Create v2/src/components/ui/skeleton.tsx:
    ```tsx
    import { cn } from "@/lib/utils"

    interface SkeletonProps extends React.HTMLAttributes<HTMLDivElement> {
      variant?: "line" | "block" | "circle"
    }

    function Skeleton({ className, variant = "block", ...props }: SkeletonProps) {
      return (
        <div
          data-slot="skeleton"
          className={cn(
            "animate-skeleton",
            variant === "line" && "h-4 w-full rounded-full",
            variant === "block" && "h-12 w-full rounded-sm",
            variant === "circle" && "h-10 w-10 rounded-full",
            className
          )}
          {...props}
        />
      )
    }

    export { Skeleton }
    ```

    Use Tailwind classes that exist (rounded-sm, rounded-full, h-4, h-10, h-12, w-full, w-10).
  </action>
  <verify>Test import: npx tsx -e "import { Skeleton } from './v2/src/components/ui/skeleton'" (or check file exists)</verify>
  <done>Skeleton component exists with three variants (line, block, circle) and shimmer animation</done>
</task>

<task type="auto">
  <name>Task 2: Create Divider component + CardDark variant</name>
  <files>v2/src/components/ui/divider.tsx, v2/src/components/ui/card.tsx</files>
  <action>
    1. Create v2/src/components/ui/divider.tsx:
    ```tsx
    import { cn } from "@/lib/utils"

    interface DividerProps extends React.HTMLAttributes<HTMLHRElement> {
      variant?: "default" | "thick"
    }

    function Divider({ className, variant = "default", ...props }: DividerProps) {
      return (
        <hr
          data-slot="divider"
          className={cn(
            "border-border w-full",
            variant === "default" && "border-t-2",
            variant === "thick" && "border-t-4",
            className
          )}
          {...props}
        />
      )
    }

    export { Divider }
    ```

    2. Add CardDark variant to card.tsx:
    Create a new function CardDark that provides the dark card styling from design4/design5:
    ```tsx
    function CardDark({ className, ...props }: React.ComponentProps<"div">) {
      return (
        <div
          data-slot="card-dark"
          className={cn(
            "bg-black text-white flex flex-col gap-6 border-2 border-black py-6 shadow-hard",
            className
          )}
          {...props}
        />
      )
    }
    ```

    Add CardDark to the exports at the bottom of card.tsx.
  </action>
  <verify>grep "CardDark" v2/src/components/ui/card.tsx && ls v2/src/components/ui/divider.tsx</verify>
  <done>Divider component created, CardDark variant added to card.tsx</done>
</task>

<task type="auto">
  <name>Task 3: Create StageProgression component with hover effect</name>
  <files>v2/src/components/status/stage-progression.tsx</files>
  <action>
    Create the signature stage progression component from design4 with the expanding underline hover effect:

    ```tsx
    import { cn } from "@/lib/utils"
    import type { CaseStatus } from "@/lib/perm-engine"

    // Stage colors matching design4
    const stageColors: Record<CaseStatus, string> = {
      pwd: "#0066FF",
      recruitment: "#9333ea",
      eta9089: "#D97706",
      i140: "#059669",
      closed: "#6B7280",
    }

    const stageLabels: Record<CaseStatus, { label: string; number: string }> = {
      pwd: { label: "PWD Phase", number: "01" },
      recruitment: { label: "Recruitment", number: "02" },
      eta9089: { label: "ETA 9089", number: "03" },
      i140: { label: "I-140 Phase", number: "04" },
      closed: { label: "Closed", number: "05" },
    }

    interface StageProgressionItemProps {
      stage: CaseStatus
      progressLabel?: string // e.g., "FILED", "ACTIVE", "PREP"
      className?: string
    }

    export function StageProgressionItem({
      stage,
      progressLabel = "ACTIVE",
      className
    }: StageProgressionItemProps) {
      const color = stageColors[stage]
      const { label, number } = stageLabels[stage]

      return (
        <div className={cn("group cursor-pointer", className)}>
          {/* Stage tag */}
          <div
            className="inline-block px-2.5 py-1 text-[10px] font-extrabold uppercase border-[1.5px] border-black shadow-hard-sm mb-2 text-white"
            style={{ backgroundColor: color }}
          >
            {label}
          </div>

          {/* Number + Progress label */}
          <div
            className="text-2xl font-bold mono transition-colors"
            style={{
              // On hover, text color changes to stage color
            }}
          >
            <span className="group-hover:text-[var(--hover-color)]" style={{ '--hover-color': color } as React.CSSProperties}>
              {number}. {progressLabel}
            </span>
          </div>

          {/* Expanding underline */}
          <div
            className="w-0 group-hover:w-full h-1 transition-all duration-500 mt-1"
            style={{ backgroundColor: color }}
          />
        </div>
      )
    }

    interface StageProgressionProps {
      stages: Array<{ stage: CaseStatus; progressLabel: string }>
      className?: string
    }

    export function StageProgression({ stages, className }: StageProgressionProps) {
      return (
        <div className={cn("flex flex-wrap gap-8", className)}>
          {stages.map((item) => (
            <StageProgressionItem
              key={item.stage}
              stage={item.stage}
              progressLabel={item.progressLabel}
            />
          ))}
        </div>
      )
    }
    ```

    Key features:
    - Uses the `.mono` class from Plan 01 for monospace numbers
    - Expanding underline: w-0 â†’ w-full on group hover with 500ms transition
    - Text color changes to stage color on hover
    - Tag has shadow-hard-sm for 3D pop
  </action>
  <verify>ls v2/src/components/status/stage-progression.tsx && grep "group-hover:w-full" v2/src/components/status/stage-progression.tsx</verify>
  <done>StageProgression component created with signature hover effect from design4</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Design system polish complete:
    - Badge 3D shadows (from Plan 01)
    - Grain overlay applied globally (from Plan 01)
    - .mono typography utility (from Plan 01)
    - Skeleton loading component with shimmer animation
    - Divider component
    - CardDark variant
    - StageProgression component with expanding underline hover effect
  </what-built>
  <how-to-verify>
    1. Start Storybook: `cd v2 && npm run storybook`
    2. Visit http://localhost:6006

    **Check Badge stories:**
    - All badges should have subtle 3D shadow (2px offset)

    **Check new components:**
    - Look for Skeleton component stories (if added)
    - Check CardDark in Card stories

    **Check grain overlay:**
    - The entire Storybook UI should have a subtle noise texture overlay

    **Check StageProgression (may need to add story or test locally):**
    - Create a test page or check component directly
    - Hover over stage items - underline should expand from w-0 to w-full
    - Text should change to stage color on hover

    **Visual comparison:**
    - Compare to `.planning/phases/17-design-system/design4`
    - Badges should match the "stage-tag" styling
    - Stage progression should match "The PERM Progression" section
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 17.1, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` in v2/ succeeds without errors
- [ ] `npm run storybook` builds successfully
- [ ] Skeleton component exists with shimmer animation
- [ ] Divider component exists
- [ ] CardDark variant added to card.tsx exports
- [ ] StageProgression component has expanding underline hover effect
- [ ] Human verification approved
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- No TypeScript errors
- Design polish matches design4 reference
- Phase 17.1 complete
</success_criteria>

<output>
After completion, create `.planning/phases/17.1-improve-designs/17.1-02-SUMMARY.md`:

# Phase 17.1 Plan 02: New Components + Stage Progression Summary

**[One-liner describing what shipped]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Phase 17.1 complete, ready for Phase 18 (Auth)
</output>
