---
phase: 04-backend-services-cleanup
plan: 03
type: execute
---

<objective>
Audit and clean remaining service files for consistency with Phase 2-3 patterns.

Purpose: Ensure all service files follow established logging and code patterns.
Output: All 16 remaining service files audited and cleaned where needed.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-backend-services-cleanup/04-01-SUMMARY.md
@.planning/phases/04-backend-services-cleanup/04-02-SUMMARY.md

**Files to audit (16 remaining services):**
- notification_service.py (866 lines)
- case_service.py (957 lines)
- context_compaction.py (487 lines)
- recruitment_service.py (445 lines)
- web_search_service.py (430 lines)
- rfi_rfe_service.py (406 lines)
- scheduler_service.py (394 lines)
- conversation_service.py (377 lines)
- prompts.py (349 lines)
- summarization_service.py (299 lines)
- permission_state_service.py (310 lines)
- refresh_token_service.py (270 lines)
- email_template_service.py (146 lines)
- resend_service.py (100 lines)
- preferences_service.py (88 lines)
- smart_query_service.py (lines TBD)

**Patterns to check:**
- No emoji in log statements
- No print() statements
- logger = logging.getLogger(__name__) pattern
- No dead/unused code
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit all remaining services for issues</name>
  <files>backend/app/services/*.py</files>
  <exploration>
    Use Explore agent to scan all 16 service files for:
    - Emoji in log statements
    - print() statements
    - Missing or inconsistent logger setup
    - Dead code patterns
  </exploration>
  <action>
    Run systematic checks across all service files:
    ```bash
    # Check for emoji
    grep -rE "[ğŸ¯ğŸ”‘âœ…âŒğŸ—ï¸ğŸ“‹ğŸš€ğŸ’¥ğŸ”§âš ï¸ğŸ“…ğŸ—“ï¸]" backend/app/services/

    # Check for print statements
    grep -rn "print(" backend/app/services/ --include="*.py"

    # Check for logger setup
    grep -rn "logger = logging.getLogger" backend/app/services/
    ```

    Document findings for each file that needs cleanup.
  </action>
  <verify>Audit findings documented</verify>
  <done>Complete list of issues across all service files</done>
</task>

<task type="auto">
  <name>Task 2: Fix identified issues across service files</name>
  <files>backend/app/services/*.py</files>
  <action>
    Based on audit findings, fix issues in each file:
    1. Remove emoji from log statements
    2. Convert print() to logger calls
    3. Add logger = logging.getLogger(__name__) where missing
    4. Remove any dead code identified

    Prioritize by file size (larger files first):
    - notification_service.py
    - case_service.py
    - context_compaction.py
    - recruitment_service.py
    - Then smaller files

    Do NOT change function behavior or API contracts.
  </action>
  <verify>
    - grep for emoji returns empty across all services
    - grep for print( returns empty (or only in prompts/strings)
    - All files have consistent logger setup
  </verify>
  <done>All service files cleaned and consistent</done>
</task>

<task type="auto">
  <name>Task 3: Final verification and test run</name>
  <files>backend/app/services/*.py</files>
  <action>
    1. Run full test suite: pytest backend/tests/ -v
    2. Verify no regressions
    3. Document any patterns worth noting for future phases
    4. Update __init__.py if needed to reflect any changes
  </action>
  <verify>pytest backend/tests/ -v passes (227 tests expected)</verify>
  <done>All services clean, tested, Phase 4 complete</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 18 service files follow Phase 2-3 patterns
- [ ] No emoji in any service log statements
- [ ] No print() statements (except in prompts)
- [ ] All files have logger = logging.getLogger(__name__)
- [ ] All 227 tests pass
</verification>

<success_criteria>
- All service files audited and cleaned
- Consistent logging patterns across all services
- All tests pass
- Phase 4: Backend Services Cleanup complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-backend-services-cleanup/04-03-SUMMARY.md`
</output>
