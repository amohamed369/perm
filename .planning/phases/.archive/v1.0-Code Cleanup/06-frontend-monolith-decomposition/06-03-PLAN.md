---
phase: 06-frontend-monolith-decomposition
plan: 03
type: execute
---

<objective>
Extract confirmation and UI component classes into separate modules.

Purpose: Continue modularizing chatbot-v2.js by extracting ConfirmationModal, InChatConfirmationCard, and UI component classes.
Output: Two new modules (chatbot-confirmation.js, chatbot-components.js) with chatbot-v2.js importing them.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-frontend-monolith-decomposition/06-02-SUMMARY.md

**Remaining chatbot-v2.js structure after 06-02 (estimated ~2,300 lines):**
- ConfirmationModal (~145 lines) - Permission confirmation overlay
- InChatConfirmationCard (~423 lines) - Inline confirmation in chat
- StructuredResultCard (~127 lines) - Rich tool result display
- QuickActions (~114 lines) - Contextual action buttons
- PersonalizedGreeting (~132 lines) - Welcome message
- StopGenerationButton (~62 lines) - Cancel request button
- ChatbotUI (~1,237 lines) - Main UI class
- Initialization (~38 lines)

**Grouping strategy:**
- chatbot-confirmation.js: ConfirmationModal + InChatConfirmationCard (~570 lines) - both handle confirmation UI
- chatbot-components.js: StructuredResultCard + QuickActions + PersonalizedGreeting + StopGenerationButton (~435 lines) - all are UI sub-components
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create chatbot-confirmation.js module</name>
  <files>frontend/public/js/chatbot-confirmation.js</files>
  <action>
    Create new file frontend/public/js/chatbot-confirmation.js containing:

    1. IIFE wrapper
    2. ConfirmationModal class:
       - constructor()
       - show({ title, description, arguments }) - returns Promise<boolean>
       - createModal() - builds modal DOM
       - hide() - removes modal
       - handleConfirm() / handleCancel()
    3. InChatConfirmationCard class:
       - constructor()
       - render(container, { toolName, title, description, arguments }) - returns Promise<Object>
       - createCard() - builds card DOM
       - All button handlers
    4. Export to window:
       ```javascript
       window.ConfirmationModal = ConfirmationModal;
       window.InChatConfirmationCard = InChatConfirmationCard;
       ```

    Remove all console.log statements.
    Keep CSS-in-JS styles inline in this module (they're part of the confirmation UI).
  </action>
  <verify>
    - File exists: ls frontend/public/js/chatbot-confirmation.js
    - No console statements: grep -c "console\." frontend/public/js/chatbot-confirmation.js returns 0
    - Exports defined: grep "window.ConfirmationModal\|window.InChatConfirmationCard" frontend/public/js/chatbot-confirmation.js
  </verify>
  <done>chatbot-confirmation.js module created with both confirmation classes, no console.log statements</done>
</task>

<task type="auto">
  <name>Task 2: Create chatbot-components.js module</name>
  <files>frontend/public/js/chatbot-components.js</files>
  <action>
    Create new file frontend/public/js/chatbot-components.js containing:

    1. IIFE wrapper
    2. StructuredResultCard class:
       - render(container, toolResult) method
       - Format handlers for different result types
    3. QuickActions class:
       - render(container, actions) method
       - Action button handlers
    4. PersonalizedGreeting class:
       - render(container) method
       - Greeting content generation
    5. StopGenerationButton class:
       - constructor()
       - show() / hide() methods
       - Abort handling
    6. Export to window:
       ```javascript
       window.ChatbotComponents = {
         StructuredResultCard,
         QuickActions,
         PersonalizedGreeting,
         StopGenerationButton,
       };
       ```

    Remove all console.log statements.
  </action>
  <verify>
    - File exists: ls frontend/public/js/chatbot-components.js
    - No console statements: grep -c "console\." frontend/public/js/chatbot-components.js returns 0
    - Export defined: grep "window.ChatbotComponents" frontend/public/js/chatbot-components.js
  </verify>
  <done>chatbot-components.js module created with 4 component classes, no console.log statements</done>
</task>

<task type="auto">
  <name>Task 3: Update chatbot-v2.js to use extracted modules</name>
  <files>frontend/public/js/chatbot-v2.js</files>
  <action>
    Modify chatbot-v2.js:

    1. Remove all extracted class definitions:
       - ConfirmationModal class
       - InChatConfirmationCard class
       - StructuredResultCard class
       - QuickActions class
       - PersonalizedGreeting class
       - StopGenerationButton class

    2. Update dependency comment at top:
       ```javascript
       /**
        * Dependencies (must be loaded before this file):
        * - chatbot-utils.js (window.ChatbotUtils)
        * - chatbot-history.js (window.ChatHistoryManager)
        * - chatbot-sidebar.js (window.ChatHistorySidebar)
        * - chatbot-api.js (window.ChatbotAPI, window.ChatbotConfig)
        * - chatbot-actions.js (window.ClientActionExecutor)
        * - chatbot-confirmation.js (window.ConfirmationModal, window.InChatConfirmationCard)
        * - chatbot-components.js (window.ChatbotComponents)
        */
       ```

    3. Update code to use window.* imports:
       - Replace `new ConfirmationModal()` with `new window.ConfirmationModal()`
       - Replace `new InChatConfirmationCard()` with `new window.InChatConfirmationCard()`
       - Replace `new StructuredResultCard()` with `new window.ChatbotComponents.StructuredResultCard()`
       - Replace `new QuickActions()` with `new window.ChatbotComponents.QuickActions()`
       - Replace `new PersonalizedGreeting()` with `new window.ChatbotComponents.PersonalizedGreeting()`
       - Replace `new StopGenerationButton()` with `new window.ChatbotComponents.StopGenerationButton()`

    This should reduce chatbot-v2.js by ~1,000 lines (down to ~1,300 lines).
  </action>
  <verify>
    - Extracted classes not in file: grep "class ConfirmationModal\|class InChatConfirmationCard\|class StructuredResultCard" frontend/public/js/chatbot-v2.js returns nothing
    - Uses window imports: grep "window.ConfirmationModal\|window.ChatbotComponents" frontend/public/js/chatbot-v2.js
    - File is smaller: wc -l frontend/public/js/chatbot-v2.js shows ~1300 lines
  </verify>
  <done>chatbot-v2.js uses extracted confirmation and component modules, reduced to ~1,300 lines</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] chatbot-confirmation.js exists (~570 lines)
- [ ] chatbot-components.js exists (~435 lines)
- [ ] Both new files have 0 console.log statements
- [ ] chatbot-v2.js no longer contains extracted classes
- [ ] chatbot-v2.js is now ~1,300 lines (down from ~2,300 after 06-02)
- [ ] Total console.log removed from chatbot modules: calculate and report
</verification>

<success_criteria>
- Two new modules created: chatbot-confirmation.js (~570 lines), chatbot-components.js (~435 lines)
- chatbot-v2.js reduced from ~2,300 to ~1,300 lines
- All console.log statements removed from extracted modules
- Module architecture is taking shape
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-monolith-decomposition/06-03-SUMMARY.md`:

# Phase 6 Plan 03: Confirmation and Components Module Extraction Summary

**Extracted confirmation UI and component classes into dedicated modules, reducing chatbot-v2.js by ~1,000 lines.**

## Accomplishments
- Created chatbot-confirmation.js (~570 lines) with ConfirmationModal + InChatConfirmationCard
- Created chatbot-components.js (~435 lines) with 4 component classes
- Removed all console.log statements from extracted modules
- Updated chatbot-v2.js to use window.* imports

## Files Created/Modified
- `frontend/public/js/chatbot-confirmation.js` - NEW
- `frontend/public/js/chatbot-components.js` - NEW
- `frontend/public/js/chatbot-v2.js` - Removed extracted code

## Decisions Made
- Grouped ConfirmationModal + InChatConfirmationCard (both handle confirmation)
- Grouped result/action/greeting/stop components under ChatbotComponents namespace

## Issues Encountered
None

## Next Step
Ready for 06-04-PLAN.md: Finalize UI module, update HTML imports, verify
</output>
