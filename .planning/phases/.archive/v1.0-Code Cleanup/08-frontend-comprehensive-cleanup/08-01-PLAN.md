---
phase: 08-frontend-comprehensive-cleanup
plan: 01
type: execute
---

<objective>
Consolidate duplicate utilities and convert high-volume console logging files to use logger utility.

Purpose: Eliminate duplicate code patterns and standardize logging across the frontend.
Output: Consolidated utilities (toast, sanitize), ~55 console statements converted to logger.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-frontend-security/07-02-SUMMARY.md

**Current state (verified counts):**
- 95 console statements total across 17 files in src/ and public/
- Chatbot modules (public/js/) already clean (0 statements)
- Service worker (sw.js) has 8 - keep for lifecycle debugging

**Highest-volume files (this plan targets):**
- settings.js: 15 statements
- calendarSync.js: 11 statements
- tokenRefresh.js: 11 statements
- googleAuth.js: 10 statements
- notifications.js (component): 8 statements

**Duplicate utilities to consolidate:**
1. showToast() - defined in both recruitment.js and utils/ui/toast.js
2. sanitizeText() - defined in dateValidation.js, loaders.js, chatbot-api.js

**Available utilities:**
@frontend/src/js/utils/logger.js - Conditional logger (dev-only, [PERM] prefix)
@frontend/src/js/utils/sanitize.js - Centralized Sanitizer (window.Sanitizer)
@frontend/src/js/utils/ui/toast.js - Canonical toast implementation
</context>

<tasks>

<task type="auto">
  <name>Task 1: Consolidate duplicate showToast utility</name>
  <files>frontend/src/js/api/recruitment.js, frontend/src/js/utils/ui/toast.js</files>
  <action>
    1. Remove the showToast function definition from recruitment.js (lines 80-109)
    2. Add import for showToast from utils/ui/toast.js at top of recruitment.js
    3. The canonical implementation in toast.js has a `duration` parameter which recruitment.js version lacks - this is fine, duration has a default value

    NOTE: Do NOT modify chatbot-api.js's sanitizeText() - it's intentionally local per Phase 7 decision (defense-in-depth without hard dependency on global Sanitizer).
  </action>
  <verify>
    - grep -n "function showToast" frontend/src/js/api/recruitment.js should return nothing
    - grep "import.*showToast" frontend/src/js/api/recruitment.js should show the import
    - npm run build passes
  </verify>
  <done>showToast consolidated to single implementation in toast.js</done>
</task>

<task type="auto">
  <name>Task 2: Consolidate duplicate sanitizeText in src/ files</name>
  <files>frontend/src/js/utils/form/dateValidation.js, frontend/src/js/utils/ui/loaders.js</files>
  <action>
    1. In dateValidation.js: The local sanitizeText (lines 16-25) is only used once in formatDateForDisplay(). Replace with:
       - Use window.Sanitizer.text() if available (check exists)
       - Fallback to simple text escape if not

    2. In loaders.js: The local sanitizeText (lines 11-19) is used in updateMainLoader and updateRecruitmentLoader. Replace with:
       - Use window.Sanitizer.text() if available
       - Fallback pattern (same as above)

    Pattern to use (matches existing defensive patterns):
    ```javascript
    const safeText = (str) => window.Sanitizer?.text?.(str) ??
      String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[m]);
    ```

    NOTE: Keep chatbot-api.js's sanitizeText() as-is (Phase 7 decision).
  </action>
  <verify>
    - grep -n "function sanitizeText" frontend/src/js/utils/form/dateValidation.js should return nothing
    - grep -n "function sanitizeText" frontend/src/js/utils/ui/loaders.js should return nothing
    - npm run build passes
  </verify>
  <done>sanitizeText consolidated to use Sanitizer utility with fallback</done>
</task>

<task type="auto">
  <name>Task 3: Convert settings.js to use logger utility (15 statements)</name>
  <files>frontend/src/js/pages/settings.js</files>
  <exploration>
    Use Explore agent to understand which console statements in settings.js are error handling vs informational logging.
  </exploration>
  <action>
    1. Add import: `import { logger } from '../utils/logger.js';`
    2. Convert all console.error → logger.error
    3. Convert all console.log/warn → logger.log/warn
    4. For truly critical errors (network failures, auth issues), use logger.force.error

    Categories:
    - API errors: Use logger.error (will show in dev)
    - Status updates: Use logger.log (will show in dev)
    - Critical auth failures: Use logger.force.error (always show)
  </action>
  <verify>
    - grep "console\." frontend/src/js/pages/settings.js | wc -l should return 0
    - grep "logger\." frontend/src/js/pages/settings.js | wc -l should be > 0
    - npm run build passes
  </verify>
  <done>settings.js uses logger utility instead of console (15 → 0)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] No duplicate showToast functions: `grep -r "function showToast" frontend/src | wc -l` = 1
- [ ] Only chatbot-api.js has local sanitizeText: `grep -rn "function sanitizeText" frontend/` shows only chatbot-api.js
- [ ] settings.js has no console statements
- [ ] Total console count reduced by ~15 (from 95 to ~80)
</verification>

<success_criteria>
- Duplicate utilities consolidated
- settings.js converted to logger
- No TypeScript/build errors
- Ready for next plan
</success_criteria>

<output>
After completion, create `.planning/phases/08-frontend-comprehensive-cleanup/08-01-SUMMARY.md`
</output>
