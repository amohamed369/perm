---
phase: 05-backend-tools-cleanup
plan: 01
type: execute
---

<objective>
Remove deprecated exports, delete dead code files, and centralize placeholder detection.

Purpose: Clean up M6 (deprecated exports) and L6 (placeholder detection) concerns, reducing tool surface area and eliminating confusion.
Output: Clean __init__.py with only active tools, deprecated tool classes removed, centralized placeholder detection utility.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior phase context:**
Phase 4 completed - all backend services now follow logging patterns

**Current state from exploration:**
- 9 deprecated tools exported in `implementations/__init__.py` (lines 126-135)
- Deprecated classes still exist in:
  - `data_query.py`: SmartQueryTool, QueryCasesTool, GetCaseTool, SearchCasesTool
  - `unified_query.py`: UnifiedQueryTool (entire file)
  - `notifications.py`: DeleteNotificationTool, ClearAllNotificationsTool, MarkAllNotificationsReadTool
  - `navigation.py`: ToggleDarkModeTool
- Placeholder detection hardcoded only in DeleteCaseTool (case_management.py:93-100)

**Files to modify:**
@backend/app/services/tools/implementations/__init__.py
@backend/app/services/tools/implementations/data_query.py
@backend/app/services/tools/implementations/unified_query.py
@backend/app/services/tools/implementations/notifications.py
@backend/app/services/tools/implementations/navigation.py
@backend/app/services/tools/implementations/case_management.py
@backend/app/services/tools/base.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean up __init__.py exports</name>
  <files>backend/app/services/tools/implementations/__init__.py</files>
  <action>
1. Remove deprecated imports (lines 16-17, 19-24, 25-27, 41-45)
2. Remove deprecated entries from __all__ (lines 126-135)
3. Keep only active tools in imports and __all__
4. Update comments to reflect final clean state

Active tools to keep:
- NavigateTool, ScrollToTool, ViewCaseTool (from navigation)
- GetPageContextTool (from data_query)
- CaseDataTool (from case_data)
- CreateCaseTool, DeleteCaseTool, UpdateCaseTool, UpdateCaseStatusTool, ArchiveCaseTool, ReopenCaseTool (from case_management, create_case)
- UnifiedNotificationsTool (from unified_notifications)
- UnifiedSettingsTool (from unified_settings)
- SyncCalendarTool (from google_calendar_sync)
- FillFieldTool, FillDateTool, SelectOptionTool, SubmitFormTool (from forms)
  </action>
  <verify>python -c "from app.services.tools.implementations import ALL_TOOLS; print(f'{len(ALL_TOOLS)} active tools')" returns 17 tools</verify>
  <done>Only active tools exported, no deprecated tools in __all__</done>
</task>

<task type="auto">
  <name>Task 2: Remove deprecated tool classes from data_query.py</name>
  <files>backend/app/services/tools/implementations/data_query.py</files>
  <action>
Remove these deprecated classes and keep only GetPageContextTool:
- SmartQueryTool (lines ~125-241)
- QueryCasesTool (lines ~242-410)
- GetCaseTool (lines ~411-525)
- SearchCasesTool (lines ~526-end)

GetPageContextTool (lines ~24-123) is still active and needed.

Also remove any imports only used by deprecated classes.
  </action>
  <verify>grep -c "class.*Tool" backend/app/services/tools/implementations/data_query.py returns 1 (only GetPageContextTool)</verify>
  <done>data_query.py contains only GetPageContextTool, ~500 lines removed</done>
</task>

<task type="auto">
  <name>Task 3: Delete unified_query.py entirely</name>
  <files>backend/app/services/tools/implementations/unified_query.py</files>
  <action>
Delete the entire file - UnifiedQueryTool is deprecated and replaced by CaseDataTool.
File is 492 lines of dead code.
  </action>
  <verify>test ! -f backend/app/services/tools/implementations/unified_query.py</verify>
  <done>unified_query.py deleted</done>
</task>

<task type="auto">
  <name>Task 4: Remove deprecated classes from notifications.py</name>
  <files>backend/app/services/tools/implementations/notifications.py</files>
  <action>
Remove ALL classes from this file - they are all deprecated:
- DeleteNotificationTool (lines ~24-121)
- ClearAllNotificationsTool (lines ~122-194)
- MarkAllNotificationsReadTool (lines ~195-end)

These are replaced by UnifiedNotificationsTool in unified_notifications.py.

Delete the entire file since it only contains deprecated code.
  </action>
  <verify>test ! -f backend/app/services/tools/implementations/notifications.py</verify>
  <done>notifications.py deleted, ~261 lines of dead code removed</done>
</task>

<task type="auto">
  <name>Task 5: Remove ToggleDarkModeTool from navigation.py</name>
  <files>backend/app/services/tools/implementations/navigation.py</files>
  <action>
Remove ToggleDarkModeTool class (lines ~244-end) - deprecated and replaced by UnifiedSettingsTool.

Keep: NavigateTool, ScrollToTool, ViewCaseTool (all active)
  </action>
  <verify>grep -c "class.*Tool" backend/app/services/tools/implementations/navigation.py returns 3</verify>
  <done>navigation.py contains only 3 active tools</done>
</task>

<task type="auto">
  <name>Task 6: Centralize placeholder detection in base.py</name>
  <files>backend/app/services/tools/base.py, backend/app/services/tools/implementations/case_management.py</files>
  <action>
1. In base.py, add a utility function or method to BaseTool:

```python
# Add near top of file or as method in BaseTool
PLACEHOLDER_NAMES = frozenset([
    "current_case", "this", "this case", "current", "the case",
    "the current case", "selected case", "active case"
])

def is_placeholder_name(name: str | None) -> bool:
    """Check if a name is a placeholder that should be resolved from context."""
    if not name:
        return False
    return name.lower().strip() in PLACEHOLDER_NAMES
```

2. In case_management.py DeleteCaseTool, replace hardcoded list (lines 93-100) with:
```python
from app.services.tools.base import is_placeholder_name

# Replace the hardcoded check with:
if is_placeholder_name(case_name):
    logger.info(f"DeleteCaseTool: Detected placeholder case_name '{case_name}', checking page context")
    ...
```

3. Check UpdateCaseTool and other case tools for similar placeholder logic - add if missing.
  </action>
  <verify>grep -r "is_placeholder_name" backend/app/services/tools/ shows usage in case_management.py</verify>
  <done>Placeholder detection centralized in base.py, used in case management tools</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -c "from app.services.tools.implementations import ALL_TOOLS; print(len(ALL_TOOLS))"` returns 17
- [ ] `cd backend && python -m pytest tests/ -q` - all tests pass
- [ ] No import errors: `python -c "from app.services.tools import tool_registry"`
- [ ] Deprecated files deleted: unified_query.py, notifications.py
</verification>

<success_criteria>
- All deprecated exports removed from __init__.py
- ~1,200 lines of dead code removed (4 deprecated classes in data_query, unified_query.py, notifications.py, ToggleDarkModeTool)
- Placeholder detection centralized in base.py
- All 227 tests still pass
- No import errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-backend-tools-cleanup/05-01-SUMMARY.md`
</output>
