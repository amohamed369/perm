---
phase: 05-backend-tools-cleanup
plan: 03
type: execute
---

<objective>
Fix Any types in tool implementation files using the TypedDicts defined in 05-02.

Purpose: Complete M1 (type safety gaps) cleanup across all tool implementations.
Output: Type-safe tool implementations with proper return types and context usage.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior plan context:**
- 05-01-PLAN: Deprecated exports removed, dead code deleted
- 05-02-PLAN: TypedDicts defined in base.py (ToolResult, ToolExecutionContext, PageContext)

**Current state from exploration (after 05-01):**
Files to update (remaining after dead code removal):
- implementations/navigation.py: 8 Any usages
- implementations/case_management.py: 10 Any usages
- implementations/case_data.py: 10 Any usages
- implementations/create_case.py: 2 Any usages
- implementations/unified_notifications.py: 2 Any usages
- implementations/unified_settings.py: 2 Any usages
- implementations/forms.py: 8 Any usages
- implementations/google_calendar_sync.py: 4 Any usages
- providers.py: 10 Any usages (adapter patterns)

**Files to modify:**
@backend/app/services/tools/implementations/navigation.py
@backend/app/services/tools/implementations/case_management.py
@backend/app/services/tools/implementations/case_data.py
@backend/app/services/tools/implementations/create_case.py
@backend/app/services/tools/implementations/unified_notifications.py
@backend/app/services/tools/implementations/unified_settings.py
@backend/app/services/tools/implementations/forms.py
@backend/app/services/tools/implementations/google_calendar_sync.py
@backend/app/services/tools/providers.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update navigation tools with proper types</name>
  <files>backend/app/services/tools/implementations/navigation.py</files>
  <action>
1. Import types: `from app.services.tools.base import ToolResult, ToolExecutionContext`

2. Update execute() methods in NavigateTool, ScrollToTool, ViewCaseTool to:
   - Use `context: ToolExecutionContext` parameter type
   - Return `ToolResult` type

3. For return statements, ensure they match ToolResult structure:
```python
return ToolResult(
    success=True,
    data={...},
    client_action={...}
)
# Or use dict literal that matches ToolResult
return {"success": True, "data": {...}, "client_action": {...}}
```

4. Remove unused Any imports if no longer needed.
  </action>
  <verify>python -c "from app.services.tools.implementations.navigation import NavigateTool; print('OK')"</verify>
  <done>Navigation tools use typed signatures</done>
</task>

<task type="auto">
  <name>Task 2: Update case management tools with proper types</name>
  <files>backend/app/services/tools/implementations/case_management.py, backend/app/services/tools/implementations/create_case.py</files>
  <action>
1. Import types: `from app.services.tools.base import ToolResult, ToolExecutionContext`

2. Update execute() methods in all case tools:
   - DeleteCaseTool, UpdateCaseTool, UpdateCaseStatusTool, ArchiveCaseTool, ReopenCaseTool
   - CreateCaseTool in create_case.py

3. Ensure return types match ToolResult structure.

4. For internal helper methods that return case data, use `dict[str, Any]` where appropriate (case data is flexible).

5. Remove unused Any imports.
  </action>
  <verify>python -c "from app.services.tools.implementations.case_management import DeleteCaseTool; print('OK')"</verify>
  <done>Case management tools use typed signatures</done>
</task>

<task type="auto">
  <name>Task 3: Update data tools and remaining implementations</name>
  <files>backend/app/services/tools/implementations/case_data.py, backend/app/services/tools/implementations/data_query.py, backend/app/services/tools/implementations/unified_notifications.py, backend/app/services/tools/implementations/unified_settings.py, backend/app/services/tools/implementations/forms.py, backend/app/services/tools/implementations/google_calendar_sync.py</files>
  <action>
1. Import types in each file: `from app.services.tools.base import ToolResult, ToolExecutionContext`

2. Update execute() methods in:
   - CaseDataTool (case_data.py)
   - GetPageContextTool (data_query.py)
   - UnifiedNotificationsTool (unified_notifications.py)
   - UnifiedSettingsTool (unified_settings.py)
   - FillFieldTool, FillDateTool, SelectOptionTool, SubmitFormTool (forms.py)
   - SyncCalendarTool (google_calendar_sync.py)

3. For query results and case data, `list[dict[str, Any]]` is appropriate - database results are flexible.

4. Remove unused Any imports where possible.
  </action>
  <verify>python -c "from app.services.tools.implementations.case_data import CaseDataTool; print('OK')"</verify>
  <done>All tool implementations use typed signatures</done>
</task>

<task type="auto">
  <name>Task 4: Update providers.py adapter types</name>
  <files>backend/app/services/tools/providers.py</files>
  <action>
1. Import types: `from app.services.tools.base import ToolResult, ToolExecutionContext`

2. Update adapter methods that interact with tool execution.

3. For provider-specific schemas (OpenAI, Gemini, Cerebras formats), keep `dict[str, Any]` - these match external API schemas that we don't control.

4. Focus on internal methods that handle ToolResult.
  </action>
  <verify>python -c "from app.services.tools.providers import get_provider_adapter; print('OK')"</verify>
  <done>Providers use typed tool infrastructure</done>
</task>

<task type="auto">
  <name>Task 5: Final verification and cleanup</name>
  <files>backend/app/services/tools/</files>
  <action>
1. Run all tests: `cd backend && python -m pytest tests/ -v`

2. Verify imports work:
```bash
python -c "from app.services.tools import tool_registry; from app.services.tools.orchestrator_v2 import ToolOrchestrator; print('All imports OK')"
```

3. Count remaining Any usages:
```bash
grep -r ": Any\b" backend/app/services/tools/ | wc -l
```

Expected: Significant reduction, remaining Any usages should be for:
- Database client types (external)
- LLM response types (external API schemas)
- Truly dynamic data (case fields, query results)

4. Document any remaining Any usages that are intentional in comments.
  </action>
  <verify>cd backend && python -m pytest tests/ -q && echo "All tests pass"</verify>
  <done>All tool files typed, tests pass, remaining Any usages documented</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All tool files import and use types from base.py
- [ ] `cd backend && python -m pytest tests/ -q` - all tests pass
- [ ] No import errors when loading tools
- [ ] Any type count reduced by ~60-70% (from 103 to ~30-40 for external types)
</verification>

<success_criteria>
- All tool implementations use ToolResult, ToolExecutionContext types
- execute() method signatures are typed across all tools
- Remaining Any usages are intentional (external APIs, database, dynamic data)
- All 227 tests pass
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-backend-tools-cleanup/05-03-SUMMARY.md`

# Phase 5 Plan 3: Tool Implementation Types Summary

**[Summary of type cleanup across implementations]**

## Accomplishments
- [List of files updated]
- [Type reduction metrics]

## Files Created/Modified
- All implementation files

## Decisions Made
- [Any type decisions]

## Issues Encountered
- [Any issues]

## Next Step
Phase 5 complete. Ready for Phase 6: Frontend Monolith Decomposition
</output>
