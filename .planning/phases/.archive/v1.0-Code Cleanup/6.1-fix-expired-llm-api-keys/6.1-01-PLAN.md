---
phase: 6.1-fix-expired-llm-api-keys
plan: 01
type: execute
---

<objective>
Regenerate valid LLM API keys and verify the complete modular chatbot architecture works end-to-end.

Purpose: Fix expired API keys blocking chatbot functionality, then complete the verification deferred from Phase 6.
Output: Working chatbot with valid API keys, verified modular architecture.
</objective>

<context>
@.planning/STATE.md
@.planning/phases/06-frontend-monolith-decomposition/06-04-SUMMARY.md

**Background:**
- Phase 6 completed the modular chatbot architecture (8 focused files)
- All LLM API keys (Gemini, Groq, OpenRouter, Cerebras, Mistral) are expired/invalid
- Chatbot returns 503 because no LLM provider can authenticate
- Verification from 06-04 was deferred to this phase

**API Key Consoles:**
- Gemini: https://aistudio.google.com/app/apikey
- Groq: https://console.groq.com/keys
- OpenRouter: https://openrouter.ai/keys
- Cerebras: https://cloud.cerebras.ai/
- Mistral: https://console.mistral.ai/api-keys
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Regenerate LLM API keys from provider consoles</action>
  <instructions>
    You need to regenerate at least ONE working API key (preferably all 5 for redundancy).

    1. **Gemini** (recommended - free tier):
       - Go to https://aistudio.google.com/app/apikey
       - Create new API key
       - Copy the key

    2. **Groq** (fast, free tier):
       - Go to https://console.groq.com/keys
       - Create new API key
       - Copy the key

    3. **OpenRouter** (optional - paid):
       - Go to https://openrouter.ai/keys
       - Create new API key

    4. **Cerebras** (optional):
       - Go to https://cloud.cerebras.ai/
       - Create new API key

    5. **Mistral** (optional):
       - Go to https://console.mistral.ai/api-keys
       - Create new API key

    After getting keys, provide them and I'll update .env.test
  </instructions>
  <verification>User provides at least one valid API key</verification>
  <resume-signal>Paste the API keys you generated (I'll update .env.test)</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Update .env.test with new API keys</name>
  <files>backend/.env.test</files>
  <action>
    Update the LLM API keys in backend/.env.test with the keys provided by user.
    Only update keys that were provided (leave others empty if not regenerated).
  </action>
  <verify>
    - grep for the new keys in .env.test
    - Keys are not empty strings
  </verify>
  <done>API keys updated in .env.test</done>
</task>

<task type="auto">
  <name>Task 3: Restart backend and verify LLM providers load</name>
  <files>None</files>
  <action>
    1. Restart the backend server
    2. Check logs for "✅ LLM providers available: ..."
    3. Verify at least one provider is listed
  </action>
  <verify>Backend logs show at least one LLM provider available</verify>
  <done>Backend running with valid LLM provider(s)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete modular chatbot architecture with working LLM backend</what-built>
  <how-to-verify>
    **CARRIED FORWARD FROM PHASE 6 (06-04):**

    1. Open http://localhost:3000/dashboard
    2. Click the chatbot bubble icon in bottom-right
    3. Verify:
       - Chat window opens without JavaScript errors
       - Type "hi" and press Send
       - **Get an actual response** (not 503 error)
       - Chat history sidebar opens/closes properly
       - No errors in browser console (F12 → Console)
    4. Test on another page (e.g., /cases):
       - Navigate to http://localhost:3000/cases
       - Open chatbot
       - Verify it still works

    **This completes the deferred verification from Phase 6.**
  </how-to-verify>
  <resume-signal>Type "approved" if chatbot works end-to-end, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] At least one LLM API key regenerated and added to .env.test
- [ ] Backend shows "✅ LLM providers available: ..." (at least one)
- [ ] Chatbot opens without JS errors
- [ ] Chatbot sends message and receives response (not 503)
- [ ] Chat history sidebar works
- [ ] Works on multiple pages
</verification>

<success_criteria>
**From Phase 6.1:**
- At least one valid LLM API key configured
- Backend can communicate with LLM provider

**Carried forward from Phase 6 (06-04):**
- Modular chatbot architecture verified working end-to-end
- 8 JS modules load correctly
- No console.log statements in chatbot modules
- Chat functionality works (open, send, receive, history)
</success_criteria>

<output>
After completion, create `.planning/phases/6.1-fix-expired-llm-api-keys/6.1-01-SUMMARY.md`
</output>
