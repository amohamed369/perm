---
phase: 23.1-calendar-ui
plan: 02
type: execute
domain: react-calendar
---

<objective>
Build the main calendar view page with react-big-calendar, custom toolbar, and event rendering.

Purpose: Create the core calendar UI that displays all case deadlines with stage-based coloring and neobrutalist styling.
Output: Working /calendar page with month/week/day views, custom styled events, hover details.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23.1-calendar-ui/23.1-CONTEXT.md
@.planning/phases/23.1-calendar-ui/23.1-RESEARCH.md
@.planning/phases/23.1-calendar-ui/23.1-01-SUMMARY.md

**Codebase constraints:**
- Next.js 16.1.0 + React 19.2.3
- Tailwind v4 with neobrutalist design system
- Hard shadows (shadow-hard, shadow-hard-lg), no rounded corners
- Space Grotesk headings, Inter body

**Design guidance (CRITICAL - read before implementing):**
@.planning/FRONTEND_DESIGN_SKILL.md
@v2/docs/DESIGN_SYSTEM.md

**Relevant source files:**
@v2/src/lib/calendar/localizer.ts
@v2/src/lib/calendar/types.ts
@v2/src/lib/calendar/event-mapper.ts
@v2/src/app/(authenticated)/timeline/page.tsx (pattern reference)
@v2/src/components/timeline/TimelineControls.tsx (control pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CalendarPage with react-big-calendar integration</name>
  <files>v2/src/app/(authenticated)/calendar/page.tsx, v2/src/components/calendar/CalendarView.tsx</files>
  <exploration>
    Use Explore agent to find:
    - How timeline/page.tsx structures loading states, auth checks, empty states
    - How Convex useQuery is used for fetching case data
    - Pattern for authenticated page with data fetching
    Read @.planning/FRONTEND_DESIGN_SKILL.md for design requirements
  </exploration>
  <action>
1. Create v2/src/components/calendar/CalendarView.tsx:
   - Import react-big-calendar, localizer from lib/calendar
   - Import react-big-calendar CSS (need to override styles later)
   - Accept events prop (CalendarEvent[])
   - Configure views: ['month', 'week', 'day']
   - Set defaultView to 'month'
   - Set height: 100% (container controls height)
   - Add eventPropGetter for stage-based styling (from RESEARCH.md pattern)
   - Handle onSelectEvent (navigate to case detail)
   - Handle onRangeChange for future optimization

2. Update v2/src/app/(authenticated)/calendar/page.tsx:
   - "use client" directive
   - Import useQuery from convex/react
   - Query getCalendarEvents and getCalendarPreferences from calendar.ts
   - Use caseToCalendarEvents mapper to transform case data
   - Filter out hidden cases/deadline types based on preferences
   - Show loading skeleton while data loads
   - Show empty state if no cases
   - Render CalendarView with events

Follow timeline/page.tsx patterns for:
- AuthenticatedContent wrapper if used
- Loading state handling
- Error boundary considerations
  </action>
  <verify>
- Calendar renders at /calendar route
- Events display with correct stage colors
- Month/week/day views switch correctly
- No TypeScript errors
  </verify>
  <done>CalendarPage renders with react-big-calendar, events show stage colors, all views work</done>
</task>

<task type="auto">
  <name>Task 2: Create custom toolbar and event components with neobrutalist styling</name>
  <files>v2/src/components/calendar/CalendarToolbar.tsx, v2/src/components/calendar/CalendarEvent.tsx, v2/src/app/calendar.css</files>
  <exploration>
    Use Explore agent to find:
    - How TimelineControls implements navigation and view toggles
    - Button component styling (shadow-hard, border-2)
    - How tooltips work (Tippy.js in v1, or native CSS in v2)
    Read @.planning/FRONTEND_DESIGN_SKILL.md for neobrutalist styling requirements
  </exploration>
  <action>
1. Create v2/src/components/calendar/CalendarToolbar.tsx:
   - Accept ToolbarProps from react-big-calendar
   - Layout: [Previous Today Next] | [Month Label] | [Month Week Day]
   - Use Button component from ui/button with neobrutalist variants
   - Navigation buttons: variant="outline" with shadow-hard
   - View toggle: variant="default" for active, "outline" for inactive
   - Month label: font-heading text-2xl font-bold
   - Responsive: stack on mobile

2. Create v2/src/components/calendar/CalendarEvent.tsx:
   - Custom event component for inside cells
   - Show: stage color dot + truncated title
   - Use stage colors from STAGE_COLORS
   - Urgency indicator: red/orange/green left border
   - Truncate long titles with ellipsis
   - Bold text, no rounded corners

3. Create v2/src/app/calendar.css (or add to globals.css):
   - Override react-big-calendar default styles
   - Remove all border-radius (neobrutalist)
   - Apply border-2 border-border to cells
   - Today cell: bg-muted highlight
   - Weekend cells: slightly different background
   - Hard shadows on selected events
   - Import this CSS after react-big-calendar base CSS

4. Wire custom components in CalendarView:
   - components={{ toolbar: CalendarToolbar, event: CalendarEvent }}
   - eventPropGetter for dynamic styling
  </action>
  <verify>
- Custom toolbar renders with proper neobrutalist styling
- Event cells show stage colors correctly
- No rounded corners anywhere in calendar
- Hard shadows on interactive elements
  </verify>
  <done>Custom toolbar and event components styled neobrutalist, all views maintain design consistency</done>
</task>

<task type="auto">
  <name>Task 3: Add event popover with case details and navigation</name>
  <files>v2/src/components/calendar/CalendarEventPopover.tsx, v2/src/components/calendar/CalendarView.tsx</files>
  <exploration>
    Use Explore agent to find:
    - How Popover/Dialog components work in ui/
    - How case detail links are constructed (/cases/[id])
    - How TimelineMilestoneMarker shows tooltip on hover
  </exploration>
  <action>
1. Create v2/src/components/calendar/CalendarEventPopover.tsx:
   - Triggered on event click (not just hover - hover is finicky on touch)
   - Show full event details:
     - Deadline type + date
     - Employer name
     - Beneficiary name
     - Position title
     - Case status badge
     - Days until deadline (with urgency color)
   - "View Case" button → navigate to /cases/{caseId}
   - "Hide from Calendar" option → adds to hidden list
   - Use Popover or Dialog from ui/ components
   - Neobrutalist styling: shadow-hard-lg, border-2, no radius

2. Update CalendarView.tsx:
   - Add state for selected event
   - onSelectEvent → set selected event → show popover
   - onNavigate or outside click → close popover
   - Pass popover state and handlers

3. Add keyboard accessibility:
   - Enter on event opens popover
   - Escape closes popover
   - Focus trap inside popover
  </action>
  <verify>
- Clicking event shows popover with case details
- "View Case" navigates to correct case detail page
- Popover closes on outside click or Escape
- Keyboard navigation works
  </verify>
  <done>Event popover shows case details, navigation works, keyboard accessible</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm tsc --noEmit` passes
- [ ] `pnpm test` passes (no regressions)
- [ ] `pnpm build` succeeds
- [ ] Calendar page loads at /calendar
- [ ] Month, week, day views all work
- [ ] Events display with correct stage colors
- [ ] Custom toolbar looks neobrutalist
- [ ] Event popover shows case details
- [ ] "View Case" navigation works
</verification>

<success_criteria>
- /calendar page fully functional with react-big-calendar
- Custom neobrutalist toolbar with view toggles
- Events styled with stage colors and urgency indicators
- Event popover shows employer, beneficiary, position, deadline
- "View Case" button navigates correctly
- Keyboard accessible (Enter to select, Escape to close)
- No rounded corners, hard shadows everywhere
- Responsive layout (stacks on mobile)
</success_criteria>

<output>
After completion, create `.planning/phases/23.1-calendar-ui/23.1-02-SUMMARY.md`:

# Phase 23.1 Plan 02: Calendar View Component Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 23.1-03-PLAN.md (Filtering + Polish)
</output>
