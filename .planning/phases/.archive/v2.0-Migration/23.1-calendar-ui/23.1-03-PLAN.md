---
phase: 23.1-calendar-ui
plan: 03
type: execute
domain: react-calendar
---

<objective>
Add filtering controls, visibility management, responsive mobile view, and visual polish.

Purpose: Complete the calendar with user controls for filtering and a polished, responsive experience.
Output: Filter bar, visibility controls, mobile fallback, animations, human-verified complete calendar.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23.1-calendar-ui/23.1-CONTEXT.md
@.planning/phases/23.1-calendar-ui/23.1-RESEARCH.md
@.planning/phases/23.1-calendar-ui/23.1-01-SUMMARY.md
@.planning/phases/23.1-calendar-ui/23.1-02-SUMMARY.md

**Codebase constraints:**
- Framer Motion for animations (motion package)
- CaseSelectionModal can be reused from timeline
- Responsive: mobile-first, list view fallback for small screens

**Design guidance (CRITICAL - read before implementing):**
@.planning/FRONTEND_DESIGN_SKILL.md
@v2/docs/DESIGN_SYSTEM.md

**Relevant source files:**
@v2/src/components/calendar/CalendarView.tsx
@v2/src/components/calendar/CalendarToolbar.tsx
@v2/src/components/timeline/CaseSelectionModal.tsx (reusable)
@v2/src/components/timeline/TimelineLegend.tsx (reusable)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add filtering controls and legend</name>
  <files>v2/src/components/calendar/CalendarFilters.tsx, v2/src/app/(authenticated)/calendar/page.tsx</files>
  <exploration>
    Use Explore agent to find:
    - How TimelineControls implements filter toggles
    - CaseSelectionModal implementation (can reuse for "Select Cases")
    - TimelineLegend component (can reuse for stage colors)
    - Checkbox styling in design system
  </exploration>
  <action>
1. Create v2/src/components/calendar/CalendarFilters.tsx:
   - Filter bar below toolbar or in sidebar
   - Deadline type toggles (checkboxes):
     - PWD dates (filing, determination, expiration)
     - Recruitment dates (job order, ads, notice)
     - ETA 9089 dates (filing, certification, expiration)
     - Filing windows (open, close markers)
     - I-140 dates (filing, receipt, approval)
     - RFI/RFE entries
   - "Show Completed Cases" toggle (default OFF)
   - "Case Selection" button → opens CaseSelectionModal
   - Badge showing "3/10 cases selected" or "All cases"
   - Persist filter state to calendarPreferences via mutation

2. Reuse CaseSelectionModal from timeline:
   - May need to make it more generic or just import directly
   - Already has search, filter, sort, bulk select
   - On save → update calendarPreferences.selectedCaseIds

3. Add TimelineLegend or create CalendarLegend:
   - Show stage colors with labels
   - Show urgency indicators
   - Position: bottom of page or collapsible sidebar

4. Update calendar/page.tsx:
   - Add CalendarFilters above CalendarView
   - Wire filter state to event filtering
   - Connect CaseSelectionModal with case selection logic
  </action>
  <verify>
- Filter toggles show/hide deadline types correctly
- "Show Completed" toggle works
- Case selection modal opens and filters work
- Selected case badge updates correctly
  </verify>
  <done>Filter bar with deadline type toggles, case selection modal, stage legend</done>
</task>

<task type="auto">
  <name>Task 2: Add mobile list view and responsive polish</name>
  <files>v2/src/components/calendar/CalendarMobileList.tsx, v2/src/components/calendar/CalendarView.tsx, v2/src/app/(authenticated)/calendar/page.tsx</files>
  <exploration>
    Use Explore agent to find:
    - How other pages handle mobile breakpoints
    - Timeline mobile behavior
    - useMediaQuery hook or Tailwind responsive patterns
  </exploration>
  <action>
1. Create v2/src/components/calendar/CalendarMobileList.tsx:
   - List view of upcoming deadlines (next 30 days)
   - Group by week or day
   - Each item: deadline type + case name + date + urgency color
   - Tap to open case detail
   - Simpler than full calendar grid on small screens

2. Update CalendarView.tsx for responsive:
   - Detect screen size (useMediaQuery or CSS-only)
   - On mobile (<768px): show CalendarMobileList instead of Calendar
   - On tablet+: show full Calendar
   - Add "Switch to List/Calendar" toggle for user choice

3. Responsive styling tweaks:
   - Toolbar stacks on mobile (nav buttons above, view buttons below)
   - Filter bar collapses to dropdown/sheet on mobile
   - Touch targets: minimum 44x44px
   - Horizontal scroll if needed on week view

4. Update calendar/page.tsx:
   - Pass isMobile state to child components
   - Handle view preference persistence
  </action>
  <verify>
- On mobile viewport: list view displays correctly
- Touch targets are adequate size
- Toolbar is usable on small screens
- Toggle between list/calendar works
  </verify>
  <done>Mobile list view fallback, responsive toolbar, touch-friendly interactions</done>
</task>

<task type="auto">
  <name>Task 3: Add animations and final polish</name>
  <files>v2/src/components/calendar/CalendarView.tsx, v2/src/components/calendar/CalendarEventPopover.tsx, v2/src/app/calendar.css</files>
  <exploration>
    Use Explore agent to find:
    - How Framer Motion is used in timeline components
    - AnimatePresence patterns for mount/unmount
    - CSS transition patterns in design system
  </exploration>
  <action>
1. Add Framer Motion animations:
   - View change: fade/slide transition between month/week/day
   - Event hover: subtle scale (1.02) with spring physics
   - Popover: fade in/out with AnimatePresence
   - Filter changes: smooth list re-render

2. CSS micro-interactions (calendar.css):
   - Event hover: transform translate(-2px, -2px) + shadow-hard-lg
   - Today cell: subtle pulse or glow
   - Navigation buttons: hover lift effect
   - Day cell hover: highlight

3. Polish passes:
   - Dark mode verification (CSS variables work correctly)
   - Privacy mode integration if applicable (blur sensitive data)
   - Empty state animation (bouncy illustration if we have one)
   - Loading skeleton for initial load

4. Accessibility final check:
   - ARIA labels on navigation buttons
   - Screen reader announcements for view changes
   - Focus visible styles
   - Color contrast verification
  </action>
  <verify>
- Animations feel smooth and responsive
- Dark mode displays correctly
- No janky transitions
- Accessibility audit passes for navigation
  </verify>
  <done>Animations implemented, dark mode verified, accessibility checked</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete calendar view page at /calendar with:
  - Month/week/day views with react-big-calendar
  - Stage-colored events (PWD blue, Recruitment purple, ETA orange, I-140 green)
  - Event popover with case details and "View Case" navigation
  - Filter bar with deadline type toggles
  - Case selection modal for filtering which cases to show
  - Mobile list view fallback
  - Neobrutalist styling (hard shadows, no rounded corners)
  - Framer Motion animations
  </what-built>
  <how-to-verify>
    1. Run: `pnpm dev` in v2/
    2. Visit: http://localhost:3000/calendar (login if needed)
    3. **Month view checks:**
       - Events display with correct stage colors
       - Hard shadows on events, no rounded corners
       - Today highlighted
       - Navigate with Previous/Next buttons
    4. **View switching:**
       - Click Week → week view with time slots
       - Click Day → day view with time slots
       - Click Month → back to month grid
    5. **Event interaction:**
       - Click an event → popover shows case details
       - Popover has "View Case" button → navigates to case
       - Popover closes on outside click or Escape
    6. **Filtering:**
       - Toggle deadline types (uncheck PWD → PWD events disappear)
       - Toggle "Show Completed" → completed cases appear/disappear
       - Click case selection → modal with search/filter works
    7. **Mobile (resize browser to <768px or use DevTools):**
       - List view shows instead of calendar grid
       - Touch targets are adequate
       - Toolbar is usable
    8. **Dark mode:**
       - Toggle system dark mode → calendar adapts correctly
    9. **Animations:**
       - View changes have smooth transitions
       - Event hover has subtle lift effect
       - Popover fades in/out
  </how-to-verify>
  <resume-signal>Type "approved" if everything looks correct, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm tsc --noEmit` passes
- [ ] `pnpm test` passes (all tests)
- [ ] `pnpm build` succeeds
- [ ] Human checkpoint approved
- [ ] All filter controls work correctly
- [ ] Mobile view is usable
- [ ] Dark mode displays correctly
- [ ] Animations are smooth
</verification>

<success_criteria>
- Filter bar with deadline type toggles works
- Case selection modal filters visible cases
- "Show Completed" toggle works
- Mobile list view fallback at <768px
- View transitions animated with Framer Motion
- Event hover effects present
- Popover animations smooth
- Dark mode verified
- Accessibility basics in place
- Human verification passed
- Phase 23.1 complete
</success_criteria>

<output>
After completion, create `.planning/phases/23.1-calendar-ui/23.1-03-SUMMARY.md`:

# Phase 23.1 Plan 03: Filtering + Polish Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Human Checkpoint Result

Approved / Issues found and fixed: [details]

## Next Phase Readiness

- Phase 23.1 COMPLETE
- Calendar View Page fully functional
- Ready for Phase 24 (Notifications) or Phase 24.1 (API Documentation)
</output>
