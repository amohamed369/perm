---
phase: 23.1-calendar-ui
plan: 03
task: checkpoint
total_tasks: 4
status: awaiting_human_verification
last_updated: 2025-12-28T19:45:20Z
---

<current_state>
Phase 23.1 Plan 03 (Filtering + Polish) is COMPLETE and awaiting human verification checkpoint.

All code is implemented:
- Filter bar with deadline type toggles
- TWO separate checkboxes: "Show Completed (I-140 Approved)" and "Show Closed/Archived"
- Case selection modal with correct labels
- Mobile list view fallback
- Framer Motion animations
- Responsive styling

All verifications pass:
- TypeScript: PASS
- Tests: 2205/2205 PASS
- Build: PASS

User paused before completing the human checkpoint verification.
</current_state>

<completed_work>

- Task 1: Add filtering controls and legend - DONE
  - Created CalendarFilters.tsx with deadline type toggles
  - Integrated CaseSelectionModal from timeline
  - Added TimelineLegend for stage colors

- Task 2: Add mobile list view and responsive polish - DONE
  - Created CalendarMobileList.tsx
  - Added responsive view toggle
  - Touch-friendly styling (44px targets)

- Task 3: Add animations and final polish - DONE
  - Framer Motion view transitions
  - Event hover effects
  - Popover animations
  - Dark mode verification
  - Accessibility labels

- FIX: Separated Completed vs Closed - DONE
  - Updated convex/calendar.ts with showCompleted AND showClosed params
  - Updated CalendarFilters with TWO separate checkboxes
  - Fixed CaseSelectionModal labels ("Closed" not "Complete")
  - Added "Completed" filter option (I-140 approved)
  - Made modal title/description generic ("Select Cases")
  - Updated schema with calendarShowCompleted and calendarShowClosed fields

</completed_work>

<remaining_work>

- Human checkpoint verification (Task 4) - User needs to verify:
  1. Two separate filter checkboxes work independently
  2. Case selection modal has correct labels
  3. All calendar views work correctly
  4. Mobile view works
  5. Animations are smooth

- After approval:
  - Create 23.1-03-SUMMARY.md
  - Update STATE.md
  - Update ROADMAP.md
  - Commit changes

</remaining_work>

<decisions_made>

- Separated "Completed" (I-140 approved) from "Closed" (archived) as independent filters
- Made CaseSelectionModal generic with optional title/description props for reuse
- Added progressStatus to CaseForSelection type for filtering by completion status
- Used CSS-only responsive pattern (no useMediaQuery hook) per codebase convention

</decisions_made>

<blockers>
None - code is complete, awaiting human verification
</blockers>

<files_modified>

**New files:**
- v2/src/components/calendar/CalendarFilters.tsx
- v2/src/components/calendar/CalendarMobileList.tsx
- v2/src/app/calendar.css

**Modified files:**
- v2/convex/schema.ts (calendarShowCompleted, calendarShowClosed fields)
- v2/convex/calendar.ts (showCompleted/showClosed params)
- v2/convex/calendar.test.ts (updated test expectations)
- v2/src/components/calendar/CalendarView.tsx (responsive, animations)
- v2/src/components/calendar/CalendarToolbar.tsx (responsive, animations)
- v2/src/components/calendar/CalendarEventPopover.tsx (animations)
- v2/src/components/calendar/index.ts (exports)
- v2/src/app/(authenticated)/calendar/page.tsx (filter state, showClosed)
- v2/src/app/(authenticated)/timeline/page.tsx (progressStatus)
- v2/src/components/timeline/CaseSelectionModal.tsx (labels, title props, completed filter)
- v2/src/components/timeline/CaseSelectionItem.tsx (progressStatus type)
- v2/src/components/timeline/__tests__/CaseSelectionModal.test.tsx (updated expectations)
- v2/src/components/dashboard/__tests__/SummaryTilesGrid.test.tsx (fixed link count)
- v2/convex/dashboard.test.ts (progress field expectations)

</files_modified>

<context>
The user noticed that "Completed" (I-140 approved) and "Closed" (archived) were being treated as the same thing, but they are semantically different:
- Completed = I-140 approved (successful outcome)
- Closed = Case closed for any reason (neutral outcome)

These needed to be independent filters throughout the app. The calendar now properly separates them with two checkboxes. The CaseSelectionModal filter dropdown also has both options.

The user verified that the desired behavior for deadlines is already correct - both completed and closed cases are excluded from deadline displays by default.
</context>

<next_action>
When resuming:

1. Present the human checkpoint again for verification:
   - Run `pnpm dev` in v2/
   - Visit http://localhost:3000/calendar
   - Verify the two separate filter checkboxes
   - Verify CaseSelectionModal labels
   - Test all functionality

2. After "approved":
   - Create 23.1-03-SUMMARY.md
   - Update STATE.md with position and decisions
   - Update ROADMAP.md (mark phase 23.1 complete if this is the last plan)
   - Stage and commit changes
   - Offer next steps (Phase 24 or review)
</next_action>
