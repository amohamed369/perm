---
phase: 24.1-api-documentation
plan: 02
type: execute
---

<objective>
Update v2/CLAUDE.md and v2/README.md with comprehensive project documentation.

Purpose: Enhance the developer guide (CLAUDE.md) with complete workflow guidance, commands, and patterns. Update README.md with accurate project overview and complete feature list.
Output: Updated v2/CLAUDE.md and v2/README.md with industry-standard documentation
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24.1-api-documentation/24.1-CONTEXT.md
@.planning/phases/24.1-api-documentation/24.1-01-SUMMARY.md

**Prior decisions:**
- v2/CLAUDE.md is the primary developer guide (for Claude sessions and humans)
- v2/README.md is the project overview with quick start and feature summary
- Professional, industry-standard quality
- Document everything that exists

**Current state (from exploration):**
- v2/CLAUDE.md exists (415 lines) - Good PERM logic coverage, needs workflow/commands expansion
- v2/README.md exists (146 lines) - Basic overview, outdated test counts

**What needs enhancement:**

v2/CLAUDE.md:
- Add complete dev commands section (all npm scripts)
- Add Convex-specific workflows (schema changes, migrations)
- Add testing workflow with pitfalls
- Add notification/email patterns (new in Phase 24)
- Add scheduled jobs patterns (new in Phase 24)
- Add push notification patterns (new in Phase 24)
- Link to new API.md
- Update file structure to reflect current state

v2/README.md:
- Update test counts (2747 tests as of Phase 24)
- Add notification system overview
- Add email integration overview
- Add scheduled jobs overview
- Update features list
- Link to docs/API.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance CLAUDE.md with dev workflows and commands</name>
  <files>v2/CLAUDE.md</files>
  <exploration>
    Read v2/package.json to get all npm scripts.
    Check v2/convex/ for schema and migration patterns.
    Identify any missing workflow documentation.
  </exploration>
  <action>
Update v2/CLAUDE.md with the following additions/enhancements:

1. **Quick Start section** - Already good, verify commands are current

2. **Add "Development Commands" section** (comprehensive):
```markdown
## Development Commands

### Core Commands
| Command | Description |
|---------|-------------|
| `pnpm dev` | Start Next.js dev server |
| `npx convex dev` | Start Convex dev server (required) |
| `pnpm build` | Production build |
| `pnpm lint` | Run ESLint |
| `pnpm typecheck` | TypeScript type checking |

### Testing Commands
| Command | Description |
|---------|-------------|
| `pnpm test` | Run unit tests (watch mode) |
| `pnpm test:run` | Run unit tests (single run) |
| `pnpm test:coverage` | Run with coverage report |
| `pnpm test:e2e` | Run Playwright E2E tests |
| `pnpm test:all` | Run all tests |

### Storybook
| Command | Description |
|---------|-------------|
| `pnpm storybook` | Start Storybook at :6006 |
| `pnpm build-storybook` | Build static Storybook |
```

3. **Add "Convex Workflows" section**:
- Schema changes workflow (edit schema.ts, npx convex dev applies)
- Adding new tables
- Adding indexes
- Function patterns (query vs mutation vs action)
- Internal functions usage

4. **Add "Testing Patterns" section**:
- Test file locations (*.test.ts in convex/, tests/ for components)
- Convex test helpers (convexTest, t.run, t.query, t.mutation)
- Test pitfalls (async handling, mock patterns)
- Coverage expectations

5. **Update "File Structure" section** to include:
- scheduledJobs.ts
- deadlineEnforcement.ts
- notificationActions.ts
- pushNotifications.ts
- crons.ts
- All new Phase 24 files

6. **Add link to API.md**:
```markdown
For complete Convex API documentation, see [docs/API.md](docs/API.md).
```
  </action>
  <verify>CLAUDE.md has complete commands table, Convex workflows, testing patterns</verify>
  <done>CLAUDE.md updated with comprehensive dev workflow documentation</done>
</task>

<task type="auto">
  <name>Task 2: Add notification and scheduled job patterns to CLAUDE.md</name>
  <files>v2/CLAUDE.md</files>
  <exploration>
    Read v2/convex/notifications.ts, v2/convex/notificationActions.ts,
    v2/convex/scheduledJobs.ts, v2/convex/crons.ts for patterns.
    Identify key patterns developers need to know.
  </exploration>
  <action>
Add new sections to v2/CLAUDE.md:

1. **Add "Notification System" section**:
```markdown
## Notification System

### Creating Notifications (Server-side)
Notifications are created via internal mutation - never from client:
```typescript
// In a mutation that triggers notification
await ctx.runMutation(internal.notifications.createNotification, {
  userId,
  type: 'status_change', // or 'deadline_reminder', 'rfi_alert', etc.
  title: 'Case Status Updated',
  message: 'Status changed to Recruitment',
  priority: 'normal', // 'low' | 'normal' | 'high' | 'urgent'
  caseId, // optional - links to case
});
```

### Notification Types
| Type | Priority | Use Case |
|------|----------|----------|
| `status_change` | normal | Case status updates |
| `deadline_reminder` | high/urgent | Upcoming deadlines |
| `rfi_alert` | high/urgent | RFI received or due |
| `rfe_alert` | high/urgent | RFE received or due |
| `auto_closure` | urgent | Case auto-closed |

### Email Integration
Emails are sent via scheduled actions after notification creation:
```typescript
// Schedule email after creating notification
ctx.scheduler.runAfter(0, internal.notificationActions.sendDeadlineReminderEmail, {
  userId, notificationId, caseId, deadlineType, deadlineDate, daysUntil
});
```
```

2. **Add "Scheduled Jobs" section**:
```markdown
## Scheduled Jobs

### Cron Configuration (convex/crons.ts)
| Job | Schedule | Description |
|-----|----------|-------------|
| `deadline-reminders` | Daily 9 AM EST | Check deadlines, create notifications |
| `notification-cleanup` | Hourly :30 | Delete read notifications >90 days |
| `weekly-digest` | Monday 9 AM EST | Send weekly summary email |

### Adding New Cron Jobs
1. Add job to `convex/crons.ts`
2. Create internal action in `convex/scheduledJobs.ts`
3. Use `ctx.runMutation(internal.xxx)` for DB operations from actions
```

3. **Add "Push Notifications" section**:
```markdown
## Push Notifications

### VAPID Configuration
Set in environment variables:
- `VAPID_PUBLIC_KEY`
- `VAPID_PRIVATE_KEY`
- `VAPID_SUBJECT` (mailto: URL)

### Subscription Flow
1. Client requests permission via service worker
2. Client calls `savePushSubscription` mutation with subscription JSON
3. Server sends push via `sendPushNotification` internal action
```

4. **Add "Email Templates" section**:
```markdown
## Email Templates

Email templates are React Email components in `src/emails/`:
- `DeadlineReminderEmail.tsx`
- `StatusChangeEmail.tsx`
- `RfiAlertEmail.tsx`
- `RfeAlertEmail.tsx`
- `AutoClosureAlertEmail.tsx`
- `WeeklyDigestEmail.tsx`

### Sending Emails
Uses Resend API via internal actions. Requires `RESEND_API_KEY`.
```
  </action>
  <verify>CLAUDE.md has notification, scheduled job, and email sections</verify>
  <done>CLAUDE.md enhanced with Phase 24 patterns (notifications, crons, email)</done>
</task>

<task type="auto">
  <name>Task 3: Update README.md with current project state</name>
  <files>v2/README.md</files>
  <exploration>
    Check actual test count via `pnpm test:run` output or test files.
    Review current feature set from completed phases.
    Verify project structure is accurate.
  </exploration>
  <action>
Update v2/README.md with:

1. **Update test count** in "Running Tests" section:
   - Change from 326 to current count (2747 as of Phase 24)
   - Update E2E count if changed

2. **Add "Features" section** after Tech Stack:
```markdown
## Features

### Case Management
- Full CRUD for PERM cases
- Duplicate detection
- Bulk operations (delete, status update, import/export)
- Favorites and pinning
- Soft-delete with restore

### PERM Deadline Engine
- 10 deadline calculators (PWD, recruitment, ETA 9089, I-140, RFI)
- 44 validation rules across 8 categories
- 5 cascade rules for automatic field updates
- Business day calculations with federal holidays

### Dashboard
- Real-time case counts by status
- Deadline urgency grouping (overdue, this week, this month)
- Recent activity feed
- Upcoming deadlines widget

### Timeline Visualization
- Case milestone timeline
- Configurable time ranges (3/6/12/24 months)
- Case selection and filtering

### Calendar View
- Month/week/day views
- Deadline color coding by case status
- Event filtering and preferences

### Notifications
- In-app notification bell with unread badge
- Full notifications page with tabs and filters
- Email notifications via Resend
- Push notifications via Web Push
- Scheduled deadline reminders (daily cron)
- Weekly digest emails

### Deadline Enforcement
- Auto-closure for deadline violations
- PWD expiration enforcement
- I-140 filing deadline enforcement
- RFI/RFE due date enforcement
```

3. **Update "Key Components" section**:
- Add Notification components
- Add Calendar components
- Add Timeline components

4. **Update "Documentation" section**:
```markdown
## Documentation

- [CLAUDE.md](CLAUDE.md) - Developer guide and patterns
- [docs/API.md](docs/API.md) - Complete Convex API reference
- [TEST_README.md](TEST_README.md) - Testing guide
- [docs/DESIGN_SYSTEM.md](docs/DESIGN_SYSTEM.md) - Design system
- [docs/CASE_CARD.md](docs/CASE_CARD.md) - CaseCard component
- [docs/PERM_SYSTEM_ARCHITECTURE.md](docs/PERM_SYSTEM_ARCHITECTURE.md) - PERM engine architecture
```

5. **Update project structure** to reflect current state with new files

6. **Update PERM Engine stats**:
- Update test count (was 319, now higher)
- Verify calculator/validator counts
  </action>
  <verify>README.md reflects current project state with accurate counts</verify>
  <done>README.md updated with comprehensive project overview</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] CLAUDE.md has complete dev commands table
- [ ] CLAUDE.md has Convex workflows section
- [ ] CLAUDE.md has testing patterns section
- [ ] CLAUDE.md has notification/email patterns
- [ ] CLAUDE.md has scheduled jobs section
- [ ] CLAUDE.md links to docs/API.md
- [ ] README.md has accurate test counts
- [ ] README.md has complete features section
- [ ] README.md links to docs/API.md
- [ ] All file structures are current
</verification>

<success_criteria>

- CLAUDE.md is comprehensive developer guide (workflow, commands, patterns)
- README.md is accurate project overview (features, stats, structure)
- Both documents link to docs/API.md
- Industry-standard documentation quality
- All information is current and accurate
- Phase 24.1 complete
</success_criteria>

<output>
After completion, create `.planning/phases/24.1-api-documentation/24.1-02-SUMMARY.md`:

# Phase 24.1 Plan 02: Documentation Updates Summary

**[One-liner summary of what was updated]**

## Accomplishments

- Enhanced v2/CLAUDE.md with [specifics]
- Updated v2/README.md with [specifics]
- [Other key outcomes]

## Files Created/Modified

- `v2/CLAUDE.md` - Enhanced developer guide
- `v2/README.md` - Updated project overview

## Decisions Made

[Any documentation structure decisions]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 24.1 complete, ready for Phase 25 (Settings + Preferences)
</output>
