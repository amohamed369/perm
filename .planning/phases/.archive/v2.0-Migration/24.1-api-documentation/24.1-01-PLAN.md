---
phase: 24.1-api-documentation
plan: 01
type: execute
---

<objective>
Create comprehensive Convex API documentation (v2/docs/API.md).

Purpose: Document all 69 Convex functions with full signatures, parameters, return types, auth patterns, and usage examples. This is the primary API reference for developers.
Output: v2/docs/API.md - Complete Convex API reference (industry-standard quality)
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24.1-api-documentation/24.1-CONTEXT.md

**Prior decisions:**
- Document ALL Convex functions including internal helpers
- Use table-driven format where appropriate, fuller prose with examples where context helps
- Industry-standard professional quality throughout
- Audience: Both Claude and human developers

**Explore Agent Findings (API Inventory):**

**Total Functions:** 69 (48 public + 21 internal)
- Queries: 27
- Mutations: 21
- Actions: 8
- Internal: 21

**Modules to document:**
1. cases.ts - 15 functions (Case CRUD, bulk ops, import/export)
2. notifications.ts - 13 functions (5 queries, 5 mutations, 3 internal)
3. dashboard.ts - 4 queries (deadlines, summary, activity)
4. calendar.ts - 3 functions (events, preferences)
5. timeline.ts - 5 functions (preferences, case selection)
6. notificationActions.ts - 5 internal actions (email sending)
7. pushNotifications.ts + pushSubscriptions.ts - 5 functions
8. users.ts - 5 functions (user/profile management)
9. auditLogs.ts - 3 queries
10. scheduledJobs.ts - 9 internal functions
11. deadlineEnforcement.ts - 5 functions
12. crons.ts - Configuration (3 cron jobs)
13. auth.ts - Configuration

**Cross-cutting patterns to document:**
- Authentication: getCurrentUserId() vs getCurrentUserIdOrNull()
- Ownership verification
- Error handling
- Notification patterns
- Pagination (cursor-based)
- Batching for cleanup operations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API.md with structure and overview</name>
  <files>v2/docs/API.md</files>
  <action>
Create v2/docs/API.md with:

1. **Header section:**
   - Title: "Convex API Reference"
   - Version/date, last updated
   - Table of contents with anchor links to each module

2. **Overview section:**
   - Total function count (48 public, 21 internal)
   - Module summary table
   - Quick start examples

3. **Authentication patterns section:**
   - getCurrentUserId() vs getCurrentUserIdOrNull() with examples
   - Ownership verification pattern
   - When to use each pattern

4. **Module template structure** (empty sections for Task 2):
   - cases.ts
   - notifications.ts
   - dashboard.ts
   - calendar.ts
   - timeline.ts
   - users.ts
   - auditLogs.ts
   - deadlineEnforcement.ts
   - Scheduled Jobs section
   - Internal Actions section

Use markdown with proper heading hierarchy, code blocks, and tables.
  </action>
  <verify>File exists at v2/docs/API.md with all section headers</verify>
  <done>API.md created with complete structure and overview sections</done>
</task>

<task type="auto">
  <name>Task 2: Document Cases, Dashboard, and Calendar modules</name>
  <files>v2/docs/API.md</files>
  <exploration>
    Read v2/convex/cases.ts, v2/convex/dashboard.ts, v2/convex/calendar.ts to verify function signatures.
    Check for any additional undocumented functions or helpers.
  </exploration>
  <action>
Fill in the Cases, Dashboard, and Calendar sections with:

For each function:
- Function name and type (query/mutation/action)
- Full TypeScript signature
- Parameter descriptions with types
- Return type description
- Auth requirements (throws vs returns null)
- Side effects (notifications, audit logs, emails)
- Usage example with realistic data
- Notes on validation, error handling

**cases.ts (15 functions):**
- list, get, listFiltered, checkDuplicates (queries)
- create, update, remove, restore, bulkRemove, bulkUpdateStatus (mutations)
- toggleFavorite, togglePinned, toggleCalendarSync, importCases, reopenCase (mutations)

**dashboard.ts (4 queries):**
- getDeadlines, getSummary, getRecentActivity, getUpcomingDeadlines

**calendar.ts (3 functions):**
- getCalendarEvents, getCalendarPreferences, updateCalendarPreferences

Use consistent formatting throughout. Include code examples.
  </action>
  <verify>Cases, Dashboard, and Calendar sections fully documented with examples</verify>
  <done>All 22 functions in these modules documented with signatures and examples</done>
</task>

<task type="auto">
  <name>Task 3: Document remaining modules and cross-cutting patterns</name>
  <files>v2/docs/API.md</files>
  <exploration>
    Read v2/convex/notifications.ts, v2/convex/timeline.ts, v2/convex/users.ts,
    v2/convex/auditLogs.ts, v2/convex/deadlineEnforcement.ts to verify signatures.
    Read v2/convex/scheduledJobs.ts and v2/convex/notificationActions.ts for internal functions.
  </exploration>
  <action>
Complete remaining module documentation:

**notifications.ts (13 functions):**
- Queries: getUnreadCount, getRecentNotifications, getNotifications, getNotificationsByCase, getNotificationStats
- Mutations: markAsRead, markAllAsRead, markMultipleAsRead, deleteNotification, deleteAllRead
- Internal: createNotification, cleanupCaseNotifications, markEmailSent

**timeline.ts (5 functions):**
- getPreferences, getCasesForTimeline, updatePreferences, addCaseToTimeline, removeCaseFromTimeline

**users.ts (5 functions):**
- currentUser, currentUserProfile, getDecryptedGoogleTokens, ensureUserProfile, updateUserProfile

**auditLogs.ts (3 queries):**
- listMine, forDocument, byDateRange

**deadlineEnforcement.ts (5 functions):**
- getAutoClosureAlerts, isEnforcementEnabled, checkAndEnforceDeadlines, dismissAutoClosureAlert, dismissAllAutoClosureAlerts

**Scheduled Jobs section:**
- Cron configurations (3 jobs with schedules)
- Internal queries and actions

**Internal Actions section:**
- notificationActions.ts (5 email actions)
- pushNotifications.ts (sendPushNotification)
- pushSubscriptions.ts (2 mutations: savePushSubscription, removePushSubscription)

**Cross-cutting patterns section (expand):**
- Pagination patterns (cursor format, examples)
- Batching patterns (cleanup operations)
- Notification creation patterns
- Data validation patterns
- Error handling conventions
  </action>
  <verify>All 69 functions documented, all cross-cutting patterns explained</verify>
  <done>Complete API.md with all modules and patterns documented</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] v2/docs/API.md exists and is valid markdown
- [ ] All 48 public functions documented with signatures
- [ ] All 21 internal functions documented (in appropriate section)
- [ ] Each function has: signature, params, returns, auth, example
- [ ] Cross-cutting patterns section complete
- [ ] Table of contents links work
- [ ] No placeholder text remaining
</verification>

<success_criteria>

- API.md is comprehensive (69 functions documented)
- Industry-standard documentation quality
- Useful for both Claude (quick lookup) and humans (learning)
- All code examples are accurate and runnable
- Documentation matches actual codebase
</success_criteria>

<output>
After completion, create `.planning/phases/24.1-api-documentation/24.1-01-SUMMARY.md`:

# Phase 24.1 Plan 01: API Documentation Summary

**[One-liner summary of what was created]**

## Accomplishments

- Created v2/docs/API.md
- Documented X functions across Y modules
- [Other key outcomes]

## Files Created/Modified

- `v2/docs/API.md` - Complete Convex API reference

## Decisions Made

[Any format or structure decisions]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 24.1-02-PLAN.md (CLAUDE.md + README.md updates)
</output>
