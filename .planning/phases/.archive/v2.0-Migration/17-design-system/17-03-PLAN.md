---
phase: 17-design-system
plan: 03
type: execute
domain: frontend-design
---

<critical_requirement>
**MANDATORY SUBAGENT INSTRUCTION**: When using the Task tool to spawn ANY subagent for frontend/UI work in this plan, you MUST include this instruction in the subagent's prompt:

"BEFORE doing any work, you MUST read /Users/adammohamed/cc/perm-tracker-test/.planning/FRONTEND_DESIGN_SKILL.md in its entirety and apply all design principles from that document. This file contains critical design guidance for PERM Tracker v2 including neobrutalist styling, color tokens, and typography requirements. Do not proceed until you have read and internalized this skill."

This is a BLOCKING requirement. Every Task tool call for UI/frontend work must include this instruction.
</critical_requirement>

<objective>
Build PERM-specific status components: CaseStageBadge, UrgencyIndicator, DeadlineIndicator, ProgressStatusBadge.

Purpose: Create the visual vocabulary for displaying case status and deadline urgency - the core UX of the product. These components make case stage and deadline urgency instantly readable at a glance.
Output: 4 status components in src/components/status/ using exact v1 colors and Motion animations.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/FRONTEND_DESIGN_SKILL.md
@.planning/V2_DESIGN_TOKENS.json
@.planning/phases/17-design-system/17-CONTEXT.md
@.planning/phases/17-design-system/17-RESEARCH.md
@.planning/phases/17-design-system/17-01-SUMMARY.md
@.planning/phases/17-design-system/17-02-SUMMARY.md
@v2/src/lib/perm-engine/types.ts

**Prior plan completion:**
- 17-01: Design tokens configured in globals.css (stage colors, urgency colors)
- 17-02: Badge component available at @/components/ui/badge

**CRITICAL: Status colors from V2_DESIGN_TOKENS.json (v1 must be preserved):**
- PWD: `#0066FF` (blue)
- Recruitment: `#9333ea` (purple)
- ETA 9089: `#D97706` (orange)
- ETA 9089 Working: `#EAB308` (yellow)
- I-140: `#059669` (teal/green)
- Closed: `#6B7280` (gray)

**Urgency colors:**
- Urgent (≤7 days): `#DC2626` (red) with pulse animation
- Soon (8-30 days): `#EA580C` (orange)
- Normal (30+ days): `#059669` (green)

**From RESEARCH.md:**
- Use Motion (not framer-motion) for animations
- Import: `import { motion } from "motion/react"`
- Snappy transitions: visualDuration 0.15, bounce 0.1
- Urgent indicator should pulse

**perm-engine types to use (from perm_flow.md source of truth):**
- CaseStatus: "pwd" | "recruitment" | "eta9089" | "i140" | "closed"
- ProgressStatus: "working" | "waiting_intake" | "filed" | "approved" | "under_review" | "rfi_rfe"

**Progress Status labels (from perm_flow.md):**
- working → "Working on it" (default)
- waiting_intake → "Waiting for Intake"
- filed → "Filed" (auto, manual override)
- approved → "Approved" (auto, manual override)
- under_review → "Under Review"
- rfi_rfe → "RFI/RFE"
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CaseStageBadge component</name>
  <files>v2/src/components/status/case-stage-badge.tsx, v2/src/components/status/index.ts</files>
  <action>
Create src/components/status/ directory and CaseStageBadge:

```typescript
// v2/src/components/status/case-stage-badge.tsx
import { Badge } from "@/components/ui/badge"
import { cn } from "@/lib/utils"
import type { CaseStatus } from "@/lib/perm-engine"

// Stage configuration using CSS variables from globals.css
const stageConfig: Record<CaseStatus, { className: string; label: string }> = {
  pwd: {
    className: "bg-[var(--stage-pwd)] text-white border-[var(--stage-pwd)]",
    label: "PWD",
  },
  recruitment: {
    className: "bg-[var(--stage-recruitment)] text-white border-[var(--stage-recruitment)]",
    label: "Recruitment",
  },
  eta9089: {
    className: "bg-[var(--stage-eta9089)] text-white border-[var(--stage-eta9089)]",
    label: "ETA 9089",
  },
  i140: {
    className: "bg-[var(--stage-i140)] text-white border-[var(--stage-i140)]",
    label: "I-140",
  },
  closed: {
    className: "bg-[var(--stage-closed)] text-white border-[var(--stage-closed)]",
    label: "Closed",
  },
}

interface CaseStageBadgeProps {
  stage: CaseStatus
  className?: string
}

export function CaseStageBadge({ stage, className }: CaseStageBadgeProps) {
  const config = stageConfig[stage]
  return (
    <Badge className={cn("font-semibold", config.className, className)}>
      {config.label}
    </Badge>
  )
}
```

Create index.ts barrel export:
```typescript
// v2/src/components/status/index.ts
export { CaseStageBadge } from "./case-stage-badge"
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>CaseStageBadge renders correct color for each of 5 case statuses</done>
</task>

<task type="auto">
  <name>Task 2: Create UrgencyIndicator with pulse animation</name>
  <files>v2/src/components/status/urgency-indicator.tsx</files>
  <action>
Create UrgencyIndicator using Motion for the urgent pulse:

```typescript
// v2/src/components/status/urgency-indicator.tsx
"use client"

import { motion } from "motion/react"
import { cn } from "@/lib/utils"

type UrgencyLevel = "urgent" | "soon" | "normal"

const urgencyConfig: Record<UrgencyLevel, { color: string; pulse: boolean; label: string }> = {
  urgent: { color: "bg-[var(--urgency-urgent)]", pulse: true, label: "Urgent" },
  soon: { color: "bg-[var(--urgency-soon)]", pulse: false, label: "Soon" },
  normal: { color: "bg-[var(--urgency-normal)]", pulse: false, label: "On Track" },
}

interface UrgencyIndicatorProps {
  level: UrgencyLevel
  daysUntil?: number
  showDays?: boolean
  className?: string
}

export function UrgencyIndicator({
  level,
  daysUntil,
  showDays = true,
  className,
}: UrgencyIndicatorProps) {
  const config = urgencyConfig[level]

  return (
    <div className={cn("flex items-center gap-2", className)}>
      <motion.div
        className={cn("w-3 h-3 rounded-full", config.color)}
        animate={config.pulse ? { scale: [1, 1.3, 1] } : undefined}
        transition={
          config.pulse
            ? { repeat: Infinity, duration: 1.5, ease: "easeInOut" }
            : undefined
        }
      />
      {showDays && daysUntil !== undefined && (
        <span className="text-sm font-medium text-foreground">
          {daysUntil} {daysUntil === 1 ? "day" : "days"}
        </span>
      )}
    </div>
  )
}

// Utility to calculate urgency level from days
export function getUrgencyLevel(daysUntil: number): UrgencyLevel {
  if (daysUntil <= 7) return "urgent"
  if (daysUntil <= 30) return "soon"
  return "normal"
}
```

Add to index.ts exports.
  </action>
  <verify>TypeScript compiles with motion import: `npx tsc --noEmit`</verify>
  <done>UrgencyIndicator with pulsing red dot for urgent items, static orange/green for others</done>
</task>

<task type="auto">
  <name>Task 3: Create DeadlineIndicator component</name>
  <files>v2/src/components/status/deadline-indicator.tsx</files>
  <action>
Create DeadlineIndicator that combines date display with urgency:

```typescript
// v2/src/components/status/deadline-indicator.tsx
"use client"

import { format, differenceInDays, parseISO } from "date-fns"
import { UrgencyIndicator, getUrgencyLevel } from "./urgency-indicator"
import { cn } from "@/lib/utils"

interface DeadlineIndicatorProps {
  /** ISO date string (YYYY-MM-DD) */
  deadline: string
  /** Optional label like "PWD Expires" */
  label?: string
  /** Show the formatted date */
  showDate?: boolean
  className?: string
}

export function DeadlineIndicator({
  deadline,
  label,
  showDate = true,
  className,
}: DeadlineIndicatorProps) {
  const deadlineDate = parseISO(deadline)
  const today = new Date()
  const daysUntil = differenceInDays(deadlineDate, today)
  const urgencyLevel = getUrgencyLevel(daysUntil)
  const isPast = daysUntil < 0

  return (
    <div className={cn("flex flex-col gap-1", className)}>
      {label && (
        <span className="text-xs font-medium text-muted-foreground uppercase tracking-wide">
          {label}
        </span>
      )}
      <div className="flex items-center gap-3">
        <UrgencyIndicator
          level={isPast ? "urgent" : urgencyLevel}
          daysUntil={Math.abs(daysUntil)}
          showDays
        />
        {showDate && (
          <span className="text-sm text-muted-foreground">
            {format(deadlineDate, "MMM d, yyyy")}
          </span>
        )}
      </div>
      {isPast && (
        <span className="text-xs font-semibold text-[var(--urgency-urgent)]">
          OVERDUE
        </span>
      )}
    </div>
  )
}
```

Add to index.ts exports.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>DeadlineIndicator displays deadline with urgency dot, days remaining, and OVERDUE label when past</done>
</task>

<task type="auto">
  <name>Task 4: Create ProgressStatusBadge component</name>
  <files>v2/src/components/status/progress-status-badge.tsx</files>
  <action>
Create ProgressStatusBadge for the 6 progress statuses:

```typescript
// v2/src/components/status/progress-status-badge.tsx
import { Badge } from "@/components/ui/badge"
import { cn } from "@/lib/utils"
import type { ProgressStatus } from "@/lib/perm-engine"

// Progress status visual config (from perm_flow.md - no color, just tag)
// Per perm_flow.md: "Progress Status (its own tag no box no color)"
const progressConfig: Record<ProgressStatus, { className: string; label: string }> = {
  working: {
    className: "bg-muted text-muted-foreground border-muted",
    label: "Working on it",
  },
  waiting_intake: {
    className: "bg-muted text-muted-foreground border-muted",
    label: "Waiting for Intake",
  },
  filed: {
    className: "bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800",
    label: "Filed",
  },
  approved: {
    className: "bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800",
    label: "Approved",
  },
  under_review: {
    className: "bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-800",
    label: "Under Review",
  },
  rfi_rfe: {
    className: "bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800",
    label: "RFI/RFE",
  },
}

interface ProgressStatusBadgeProps {
  status: ProgressStatus
  className?: string
}

export function ProgressStatusBadge({ status, className }: ProgressStatusBadgeProps) {
  const config = progressConfig[status]
  return (
    <Badge
      variant="outline"
      className={cn("text-xs", config.className, className)}
    >
      {config.label}
    </Badge>
  )
}
```

Update index.ts to export all status components:
```typescript
export { CaseStageBadge } from "./case-stage-badge"
export { UrgencyIndicator, getUrgencyLevel } from "./urgency-indicator"
export { DeadlineIndicator } from "./deadline-indicator"
export { ProgressStatusBadge } from "./progress-status-badge"
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>ProgressStatusBadge renders 6 progress statuses with appropriate colors</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] All 4 status components exist in src/components/status/
- [ ] CaseStageBadge uses exact v1 colors (PWD blue, Recruitment purple, etc.)
- [ ] UrgencyIndicator urgent dot pulses using Motion
- [ ] DeadlineIndicator calculates days correctly and shows OVERDUE
- [ ] All components use CSS variables (themeable)
- [ ] No TypeScript errors
</verification>

<success_criteria>
- 4 status components: CaseStageBadge, UrgencyIndicator, DeadlineIndicator, ProgressStatusBadge
- Status colors match V2_DESIGN_TOKENS.json exactly
- Motion animations working (urgent pulse)
- Components integrate with perm-engine types
- Dark mode compatible
</success_criteria>

<output>
After completion, create `.planning/phases/17-design-system/17-03-SUMMARY.md`
</output>
