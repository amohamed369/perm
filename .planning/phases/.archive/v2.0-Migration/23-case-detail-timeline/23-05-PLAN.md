---
phase: 23-case-detail-timeline
plan: 05
type: execute
---

<objective>
Polish timeline and case detail with animations, responsive refinements, and human verification.

Purpose: Ensure visual excellence, smooth interactions, and all v1 features preserved.
Output: Production-ready case detail and timeline pages with human-verified UX.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-case-detail-timeline/23-CONTEXT.md
@.planning/phases/23-case-detail-timeline/23-01-SUMMARY.md
@.planning/phases/23-case-detail-timeline/23-02-SUMMARY.md
@.planning/phases/23-case-detail-timeline/23-03-SUMMARY.md
@.planning/phases/23-case-detail-timeline/23-04-SUMMARY.md
@.planning/FRONTEND_DESIGN_SKILL.md

**REQUIRED READING (for all subagents):**
- .planning/FRONTEND_DESIGN_SKILL.md
- .planning/phases/17-design-system/design3.md
- .planning/phases/17-design-system/design4.md
- .planning/phases/17-design-system/design5.md
- perm_flow.md

**CODE QUALITY STANDARDS:**
- Clean, organized, minimal, abstract-able, scalable
- Maintainable, readable, DRY
- Polish and refinement focus

**Animation requirements from 23-CONTEXT.md:**
- Motion.dev (Framer Motion) for component animations
- GSAP for premium effects where appropriate
- Spring physics, 150ms transitions, snappy and responsive

**Prior plan completions:**
- 23-01: Data layer complete
- 23-02: Case detail page complete
- 23-03: Timeline page core complete
- 23-04: Case selection modal complete
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add animations to timeline and case detail</name>
  <files>
    v2/src/components/timeline/TimelineGrid.tsx,
    v2/src/components/timeline/TimelineMilestoneMarker.tsx,
    v2/src/components/timeline/CaseSelectionModal.tsx,
    v2/src/components/cases/detail/CaseDetailSection.tsx,
    v2/src/components/cases/detail/InlineCaseTimeline.tsx
  </files>
  <exploration>
    Use Explore agent to:
    - Check if motion (framer-motion) is installed in v2
    - Find existing animation patterns in v2 components
    - Review design references for animation style
  </exploration>
  <action>
Add polish animations:

**Install if needed:**
```bash
pnpm add motion  # or framer-motion
```

**TimelineGrid.tsx:**
- Staggered row entrance animation (delay per row)
- Smooth scroll behavior

**TimelineMilestoneMarker.tsx:**
- Scale animation on hover (1 → 1.5)
- Spring physics for natural feel
- Tooltip fade-in animation

**CaseSelectionModal.tsx:**
- Modal slide-up entrance
- Fade overlay
- List items stagger on filter change

**CaseDetailSection.tsx:**
- Collapsible animation (height + opacity)
- Smooth accordion behavior

**InlineCaseTimeline.tsx:**
- Milestones pop in on mount
- Range bar grow animation

Animation config:
```typescript
const spring = {
  type: "spring",
  stiffness: 500,
  damping: 30,
};

const transition = {
  duration: 0.15,
};
```

Focus on high-impact moments:
- Page load with staggered reveals
- Hover states that surprise
- Smooth state transitions
  </action>
  <verify>Animations render smoothly, no jank or stuttering</verify>
  <done>Animations added to key interactions</done>
</task>

<task type="auto">
  <name>Task 2: Add privacy mode support</name>
  <files>
    v2/src/components/timeline/TimelineRow.tsx,
    v2/src/components/cases/detail/BasicInfoSection.tsx,
    v2/src/hooks/usePrivacyMode.ts
  </files>
  <action>
Implement privacy mode (blur sensitive data):

**usePrivacyMode.ts:**
```typescript
export function usePrivacyMode() {
  // Read from user preferences or localStorage
  // Return { isPrivacyMode, togglePrivacyMode }
}
```

**TimelineRow.tsx:**
- Apply blur class to employer name when privacy mode enabled
- CSS: `filter: blur(4px)` on `.blur-sensitive` when active

**BasicInfoSection.tsx:**
- Blur employer name, FEIN, beneficiary identifier
- Add blur-sensitive class to sensitive fields

CSS utility:
```css
.privacy-mode .blur-sensitive {
  filter: blur(4px);
  user-select: none;
}
```

Toggle should be available in:
- User settings (Phase 25)
- Quick toggle in header (optional for now)
  </action>
  <verify>Privacy mode blurs sensitive data when enabled</verify>
  <done>Privacy mode implemented for timeline and case detail</done>
</task>

<task type="auto">
  <name>Task 3: Responsive refinements and mobile optimization</name>
  <files>
    v2/src/components/timeline/TimelineGrid.tsx,
    v2/src/components/timeline/TimelineRow.tsx,
    v2/src/components/timeline/TimelineControls.tsx,
    v2/src/app/(authenticated)/cases/[id]/page.tsx
  </files>
  <action>
Ensure excellent mobile experience:

**Timeline page:**
- Sidebar widths: 250px (desktop), 180px (≤768px), 140px (≤480px)
- Month headers: condensed format on mobile ("J", "F", "M")
- Controls: stack vertically on mobile
- Legend: 2x2 grid on mobile

**Case detail page:**
- Single column layout on mobile
- Collapsible sections default closed on mobile (except first)
- Inline timeline: horizontal scroll with swipe indicators
- Quick actions: bottom sheet on mobile

**Touch interactions:**
- Larger tap targets (44px minimum)
- Swipe gestures for timeline scroll
- Pull-to-refresh on case list

Test breakpoints:
- Desktop: 1024px+
- Tablet: 768px-1023px
- Mobile: 375px-767px
- Small mobile: <375px
  </action>
  <verify>All breakpoints render correctly, touch interactions work</verify>
  <done>Responsive design refined for all screen sizes</done>
</task>

<task type="auto">
  <name>Task 4: Dark mode verification and refinement</name>
  <files>
    v2/src/components/timeline/*.tsx,
    v2/src/components/cases/detail/*.tsx,
    v2/src/app/globals.css
  </files>
  <exploration>
    Use Explore agent to:
    - Find existing dark mode CSS variables
    - Check how other components handle dark mode
  </exploration>
  <action>
Verify dark mode works correctly:

**Check all components for:**
- Proper use of CSS variables (--bg-primary, --text-primary, etc.)
- No hardcoded colors that break in dark mode
- Border colors that work in both modes
- Shadows that look good in dark mode

**Timeline-specific:**
- Month header backgrounds
- Row hover states
- Milestone colors (should remain vibrant)
- Legend background
- Modal overlay

**Case detail-specific:**
- Section card backgrounds
- Inline timeline background
- Status badge contrast

Fix any hardcoded colors:
```css
/* Bad */
background: #ffffff;

/* Good */
background: var(--bg-primary);
```

Test toggle between light/dark to ensure smooth transition.
  </action>
  <verify>Dark mode looks correct, no contrast issues</verify>
  <done>Dark mode verified and refined</done>
</task>

<task type="auto">
  <name>Task 5: V1 feature parity verification</name>
  <files>Various - verification task</files>
  <action>
Verify all v1 features are preserved:

**Timeline page checklist:**
- [ ] Time range selector (3/6/12/24 months) works
- [ ] Case selection modal opens
- [ ] Search filters by employer name and position
- [ ] Sort by name/status/date works
- [ ] Filter by status works
- [ ] Bulk actions (Select All, Deselect All, Active Only) work
- [ ] Individual checkbox selection works
- [ ] "Showing X of Y cases" displays correctly
- [ ] 16 milestone types render with correct colors
- [ ] Calculated milestones (Ready to File, Recruitment Expires) appear
- [ ] Job order range bar displays
- [ ] Tooltips show label + date
- [ ] Click milestone navigates to case
- [ ] Legend shows 4 stage colors
- [ ] Current month highlighted
- [ ] Selection persists (Convex, not localStorage)
- [ ] Privacy mode blurs employer names

**Case detail page checklist:**
- [ ] All case data displays correctly
- [ ] Inline 6-month timeline shows
- [ ] Milestones on inline timeline have tooltips
- [ ] Quick actions dropdown works
- [ ] Edit navigates to edit page
- [ ] Delete shows confirmation and works
- [ ] Archive sets status to closed
- [ ] Reopen changes status back
- [ ] Add/Remove Timeline button works
- [ ] Button state reflects actual timeline inclusion

**Cross-component:**
- [ ] Event sync: delete case updates timeline
- [ ] Event sync: status change updates timeline
- [ ] Dark mode works throughout
- [ ] Responsive breakpoints work

Document any missing features as issues for follow-up.
  </action>
  <verify>All checklist items verified</verify>
  <done>V1 feature parity confirmed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Case Detail page at /cases/[id] and Timeline page at /timeline with:
- Full case information display in organized sections
- Inline timeline on case detail (6-month centered view)
- Full timeline page with horizontal layout
- 16 milestone types with correct colors
- Calculated milestones (Ready to File, Recruitment Expires)
- Case selection modal with search/filter/sort/bulk actions
- Add/Remove from Timeline buttons
- Animations and hover effects
- Dark mode support
- Responsive design for mobile/tablet/desktop
- Privacy mode (blur sensitive data)
  </what-built>
  <how-to-verify>
**Setup:**
1. Run: `cd v2 && pnpm dev`
2. Navigate to: http://localhost:3000

**Case Detail Page:**
3. Go to /cases (case list)
4. Click any case to view detail
5. Verify:
   - All sections display (Basic Info, PWD, Recruitment, ETA 9089, I-140, RFI/RFE)
   - Inline timeline shows milestones with correct colors
   - Tooltips appear on milestone hover
   - Quick actions dropdown works (Edit, Delete, Archive)
   - Add/Remove Timeline button reflects correct state

**Timeline Page:**
6. Navigate to /timeline
7. Verify:
   - Cases display in horizontal rows
   - Milestones appear at correct positions
   - Time range dropdown (3/6/12/24) changes view
   - "Select Cases" button opens modal

**Case Selection Modal:**
8. Open case selection modal
9. Test:
   - Search filters by employer name
   - Sort dropdown changes order
   - Filter dropdown filters by status
   - Select All / Deselect All work
   - Save persists selection

**Responsive:**
10. Resize browser to tablet (768px) and mobile (375px)
11. Verify layout adjustments

**Dark Mode:**
12. Toggle dark mode (if available) or use system preference
13. Verify all components look correct

**Animations:**
14. Note smooth animations on:
    - Page load
    - Hover states
    - Modal open/close
    - Section collapse/expand
  </how-to-verify>
  <resume-signal>
Type "approved" if everything looks good, or describe any issues to fix
  </resume-signal>
</task>

</tasks>

<verification>
Before human checkpoint:
- [ ] `pnpm tsc --noEmit` passes
- [ ] `pnpm test` passes (all timeline and case detail tests)
- [ ] `pnpm build` succeeds
- [ ] All animations render smoothly
- [ ] V1 feature parity verified
</verification>

<success_criteria>
- Human verification approved
- All v1 features preserved
- Animations polished and smooth
- Dark mode working
- Responsive design excellent
- Privacy mode functional
- Production-ready quality
</success_criteria>

<output>
After human approval, create `.planning/phases/23-case-detail-timeline/23-05-SUMMARY.md`

Include:
- Accomplishments
- Files Created/Modified
- Decisions Made
- Issues Encountered
- Verification Results
- Phase Status: Complete

Then update:
- `.planning/STATE.md` - Mark Phase 23 complete
- `.planning/ROADMAP.md` - Update Phase 23 status
</output>
