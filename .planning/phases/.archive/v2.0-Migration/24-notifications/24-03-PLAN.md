---
phase: 24-notifications
plan: 03
type: execute
---

<objective>
Build the full notifications page with tabs, filters, pagination, and bulk actions.

Purpose: Provide users with a complete view of all notifications with management capabilities.
Output: /notifications route with filterable, paginated notification list.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/FRONTEND_DESIGN_SKILL.md
@.planning/phases/24-notifications/24-CONTEXT.md

**Depends on:** 24-01-PLAN.md (data layer), 24-02-PLAN.md (shared components)

**Existing patterns:**
@v2/src/app/cases/page.tsx - List page with filters pattern
@v2/src/components/cases/CaseFilters.tsx - Filter component pattern
@v2/src/components/notifications/NotificationItem.tsx - From Plan 02

**From 24-CONTEXT.md specifics:**
- Tabs: All | Unread | Deadlines | Status | RFE/RFI (with count badges)
- Grouped by date: Today, Yesterday, This Week, This Month, Older
- 20 per page with pagination
- Dismiss (read but stays) vs Delete (gone) as separate actions
- Bulk actions: Mark All Read, Delete All Read
</context>

<orchestration>
## CRITICAL: Execution & Subagent Directive

**THIS SECTION MUST PERSIST THROUGH ALL COMPACTIONS. ALL AGENTS AND SUBAGENTS MUST FOLLOW THIS.**

### Mandatory Reading (BEFORE any implementation)
All agents/subagents MUST read and understand these files:
- `.planning/phases/24-notifications/24-CONTEXT.md` - Phase vision, specifics, boundaries
- `.planning/phases/24-notifications/24-RESEARCH.md` - Tech stack, patterns, pitfalls
- `.planning/PROJECT.md` - Overall project context
- `.planning/ROADMAP.md` - Where this phase fits
- `/Users/adammohamed/cc/perm-tracker-test/perm_flow.md` - PERM workflow (SOURCE OF TRUTH)
- `.planning/phases/17-design-system/design*.md` (design-1 through design-5) - UI/design docs for any frontend work
- `.planning/FRONTEND_DESIGN_SKILL.md` - Frontend design patterns

### Execution Pattern (Orchestrator Role)
The executing agent acts as an **orchestrator**:
1. **Explore First**: Spawn Explore subagent(s) to fully understand current implementation and what's needed
2. **Review Findings**: Look over findings yourself if small, delegate if large
3. **Implement**: Spawn Task subagent(s) to implement with explicit instructions
4. **Verify & Review**: Verify implementation, run tests, review quality
5. **Follow Up**: Fix issues, iterate as needed
6. **Repeat**: Until all tasks complete

### Code Quality Standards
For each issue, fully explore to understand:
- Current implementation state
- What's needed to achieve the goal
- **NO clashing, duplicate, or non-seamless implementations**

Implementation rules:
- **Work within existing code** as much as possible
- **Keep it minimal and simple** - DRY and KISS
- **Use what's already built** - leverage existing code, built-ins, standards
- **Create new only when needed** - don't reinvent
- **Refactor as you go** - fix issues, make it easier for future
- **Ensure fixes are global** - don't repeat fixes in multiple places
- **Keep it clean** - organized, minimal, abstractable, scalable, maintainable, readable
- **Ensure all v1 features exist** - no feature regression
- **Follow perm_flow.md** - the source of truth for PERM logic

### JSON Tracking File
Create and maintain: `.planning/phases/24-notifications/tracking.json`
```json
{
  "phase": "24-notifications",
  "plan": "03",
  "lastUpdated": "ISO-timestamp",
  "issues": [
    {
      "id": "03-T1",
      "task": "Create notifications page route",
      "status": "pending|in_progress|complete|blocked",
      "notes": "",
      "blockers": []
    }
  ]
}
```
Update this file throughout execution.

### Subagent Instructions Template
**ALL Task/Explore subagents MUST receive this in their prompt:**

```
CRITICAL INSTRUCTIONS FOR THIS SUBAGENT:

1. READ THESE DOCS FIRST (mandatory):
   - .planning/phases/24-notifications/24-CONTEXT.md
   - .planning/phases/24-notifications/24-RESEARCH.md
   - /Users/adammohamed/cc/perm-tracker-test/perm_flow.md
   - [For UI work: .planning/phases/17-design-system/design*.md (design-1 through design-5)]
   - .planning/FRONTEND_DESIGN_SKILL.md

2. EXPLORE THOROUGHLY before implementing:
   - Understand the entire v2/ directory structure
   - Understand the .planning/ directory structure
   - Find all related existing implementations
   - Identify patterns already in use

3. IMPLEMENTATION STANDARDS:
   - NO clashing or duplicate implementations
   - Work within existing code when possible
   - Keep minimal, simple, DRY, KISS
   - Use existing patterns and abstractions
   - Ensure seamless integration
   - Refactor as needed to maintain quality
   - Ensure fixes are global, not repeated

4. QUALITY CHECKLIST:
   - Clean, organized code
   - Abstractable and scalable
   - Maintainable and readable
   - All v1 features preserved
   - Follows perm_flow.md
   - Matches neobrutalist design system

5. CLEANUP: Remove any temporary files, unused code, or debug artifacts
```

### Cleanup Protocol
After each task completion:
- Remove temporary files
- Delete unused code
- Clean up debug artifacts
- Verify no leftover test data
- Update tracking.json

### Verification
Before marking any task complete:
- All tests pass
- No TypeScript errors
- No console errors
- Feature works as specified
- No regression in existing features
- UI matches design system

### CRITICAL: Commit Workflow (AFTER PLAN COMPLETE)
**This workflow is MANDATORY after completing ALL tasks in this plan:**

1. **STAGE** - Stage all changes: `git add -A`
2. **CODE REVIEW** - Run code reviewer agent:
   ```
   Task(subagent_type="pr-review-toolkit:code-reviewer", prompt="Review staged changes for quality, bugs, and adherence to project standards")
   ```
3. **FIX** - Address ALL issues found by code reviewer
4. **RE-REVIEW** - If significant fixes made, run code reviewer again
5. **COMMIT** - Create commit with conventional commit message:
   ```
   git commit -m "feat(notifications): <plan description>"
   ```

**DO NOT skip this workflow. The plan is NOT complete until code review passes and changes are committed.**
</orchestration>

<tasks>

<task type="auto">
  <name>Task 1: Create notifications page route</name>
  <files>v2/src/app/notifications/page.tsx</files>
  <exploration>
    Read @.planning/FRONTEND_DESIGN_SKILL.md for design guidance.
    Check v2/src/app/cases/page.tsx for list page patterns.
    Review existing tab implementations in the codebase.
  </exploration>
  <action>
Create the /notifications page:

**Page structure:**
```tsx
export default function NotificationsPage() {
  return (
    <div className="container mx-auto px-4 py-8">
      <PageHeader
        title="Notifications"
        description="Manage your notification history"
        actions={<BulkActions />}
      />

      <NotificationTabs />

      <NotificationList />
    </div>
  );
}
```

**PageHeader:**
- Title: "Notifications" (Space Grotesk, large)
- Description: Muted text below
- Actions slot for bulk action buttons

**Layout:**
- Max-width container
- Consistent padding with other pages
- Responsive margins

Add route to app router at v2/src/app/notifications/page.tsx.
Add "Notifications" to nav if not already present (optional - bell handles navigation).
  </action>
  <verify>Page renders at /notifications, layout matches other pages</verify>
  <done>Notifications page route created with basic structure</done>
</task>

<task type="auto">
  <name>Task 2: Create NotificationTabs component</name>
  <files>v2/src/components/notifications/NotificationTabs.tsx</files>
  <action>
Create tab navigation with count badges:

**Tabs:**
1. All - Total count badge
2. Unread - Unread count badge (highlighted if > 0)
3. Deadlines - deadline_reminder count
4. Status - status_change count
5. RFE/RFI - rfe_alert + rfi_alert count

**Implementation:**
```tsx
const tabs = [
  { id: "all", label: "All", filter: undefined },
  { id: "unread", label: "Unread", filter: { isRead: false } },
  { id: "deadlines", label: "Deadlines", filter: { type: ["deadline_reminder"] } },
  { id: "status", label: "Status", filter: { type: ["status_change"] } },
  { id: "rfe-rfi", label: "RFE/RFI", filter: { type: ["rfe_alert", "rfi_alert"] } },
];
```

**Styling (neobrutalist):**
- Horizontal tabs with 2px black border-bottom
- Active tab: black background, white text, slight lift
- Inactive: transparent background, black text
- Count badge: small pill, matches tab active state
- Hover: subtle background

**State management:**
- Use URL search params for tab persistence
- useSearchParams to read/write
- Filter state lifted to page or context

Count badges should update in real-time via Convex subscription.
  </action>
  <verify>Tabs render, clicking changes active state, counts display</verify>
  <done>NotificationTabs with 5 tabs and count badges</done>
</task>

<task type="auto">
  <name>Task 3: Create NotificationList with grouping</name>
  <files>v2/src/components/notifications/NotificationList.tsx, v2/src/components/notifications/NotificationGroup.tsx</files>
  <action>
Create paginated list with date grouping:

**NotificationList:**
- Fetch notifications with current filter
- Group by date category
- Render NotificationGroup for each category
- Handle pagination

**Date grouping logic:**
```typescript
function groupByDate(notifications: Notification[]) {
  const groups = {
    today: [],
    yesterday: [],
    thisWeek: [],
    thisMonth: [],
    older: [],
  };

  const now = new Date();
  const today = startOfDay(now);
  const yesterday = subDays(today, 1);
  const weekAgo = subDays(today, 7);
  const monthAgo = subDays(today, 30);

  for (const n of notifications) {
    const date = new Date(n.createdAt);
    if (date >= today) groups.today.push(n);
    else if (date >= yesterday) groups.yesterday.push(n);
    else if (date >= weekAgo) groups.thisWeek.push(n);
    else if (date >= monthAgo) groups.thisMonth.push(n);
    else groups.older.push(n);
  }

  return groups;
}
```

**NotificationGroup:**
- Group header: "Today", "Yesterday", "This Week", etc.
- Collapsible (optional - expand by default)
- List of NotificationListItem within

**NotificationListItem:**
- Extended version of NotificationItem from Plan 02
- Full width layout for list view
- Shows more detail (full message, case info)
- Separate Dismiss (mark read) and Delete buttons

**Pagination:**
- "Load More" button at bottom
- Show "Showing X of Y" count
- Use cursor-based pagination from data layer
  </action>
  <verify>List renders grouped by date, pagination works</verify>
  <done>NotificationList with date grouping and pagination</done>
</task>

<task type="auto">
  <name>Task 4: Create BulkActions component</name>
  <files>v2/src/components/notifications/BulkActions.tsx</files>
  <action>
Create bulk action buttons:

**Actions:**
1. "Mark All Read" - Calls markAllAsRead mutation
2. "Delete All Read" - Calls deleteAllRead mutation (with confirmation)

**Implementation:**
```tsx
export function BulkActions() {
  const markAllRead = useMutation(api.notifications.markAllAsRead);
  const deleteAllRead = useMutation(api.notifications.deleteAllRead);
  const stats = useQuery(api.notifications.getNotificationStats);

  const handleDeleteAllRead = async () => {
    // Show confirmation dialog
    if (confirm(`Delete ${stats.readCount} read notifications?`)) {
      await deleteAllRead();
      toast.success("Deleted all read notifications");
    }
  };

  return (
    <div className="flex gap-2">
      <Button
        variant="secondary"
        onClick={() => markAllRead()}
        disabled={stats?.unread === 0}
      >
        Mark All Read
      </Button>

      <Button
        variant="destructive"
        onClick={handleDeleteAllRead}
        disabled={stats?.read === 0}
      >
        Delete All Read
      </Button>
    </div>
  );
}
```

**UX:**
- Disabled states when no applicable notifications
- Loading states during mutations
- Success toast after action
- Confirmation dialog for destructive action

**Styling:**
- Match existing button styles
- Neobrutalist destructive button (red with hard shadow)
  </action>
  <verify>Bulk actions work, confirmation appears for delete</verify>
  <done>BulkActions with Mark All Read and Delete All Read</done>
</task>

<task type="auto">
  <name>Task 5: Write component tests</name>
  <files>v2/src/components/notifications/__tests__/NotificationList.test.tsx</files>
  <action>
Create component tests:

**NotificationTabs tests:**
- Renders all 5 tabs
- Active tab highlighted correctly
- Clicking tab updates filter
- Count badges display correct numbers
- URL params update on tab change

**NotificationList tests:**
- Renders notifications grouped by date
- Empty state when no notifications
- Pagination "Load More" works
- Filtering by type works
- Filtering by read status works

**NotificationGroup tests:**
- Renders group header
- Renders correct items within group
- Empty groups are hidden

**BulkActions tests:**
- Mark All Read calls mutation
- Delete All Read shows confirmation
- Buttons disabled when appropriate
- Success toast appears

Use React Testing Library and existing test patterns.
  </action>
  <verify>npm test -- notifications passes</verify>
  <done>Component tests for notifications page</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full notifications page with tabs, grouping, pagination, and bulk actions</what-built>
  <how-to-verify>
    1. Run: npm run dev (in v2/)
    2. Visit: http://localhost:3000/notifications
    3. Verify page layout: Title, tabs, notification list
    4. Check tabs: All, Unread, Deadlines, Status, RFE/RFI with count badges
    5. Click each tab: List filters correctly
    6. Verify grouping: Notifications grouped by Today, Yesterday, This Week, etc.
    7. Scroll/pagination: "Load More" works if many notifications
    8. Test "Mark All Read": Clears unread count, notifications update
    9. Test "Delete All Read": Confirmation appears, deletes read notifications
    10. Click notification: Navigates to case
    11. Individual actions: Dismiss and Delete work on single items
    12. Empty state: Clear all notifications, verify empty message
    13. Mobile: Responsive layout works
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] /notifications page renders
- [ ] 5 tabs with count badges
- [ ] Date grouping works correctly
- [ ] Pagination functional
- [ ] Bulk actions work
- [ ] Component tests pass
- [ ] Human verification approved
</verification>

<success_criteria>
- Full notifications page at /notifications
- Tab filtering works
- Date grouping displays correctly
- Bulk actions functional with confirmation
- Responsive design
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/24-notifications/24-03-SUMMARY.md`:

# Phase 24 Plan 03: Full Notifications Page Summary

**[One-liner describing what shipped]**

## Accomplishments
- /notifications page with tabs
- Date grouping (Today, Yesterday, etc.)
- Pagination with Load More
- Bulk actions (Mark All Read, Delete All Read)

## Files Created/Modified
- `v2/src/app/notifications/page.tsx`
- `v2/src/components/notifications/NotificationTabs.tsx`
- `v2/src/components/notifications/NotificationList.tsx`
- `v2/src/components/notifications/NotificationGroup.tsx`
- `v2/src/components/notifications/BulkActions.tsx`
- `v2/src/components/notifications/__tests__/NotificationList.test.tsx`

## Decisions Made
[Any decisions during implementation]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Ready for 24-04-PLAN.md (Email Integration)
</output>
