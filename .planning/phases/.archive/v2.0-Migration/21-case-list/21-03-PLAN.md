---
phase: 21-case-list
plan: 03
type: execute
---

<objective>
Build the Case List page with filter bar, sort options, and pagination.

Purpose: Create the main cases page with filtering, sorting, search, and pagination controls.
Output: Fully functional /cases page with responsive grid of CaseCards.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-case-list/21-CONTEXT.md
@perm_flow.md

**Prior Plan Summaries:**
@.planning/phases/21-case-list/21-01-SUMMARY.md
@.planning/phases/21-case-list/21-02-SUMMARY.md

**Design References (MUST READ):**
@.planning/FRONTEND_DESIGN_SKILL.md
@v2/docs/DESIGN_SYSTEM.md

**Component Dependencies:**
@v2/src/components/cases/CaseCard.tsx
@v2/convex/cases.ts (listFiltered query)

**UI Components:**
@v2/src/components/ui/button.tsx
@v2/src/components/ui/input.tsx

**CRITICAL INSTRUCTIONS:**
All agents/subagents MUST read before implementation:
1. .planning/FRONTEND_DESIGN_SKILL.md
2. perm_flow.md (source of truth for statuses)
3. v2/docs/DESIGN_SYSTEM.md

Code must be: clean, organized, minimal, abstractable, scalable, maintainable, readable.
Fixes must be GLOBAL — no repeated code, abstract patterns into reusable utilities.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CaseFilterBar component</name>
  <files>v2/src/components/cases/CaseFilterBar.tsx, v2/src/components/cases/__tests__/CaseFilterBar.test.tsx</files>
  <exploration>
    Use Explore agent to understand:
    - Existing filter patterns in dashboard
    - Available UI components (Select, Input, Button)
    - URL parameter handling in Next.js App Router
  </exploration>
  <action>
TDD: Write tests FIRST, then implement.

Create CaseFilterBar with clean, organized layout:

**Show By Tabs (top row):**
- Active (default) | Completed | Closed/Archived | All
- Tab styling: neobrutalist buttons, active tab has filled bg
- Each tab filters by case status accordingly

**Filter Row (below tabs):**
- Search input (left, grows to fill space)
  - Placeholder: "Search cases..."
  - Icon: magnifying glass
  - Debounced (300ms) to avoid excessive queries
- Case Status dropdown (fixed width)
  - Options: All, PWD, Recruitment, ETA 9089, I-140
- Progress Status dropdown (fixed width)
  - Options: All, Working on it, Waiting for intake, Filed, Approved, Under review, RFI/RFE
- Sort dropdown (fixed width)
  - Options per 21-CONTEXT.md: Next deadline, Favorites, Recently updated, Employer name, Case status, PWD filed, ETA 9089 filed, I-140 filed

**Smart Filters Row (optional, below filters):**
- Preset buttons: Urgent deadlines, Recent activity, Needs attention
- Clicking applies preset filter combination

**Props Interface:**
```typescript
interface CaseFilterBarProps {
  filters: CaseListFilters;
  sort: CaseListSort;
  onFiltersChange: (filters: CaseListFilters) => void;
  onSortChange: (sort: CaseListSort) => void;
}
```

**Styling:**
- Neobrutalist dropdowns (black borders, shadow on focus)
- Search input with icon inside
- Compact on mobile (stack vertically)
- Responsive: horizontal on desktop, vertical on mobile

Add tests for:
- All tabs render
- Tab click calls onFiltersChange
- Search input fires debounced callback
- Dropdown selections update filters
- Sort dropdown updates sort
  </action>
  <verify>pnpm test v2/src/components/cases/__tests__/CaseFilterBar.test.tsx passes</verify>
  <done>Filter bar renders with all controls, callbacks work correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create CasePagination component</name>
  <files>v2/src/components/cases/CasePagination.tsx, v2/src/components/cases/__tests__/CasePagination.test.tsx</files>
  <action>
TDD: Write tests FIRST, then implement.

Create CasePagination component:

**Layout:**
- Left: "Showing X-Y of Z cases"
- Center: Page X of Y
- Right: Previous | Next buttons + Per page dropdown

**Per Page Options:**
- 6, 12 (default), 24, 50

**Props Interface:**
```typescript
interface CasePaginationProps {
  currentPage: number;
  totalPages: number;
  totalCount: number;
  pageSize: number;
  onPageChange: (page: number) => void;
  onPageSizeChange: (size: number) => void;
}
```

**Button Styling:**
- Neobrutalist: black borders, shadow
- Disabled state for first/last page
- Hover lift effect

Add tests for:
- Shows correct case count range
- Shows correct page of total
- Previous disabled on page 1
- Next disabled on last page
- Page change callback fires
- Page size dropdown works
  </action>
  <verify>pnpm test v2/src/components/cases/__tests__/CasePagination.test.tsx passes</verify>
  <done>Pagination controls render and function correctly</done>
</task>

<task type="auto">
  <name>Task 3: Build Case List page with URL state</name>
  <files>v2/src/app/(authenticated)/cases/page.tsx, v2/src/app/(authenticated)/cases/loading.tsx, v2/src/components/cases/CaseListEmptyState.tsx</files>
  <exploration>
    Use Explore agent to understand:
    - Next.js App Router URL search params handling
    - useSearchParams, useRouter for URL state
    - Convex useQuery pattern in existing pages
  </exploration>
  <action>
TDD approach: Define expected behavior, implement to match.

Build the /cases page:

**Page Structure:**
```tsx
export default function CasesPage() {
  // 1. Read URL params for initial filter/sort/page state
  // 2. Query cases with listFiltered
  // 3. Handle loading/error states
  // 4. Render filter bar, card grid, pagination
}
```

**URL State Management:**
- Sync filters to URL: ?status=pwd&progress=filed&search=acme&sort=deadline&page=2
- On filter change, update URL (router.push with shallow)
- On page load, parse URL params for initial state
- Use useSearchParams() + useRouter()

**Grid Layout:**
- Responsive: 1 col mobile, 2 cols tablet, 3 cols desktop
- Gap: space-y-6 between rows, gap-6 between cards
- Cards animate in with staggered entrance (Framer Motion)

**Empty State (CaseListEmptyState):**
- Illustration: Empty filing cabinet
- Message: "No cases yet"
- CTA button: "Add your first case" → /cases/new
- Different message for filtered empty: "No cases match your filters"

**Loading State:**
- Skeleton cards (use Skeleton component)
- 6 skeleton cards in grid
- Pulse animation

**Page Header:**
- Title: "Cases"
- Subtitle: "[X] total cases"
- Add Case button (reuse AddCaseButton from Phase 20)

Create loading.tsx for Suspense fallback.
  </action>
  <verify>pnpm dev runs, /cases page loads with mock data, URL params persist on refresh</verify>
  <done>Case list page functional with filters, sort, pagination, URL state</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm test` passes all new tests
- [ ] `pnpm build` succeeds without errors
- [ ] No TypeScript errors
- [ ] /cases page loads without errors
- [ ] URL params update on filter/sort changes
- [ ] Page state persists on browser refresh
- [ ] Empty state displays when no cases
- [ ] Loading state displays while fetching
</verification>

<success_criteria>
- All 3 tasks completed
- All verification checks pass
- Filter bar has all controls from 21-CONTEXT.md
- Pagination works with URL state
- Cards display in responsive grid
- Empty and loading states polished
- URL state persists correctly
</success_criteria>

<output>
After completion, create `.planning/phases/21-case-list/21-03-SUMMARY.md`:

# Phase 21-03: Case List Page & Filters Summary

**[Substantive one-liner]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Ready for 21-04-PLAN.md (Selection Mode + Export/Import)
</output>
