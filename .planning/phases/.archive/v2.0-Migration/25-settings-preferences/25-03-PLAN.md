---
phase: 25-settings-preferences
plan: 03
type: execute
---

<objective>
Build Quiet Hours, Calendar Sync Preferences, and integrate the existing Auto-Close section.

Purpose: Complete the time-based and calendar-related settings. Quiet Hours controls when notifications are silenced. Calendar Sync prepares UI for Phase 30's Google Calendar integration. Auto-Close integrates the existing DeadlineEnforcementToggle.

Output: Three fully functional settings sections for time-sensitive notification control and calendar preferences.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-settings-preferences/25-CONTEXT.md
@.planning/phases/25-settings-preferences/25-01-SUMMARY.md
@.planning/phases/25-settings-preferences/25-02-SUMMARY.md

**Design Reference (MANDATORY):**
@.planning/FRONTEND_DESIGN_SKILL.md

**Schema Fields (userProfiles):**
Quiet Hours:
- quietHoursEnabled: boolean
- quietHoursStart: string (HH:MM)
- quietHoursEnd: string (HH:MM)
- timezone: string (already in Profile section)

Calendar Sync:
- calendarSyncEnabled: boolean (master toggle)
- calendarSyncPwd: boolean
- calendarSyncEta9089: boolean
- calendarSyncI140: boolean
- calendarSyncRfe: boolean
- calendarSyncRfi: boolean
- calendarSyncRecruitment: boolean
- calendarSyncFilingWindow: boolean
- googleCalendarConnected: boolean (read-only status)

Auto-Close:
- autoDeadlineEnforcementEnabled: boolean

**Existing Component:**
@v2/src/components/settings/DeadlineEnforcementToggle.tsx
</context>

## Required Reading (MANDATORY for all implementers)
- `.planning/FRONTEND_DESIGN_SKILL.md`
- `v2/CLAUDE.md`
- `perm_flow.md` (for deadline types)

## Implementation Rules
1. Explore existing code BEFORE creating anything new
2. No clashing, duplicate, or non-integrated implementations
3. Calendar Sync is PREP ONLY - no OAuth flow (Phase 30)
4. Quiet Hours must work with timezone from Profile section
5. Clean up thoroughly after

## Subagent Instructions
All Task and Explore subagents MUST receive these rules in their prompts.

<tasks>

<task type="auto">
  <name>Task 1: Create QuietHoursSection component</name>
  <files>v2/src/components/settings/QuietHoursSection.tsx</files>
  <exploration>
    Use Explore agent to:
    - Find time picker patterns in the codebase
    - Check if there's an existing time input component
    - Look for Select or Dropdown patterns in shadcn/ui
    - Find how shouldSendEmail() uses quiet hours
  </exploration>
  <action>
    **Create QuietHoursSection component:**

    1. **Master Toggle:**
       - Switch for quietHoursEnabled
       - When OFF: hide/disable time pickers below
       - When ON: show time configuration

    2. **Time Range Picker:**
       - Start Time: HH:MM selector (quietHoursStart)
       - End Time: HH:MM selector (quietHoursEnd)
       - Use native time input or custom dropdown
       - 12-hour format with AM/PM for US users
       - Store as 24-hour format (HH:MM)

    3. **Timezone Display:**
       - Read-only display of timezone (set in Profile section)
       - Link to Profile section to change timezone
       - Text: "Quiet hours use your timezone: [timezone name]"

    4. **Important Note:**
       - Info box explaining quiet hours behavior
       - "Urgent notifications (overdue deadlines, deadlines within X days) will still come through"
       - Use info icon with subtle styling

    **Layout:**
    - Card container matching other sections
    - Master toggle at top
    - Time inputs side-by-side on desktop, stacked on mobile
    - Note at bottom
  </action>
  <verify>
    - Section renders with toggle and time pickers
    - Times save in HH:MM format
    - Timezone displays correctly (from profile)
    - Changes save to database
    - Matches neobrutalist styling
  </verify>
  <done>Quiet Hours section with enable toggle, start/end time pickers, timezone display, and urgent bypass note</done>
</task>

<task type="auto">
  <name>Task 2: Create CalendarSyncSection component</name>
  <files>v2/src/components/settings/CalendarSyncSection.tsx</files>
  <action>
    **Create CalendarSyncSection component:**

    1. **Google Calendar Connection Status:**
       - Read-only display of googleCalendarConnected
       - If not connected: "Connect your Google Calendar in Phase 30"
       - If connected: Show connected email (googleEmail)
       - Green/gray status indicator

    2. **Master Calendar Sync Toggle:**
       - Switch for calendarSyncEnabled
       - When OFF: disable all per-deadline-type toggles
       - Note: "Sync deadlines to your Google Calendar"

    3. **Per-Deadline-Type Toggles (7 toggles):**
       - PWD Deadlines (calendarSyncPwd)
       - ETA 9089 Filing Window (calendarSyncEta9089)
       - I-140 Deadlines (calendarSyncI140)
       - RFE Due Dates (calendarSyncRfe)
       - RFI Due Dates (calendarSyncRfi)
       - Recruitment Deadlines (calendarSyncRecruitment)
       - Filing Window (calendarSyncFilingWindow)
       - Each with brief description
       - All disabled when master toggle off
       - All disabled when not connected (googleCalendarConnected = false)

    4. **Coming Soon Notice:**
       - Subtle banner at top: "Google Calendar integration coming in a future update"
       - Settings are saved but won't sync until Phase 30

    **Layout:**
    - Connection status at top (prominent)
    - Master toggle below
    - 2-column grid of deadline type toggles (responsive)
    - Clear grouping and labels
  </action>
  <verify>
    - Section renders with all 7 deadline type toggles
    - Master toggle controls sub-toggles
    - Per-deadline toggles save correctly
    - Connection status displays (currently false)
    - Matches neobrutalist styling
  </verify>
  <done>Calendar Sync preferences UI ready for Phase 30, all toggles functional and saving</done>
</task>

<task type="auto">
  <name>Task 3: Integrate DeadlineEnforcementToggle into settings layout</name>
  <files>v2/src/app/(authenticated)/settings/page.tsx, v2/src/components/settings/AutoCloseSection.tsx</files>
  <exploration>
    Use Explore agent to:
    - Review existing DeadlineEnforcementToggle implementation
    - Check if it needs any modifications for settings layout
    - Find section wrapper patterns from Plan 01
  </exploration>
  <action>
    **Create AutoCloseSection component:**

    1. **Wrapper for DeadlineEnforcementToggle:**
       - Import existing DeadlineEnforcementToggle component
       - Add section header matching other sections
       - No duplicate implementation - just wrap

    2. **Additional Context (if not in toggle):**
       - Ensure explanation of what auto-close does is visible
       - Warning about closure rules (PWD expiration, filing window)
       - Link to documentation or help

    3. **Integration:**
       - Add AutoCloseSection to settings page layout
       - Position it in the "Auto-Close" tab/section
       - Ensure consistent styling with other sections

    **Key Principle:** REUSE existing DeadlineEnforcementToggle, don't duplicate
  </action>
  <verify>
    - Auto-Close section visible in settings
    - DeadlineEnforcementToggle works as before
    - Styling consistent with other sections
    - No duplicate toggle implementations
  </verify>
  <done>Auto-Close section integrated using existing DeadlineEnforcementToggle component</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm build` succeeds without errors
- [ ] `pnpm tsc --noEmit` passes
- [ ] Quiet Hours section with time pickers works
- [ ] Calendar Sync section shows all 7 deadline types
- [ ] Auto-Close section uses existing component
- [ ] All settings save to database correctly
- [ ] Quiet hours affects notification delivery (test via shouldSendEmail)
- [ ] Styling consistent across all sections
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Quiet Hours integrated with notification system
- Calendar Sync UI ready for Phase 30
- Auto-Close using existing component (no duplication)
</success_criteria>

<output>
After completion, create `.planning/phases/25-settings-preferences/25-03-SUMMARY.md`:

# Phase 25 Plan 03: Quiet Hours + Calendar + Auto-Close Summary

**[One-liner describing what shipped]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale]

## Issues Encountered
[Problems and resolutions]

## Next Step
Ready for 25-04-PLAN.md (Account Management + Support + Polish)
</output>
