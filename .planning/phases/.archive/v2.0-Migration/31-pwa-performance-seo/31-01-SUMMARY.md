# Phase 31 Plan 01: PWA Infrastructure Summary

**Serwist PWA with strict NetworkOnly caching, manifest, icons, and SW registration in authenticated layout**

## Performance

- **Duration:** 43 min
- **Started:** 2026-01-11T05:03:38Z
- **Completed:** 2026-01-11T05:47:01Z
- **Tasks:** 3
- **Files modified:** 12

## Accomplishments

- Installed Serwist 9.5.0 and configured for Next.js 16 with webpack mode (required for SW bundling)
- Created PWA manifest with lime green theme (#2ECC40) and proper app metadata
- Generated all PWA icons (192x192, 512x512, 72x72 badge, 180x180 apple-touch)
- Created main service worker with strict NetworkOnly for HTML/JS/CSS (prevents stale deployments)
- Added offline fallback page with neobrutalist design
- Created ServiceWorkerRegistration and InstallPrompt components
- Fixed push notification icon paths (were /icons/icon-192x192.png, now /icon-192.png)
- Updated build script to use --webpack flag for Serwist compatibility

## Files Created/Modified

### Created
- `v2/src/app/manifest.ts` - Next.js built-in PWA manifest
- `v2/src/app/sw.ts` - Serwist service worker with strict caching rules
- `v2/src/app/~offline/page.tsx` - Offline fallback page
- `v2/src/components/pwa/ServiceWorkerRegistration.tsx` - SW registration component
- `v2/src/components/pwa/InstallPrompt.tsx` - Install prompt context & hook
- `v2/src/components/pwa/index.ts` - Barrel export
- `v2/public/icon-192.png` - 192x192 PWA icon (lime green with "PT")
- `v2/public/icon-512.png` - 512x512 PWA icon
- `v2/public/badge-72.png` - 72x72 notification badge
- `v2/public/apple-touch-icon.png` - 180x180 iOS icon
- `v2/serwist.d.ts` - TypeScript declarations for SW globals
- `v2/public/sw.js` - Compiled service worker (generated by build)

### Modified
- `v2/package.json` - Added @serwist/next, serwist deps; updated build script to --webpack
- `v2/next.config.ts` - Added Serwist integration with swSrc/swDest config
- `v2/src/app/(authenticated)/layout.tsx` - Added ServiceWorkerRegistration
- `v2/convex/pushNotifications.ts` - Fixed icon paths (2 occurrences)

## Decisions Made

- **Build uses webpack mode:** Next.js 16 uses Turbopack by default, but Serwist requires webpack for SW bundling. Added `--webpack` flag to build script.
- **NetworkOnly for HTML/JS/CSS:** Following project requirements (v1 Nov 2025 bug lesson), never cache these to prevent stale deployments.
- **CacheFirst for images/fonts:** Safe to cache static assets with expiration plugins (30 days for images, 1 year for fonts).
- **Separate service workers:** Kept main sw.js (caching) separate from sw-push.js (push notifications) for simplicity.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

- **Serwist + Turbopack incompatibility:** Next.js 16 defaults to Turbopack, but Serwist doesn't support it yet. Resolved by adding `--webpack` flag to build command.

## Next Phase Readiness

- PWA infrastructure complete and verified
- Service worker bundled successfully (47KB)
- All icons referenced by sw-push.js now exist
- Ready for Plan 31-02 (Performance optimization / SEO if exists, or phase complete)

---
*Phase: 31-pwa-performance-seo*
*Completed: 2026-01-11*
