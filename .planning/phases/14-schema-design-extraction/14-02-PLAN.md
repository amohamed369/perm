---
phase: 14-schema-design-extraction
plan: 02
type: execute
---

<objective>
Extract design tokens and create field mappings for v1 → v2 migration.

Purpose: Provide ready-to-implement design reference for Phase 17 (Design System) and field mapping for data migration
Output:
- `.planning/V2_DESIGN_TOKENS.json` - Complete design token system
- `.planning/V2_FIELD_MAPPINGS.md` - v1 snake_case → v2 camelCase field mappings
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/V2_MIGRATION_BRIEF.md
@.planning/phases/14-schema-design-extraction/14-CONTEXT.md

**Previous plan output:**
@.planning/V2_CONVEX_SCHEMA.md (created in 14-01)

**Design sources from codebase exploration:**
- Design philosophy: Soft Neobrutalism (bold, minimal, high contrast)
- Primary font: Inter (body), Space Grotesk (headings)
- Accent color: Forest Green (#228B22)
- Shadow style: Hard shadows (no blur): `4px 4px 0px #000`
- Border style: 2px solid black
- Stage colors: PWD (blue), Recruitment (green), ETA 9089 (amber), I-140 (purple)

**Key source files:**
@docs/design-system.md
@frontend/tailwind.config.js
@frontend/src/css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract design tokens to JSON format</name>
  <files>.planning/V2_DESIGN_TOKENS.json</files>
  <exploration>
    Use Explore agent to: Read docs/design-system.md, frontend/src/css/main.css, and frontend/tailwind.config.js. Extract ALL CSS custom properties and Tailwind theme extensions.
  </exploration>
  <action>
Create `.planning/V2_DESIGN_TOKENS.json` with the complete design token system:

```json
{
  "$schema": "https://design-tokens.org/schema/v1.0",
  "meta": {
    "name": "PERM Tracker Design System",
    "version": "3.1",
    "philosophy": "Soft Neobrutalism - Bold, minimal, functional with accessible contrast",
    "extracted_from": ["docs/design-system.md", "frontend/src/css/main.css", "frontend/tailwind.config.js"]
  },
  "colors": {
    "background": {
      "primary": { "value": "#FAFAFA", "description": "Off-white main background" },
      "secondary": { "value": "#F5F5F5", "description": "Light gray cards/sections" }
    },
    "text": {
      "primary": { "value": "#000000", "description": "Maximum contrast black" },
      "secondary": { "value": "#666666", "description": "Muted text" }
    },
    "accent": {
      "primary": { "value": "#228B22", "description": "Forest Green - AAA accessible" },
      "primaryHover": { "value": "#1B6B1B", "description": "Darker green on hover" },
      "destructive": { "value": "#FF4747", "description": "Tomato red for destructive actions" }
    },
    "border": {
      "default": { "value": "#000000", "description": "Pure black borders" }
    },
    "stages": {
      "pwd": { "value": "#0066FF", "description": "Electric Blue - PWD stage" },
      "recruitment": { "value": "#228B22", "description": "Forest Green - Recruitment stage" },
      "eta9089": { "value": "#D97706", "description": "Amber - ETA 9089 stage" },
      "i140": { "value": "#7C3AED", "description": "Purple - I-140 stage" }
    },
    "darkMode": {
      "background": {
        "primary": { "value": "#1A1A1A", "description": "Rich black" },
        "secondary": { "value": "#2A2A2A", "description": "Slightly lighter" }
      },
      "text": {
        "primary": { "value": "#FAFAFA", "description": "Off-white" }
      },
      "accent": {
        "primary": { "value": "#2ECC40", "description": "Brighter green on dark" }
      }
    }
  },
  "typography": {
    "fonts": {
      "heading": { "value": "'Space Grotesk', system-ui, sans-serif", "weight": "600-700" },
      "body": { "value": "'Inter', system-ui, sans-serif", "weight": "400-500" }
    },
    "sizes": {
      "xs": { "value": "0.75rem", "lineHeight": "1rem" },
      "sm": { "value": "0.875rem", "lineHeight": "1.25rem" },
      "base": { "value": "1rem", "lineHeight": "1.5rem" },
      "lg": { "value": "1.125rem", "lineHeight": "1.75rem" },
      "xl": { "value": "1.25rem", "lineHeight": "1.75rem" },
      "2xl": { "value": "1.5rem", "lineHeight": "2rem" },
      "3xl": { "value": "1.875rem", "lineHeight": "2.25rem" },
      "4xl": { "value": "2.25rem", "lineHeight": "2.5rem" }
    }
  },
  "spacing": {
    "xs": { "value": "0.5rem", "px": "8px" },
    "sm": { "value": "1rem", "px": "16px" },
    "md": { "value": "2rem", "px": "32px" },
    "lg": { "value": "3rem", "px": "48px" },
    "xl": { "value": "4rem", "px": "64px" }
  },
  "borders": {
    "width": { "value": "2px", "description": "Hard edges - neobrutalism signature" },
    "radius": { "value": "6px", "description": "Subtle softening" }
  },
  "shadows": {
    "hard": { "value": "4px 4px 0px #000", "description": "Standard neobrutalist shadow" },
    "hardSm": { "value": "2px 2px 0px #000", "description": "Smaller shadow" },
    "hardLg": { "value": "8px 8px 0px #000", "description": "Larger shadow" }
  },
  "transitions": {
    "fast": { "value": "0.15s ease" },
    "base": { "value": "0.2s ease" },
    "slow": { "value": "0.3s ease" },
    "bounce": { "value": "0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55)" }
  },
  "accessibility": {
    "contrast": {
      "textOnBackground": { "ratio": "19.77:1", "level": "AAA" }
    },
    "focus": {
      "outline": { "value": "2px solid var(--accent)", "offset": "2px" }
    }
  }
}
```

Extract ALL values from the source files. Include:
- All CSS custom properties from :root
- All Tailwind theme extensions
- Dark mode variants
- Stage/timeline colors
- Animation/transition values

Ensure the JSON is valid and parseable.
  </action>
  <verify>
- File exists at .planning/V2_DESIGN_TOKENS.json
- JSON is valid (can be parsed)
- All color values match docs/design-system.md
- Typography fonts match actual usage (Inter, Space Grotesk)
- Stage colors documented (PWD, Recruitment, ETA 9089, I-140)
- Dark mode tokens included
  </verify>
  <done>Complete design token extraction in standard JSON format ready for Phase 17</done>
</task>

<task type="auto">
  <name>Task 2: Create v1 → v2 field mappings</name>
  <files>.planning/V2_FIELD_MAPPINGS.md</files>
  <exploration>
    Use Explore agent to: Review backend/app/schemas/*.py for all Pydantic model fields. Cross-reference with V2_CONVEX_SCHEMA.md to ensure all fields are covered.
  </exploration>
  <action>
Create `.planning/V2_FIELD_MAPPINGS.md` with comprehensive field mappings:

```markdown
# v1 → v2 Field Mappings

## Overview

This document maps every v1 database field to its v2 Convex equivalent for:
1. Data migration scripts
2. API response transformation
3. Codebase search-and-replace

**Naming Convention Change:**
- v1: snake_case (Python/SQL convention)
- v2: camelCase (TypeScript/JavaScript convention)

## Mapping Tables

### users Table

| v1 Field | v2 Field | Type Change | Notes |
|----------|----------|-------------|-------|
| id | _id | UUID → Id<"users"> | Convex auto-generated |
| auth_user_id | authUserId | string | External auth reference |
| email | email | string | No change |
| full_name | fullName | string | |
| firm_id | firmId | Id<"firms"> \| null | Optional FK |
| is_firm_admin | isFirmAdmin | boolean | |
| created_at | _creationTime | number | Convex built-in |
| updated_at | updatedAt | number | Manual timestamp |
| deleted_at | deletedAt | number \| null | Soft delete |

### cases Table

**Core Fields:**
| v1 Field | v2 Field | Type Change | Notes |
|----------|----------|-------------|-------|
| id | _id | UUID → Id<"cases"> | |
| user_id | userId | UUID → Id<"users"> | FK |
| case_name | caseName | string | |
| case_number | caseNumber | string \| null | Internal numbering |
| beneficiary_name | beneficiaryName | string | |
| current_stage | currentStage | string | Enum: pwd, recruitment, eta9089, i140 |
| status | status | string | Active/Complete/Withdrawn |
| is_favorite | isFavorite | boolean | |
| notes | notes | string \| null | |

**PWD Stage Fields:**
| v1 Field | v2 Field | Type Change | Notes |
|----------|----------|-------------|-------|
| pwd_filing_date | pwdFilingDate | number \| null | Unix timestamp |
| pwd_determination_date | pwdDeterminationDate | number \| null | |
| pwd_expiration_date | pwdExpirationDate | number \| null | Auto-calculated |
| pwd_wage_amount | pwdWageAmount | number \| null | Stored in cents |
| pwd_wage_level | pwdWageLevel | string \| null | I, II, III, IV |

**Recruitment Stage Fields:**
| v1 Field | v2 Field | Type Change | Notes |
|----------|----------|-------------|-------|
| job_order_start_date | jobOrderStartDate | number \| null | |
| job_order_end_date | jobOrderEndDate | number \| null | |
| sunday_ad_first_date | sundayAdFirstDate | number \| null | Must be Sunday |
| sunday_ad_second_date | sundayAdSecondDate | number \| null | Must be Sunday, > first |
| notice_of_filing_start_date | noticeOfFilingStartDate | number \| null | |
| notice_of_filing_end_date | noticeOfFilingEndDate | number \| null | |
| additional_recruitment_methods | additionalRecruitmentMethods | object[] | JSON array |
| recruitment_applicants_count | recruitmentApplicantsCount | number | Default: 0 |
| recruitment_notes | recruitmentNotes | string \| null | |

**ETA 9089 Stage Fields:**
| v1 Field | v2 Field | Type Change | Notes |
|----------|----------|-------------|-------|
| eta9089_filing_date | eta9089FilingDate | number \| null | 30-180 days after recruitment |
| eta9089_certification_date | eta9089CertificationDate | number \| null | |
| eta9089_expiration_date | eta9089ExpirationDate | number \| null | 180 days after cert |
| eta9089_case_number | eta9089CaseNumber | string \| null | DOL case number |
| is_professional_occupation | isProfessionalOccupation | boolean | Default: false |

**I-140 Stage Fields:**
| v1 Field | v2 Field | Type Change | Notes |
|----------|----------|-------------|-------|
| i140_filing_date | i140FilingDate | number \| null | ≤180 days after cert |
| i140_receipt_number | i140ReceiptNumber | string \| null | |
| i140_approval_date | i140ApprovalDate | number \| null | |

**RFI/RFE Fields:**
| v1 Field | v2 Field | Type Change | Notes |
|----------|----------|-------------|-------|
| rfi_received_date | rfiReceivedDate | number \| null | |
| rfi_response_due_date | rfiResponseDueDate | number \| null | |
| rfi_response_submitted_date | rfiResponseSubmittedDate | number \| null | |
| rfi_list | rfiList | object[] | JSON array of RFI entries |
| rfe_received_date | rfeReceivedDate | number \| null | |
| rfe_response_due_date | rfeResponseDueDate | number \| null | |
| rfe_response_submitted_date | rfeResponseSubmittedDate | number \| null | |
| rfe_list | rfeList | object[] | JSON array of RFE entries |

**Calendar Sync Fields:**
| v1 Field | v2 Field | Type Change | Notes |
|----------|----------|-------------|-------|
| calendar_sync_enabled | calendarSyncEnabled | boolean | Default: true |
| calendar_event_ids | calendarEventIds | object | JSON: deadline → eventId |

[Continue for ALL remaining tables: notifications, user_settings, refresh_tokens, user_preferences, permission_states, conversations, conversation_messages]

## Special Transformations

### Date Handling
- v1: DATE/TIMESTAMP stored as ISO strings or PostgreSQL timestamps
- v2: Unix timestamps (milliseconds) for Convex compatibility
- Migration: `new Date(v1_date).getTime()`

### Currency Handling
- v1: DECIMAL stored as-is (e.g., 75000.00)
- v2: Store as cents (e.g., 7500000) for integer precision
- Migration: `Math.round(v1_amount * 100)`

### JSON Fields
- v1: JSONB with arbitrary structure
- v2: Typed arrays/objects with Convex validators

### Boolean Defaults
- `is_professional_occupation`: FALSE → false
- `calendar_sync_enabled`: TRUE → true
- `is_favorite`: FALSE → false

## Migration Script Reference

```typescript
// Example transformation function
function transformCase(v1Case: V1Case): V2Case {
  return {
    // Convex generates _id automatically
    userId: lookupNewUserId(v1Case.user_id),
    caseName: v1Case.case_name,
    beneficiaryName: v1Case.beneficiary_name,
    currentStage: v1Case.current_stage,
    // Dates: ISO string → Unix timestamp
    pwdFilingDate: v1Case.pwd_filing_date
      ? new Date(v1Case.pwd_filing_date).getTime()
      : null,
    // Currency: dollars → cents
    pwdWageAmount: v1Case.pwd_wage_amount
      ? Math.round(v1Case.pwd_wage_amount * 100)
      : null,
    // ... continue for all fields
  };
}
```
```

Cover ALL fields from ALL tables. This is the reference for Phase 32 (Data Migration).
  </action>
  <verify>
- File exists at .planning/V2_FIELD_MAPPINGS.md
- All tables from V2_CONVEX_SCHEMA.md are covered
- Every field has v1 → v2 mapping
- Type transformations documented (dates, currency, JSON)
- Migration example code provided
  </verify>
  <done>Complete field mapping reference for data migration and API transformation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] V2_DESIGN_TOKENS.json exists and is valid JSON
- [ ] V2_FIELD_MAPPINGS.md exists with all tables covered
- [ ] Design tokens match source files (main.css, tailwind.config.js)
- [ ] Field mappings cover all 50+ case fields
- [ ] Special transformations documented (dates, currency)
- [ ] Both documents are ready for their respective phases (17, 32)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- V2_DESIGN_TOKENS.json ready for Phase 17 (Design System)
- V2_FIELD_MAPPINGS.md ready for Phase 32 (Data Migration)
- No missing fields or tokens
</success_criteria>

<output>
After completion, create `.planning/phases/14-schema-design-extraction/14-02-SUMMARY.md`:

# Phase 14 Plan 02: Design Tokens + Field Mappings Summary

**[One-liner: e.g., "Extracted 50+ design tokens and mapped 100+ fields from v1 → v2"]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `.planning/V2_DESIGN_TOKENS.json` - Complete design token system
- `.planning/V2_FIELD_MAPPINGS.md` - v1 → v2 field mappings

## Decisions Made
- [Naming conventions, type transformations]

## Issues Encountered
- [Any design inconsistencies found]

## Next Step
Phase 14 complete, ready for Phase 15 (Scaffold + Testing Infrastructure)
</output>
