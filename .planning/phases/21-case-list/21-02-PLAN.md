---
phase: 21-case-list
plan: 02
type: execute
---

<objective>
Build the CaseCard component with manila folder metaphor and hover-to-open animation.

Purpose: Create the signature v2 case card interaction — folders that "open" on hover to reveal details.
Output: Fully styled, animated CaseCard component with all badges, actions, and deadline display.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-case-list/21-CONTEXT.md
@perm_flow.md

**Prior Plan Summary:**
@.planning/phases/21-case-list/21-01-SUMMARY.md

**Design References (MUST READ):**
@.planning/FRONTEND_DESIGN_SKILL.md
@.planning/phases/17-design-system/design3
@.planning/phases/17-design-system/design4
@.planning/phases/17-design-system/design5
@v2/docs/DESIGN_SYSTEM.md

**Component Patterns:**
@v2/src/components/dashboard/RecentActivityCard.tsx
@v2/src/components/dashboard/UpcomingDeadlineItem.tsx
@v2/src/components/status/case-stage-badge.tsx
@v2/src/components/status/progress-status-badge.tsx
@v2/src/components/ui/card.tsx

**Data Types:**
@v2/convex/lib/caseListTypes.ts

**CRITICAL INSTRUCTIONS:**
All agents/subagents MUST read before implementation:
1. .planning/FRONTEND_DESIGN_SKILL.md
2. .planning/phases/17-design-system/design3, design4, design5
3. perm_flow.md (source of truth for statuses)
4. v2/docs/DESIGN_SYSTEM.md

Code must be: clean, organized, minimal, abstractable, scalable, maintainable, readable.
Fixes must be GLOBAL — no repeated code, abstract patterns into reusable utilities.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CaseCard base component with folder styling</name>
  <files>v2/src/components/cases/CaseCard.tsx, v2/src/components/cases/__tests__/CaseCard.test.tsx, v2/src/components/cases/index.ts</files>
  <exploration>
    Use Explore agent to understand:
    - Card component patterns in v2/src/components/ui/card.tsx
    - Badge component patterns (CaseStageBadge, ProgressStatusBadge)
    - Design tokens in globals.css (shadows, colors, borders)
  </exploration>
  <action>
TDD: Write tests FIRST, then implement.

Create CaseCard component following manila folder metaphor from 21-CONTEXT.md:

**Always Visible (Folder Tab):**
- Employer name on folder tab (bold, prominent)
- Position title below (smaller, muted)
- Badges row: Professional (if true), RFI Active (red), RFE Active (red)
- Case status badge (colored by stage using CaseStageBadge)
- Favorite star toggle button
- Calendar sync indicator (icon if enabled)
- Next critical deadline with urgency styling

**Folder Aesthetics:**
- Subtle paper texture via gradient/pattern (optional)
- Tab extends from top of card (asymmetric top border)
- Stage color as folder tab color (PWD blue, Recruitment purple, etc.)
- 4px black borders, hard shadow (shadow-hard)
- No border-radius (neobrutalist)

**Props Interface:**
```typescript
interface CaseCardProps {
  case: CaseCardData;
  isSelected?: boolean;
  onSelect?: (id: string) => void;
  selectionMode?: boolean;
}
```

Create test file with:
- Renders employer name and position
- Shows correct status badge
- Shows professional badge when applicable
- Shows RFI/RFE badges when active
- Shows favorite star (filled/unfilled)
- Shows calendar sync indicator
- Shows next deadline with urgency color
- Handles missing optional data gracefully
  </action>
  <verify>pnpm test v2/src/components/cases/__tests__/CaseCard.test.tsx passes</verify>
  <done>CaseCard base component renders correctly with all badges, tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Add hover-to-open animation with Framer Motion</name>
  <files>v2/src/components/cases/CaseCard.tsx, v2/src/components/cases/__tests__/CaseCard.test.tsx</files>
  <action>
TDD: Write tests FIRST (for expanded content), then implement animation.

Add hover interaction using Framer Motion:

**On Hover (Folder Opens):**
1. Card lifts and shadow expands (transition: 200ms ease)
2. Folder "opens" — height expands to reveal detailed content
3. Smooth Framer Motion animation:
   - `initial={{ height: "auto", y: 0 }}`
   - `whileHover={{ y: -4, boxShadow: "8px 8px 0px #000" }}`
   - AnimatePresence for expanded content

**Expanded Content (visible on hover):**
- Section divider line
- Detailed dates grid:
  - PWD: Filed, Determined, Expires
  - Recruitment: Started, Expires
  - ETA 9089: Window Opens, Filed, Certified, Expires
  - I-140: Filed, Approved
- Progress status badge
- Case notes preview (truncated if long)

**Animation Specs:**
- Lift: -4px translateY
- Shadow: shadow-hard → shadow-hard-lg
- Content: fade in (opacity 0→1), slide down (height animation)
- Duration: 200ms ease-out
- Use `layoutId` for smooth layout animations

Add tests for:
- Expanded content not visible initially
- Expanded content structure (date sections)
- Progress status shown in expanded view
  </action>
  <verify>pnpm test v2/src/components/cases/__tests__/CaseCard.test.tsx passes</verify>
  <done>Hover animation smooth, expanded content displays correctly</done>
</task>

<task type="auto">
  <name>Task 3: Add action buttons and selection checkbox</name>
  <files>v2/src/components/cases/CaseCard.tsx, v2/src/components/cases/__tests__/CaseCard.test.tsx</files>
  <action>
TDD: Write tests FIRST, then implement.

Add action buttons at bottom of card:

**Action Buttons Layout (per 21-CONTEXT.md):**
- View (primary) → Link to /cases/[id]
- Edit → Link to /cases/[id]/edit
- More menu (...) containing:
  - Delete → triggers confirmation
  - Close/Archive → triggers confirmation

**Button Styling:**
- View: Primary button (green bg, black border)
- Edit: Secondary button (white bg, black border)
- More: Icon button with dropdown menu

**Selection Mode:**
- When selectionMode=true, show checkbox in top-left corner
- Checkbox styled as neobrutalist (black border, green check)
- isSelected prop controls checked state
- onSelect callback fires on checkbox click

Add tests for:
- View button links to correct route
- Edit button links to correct route
- Delete option in menu
- Archive option in menu
- Selection checkbox appears in selection mode
- Selection checkbox hidden when not in selection mode
- onSelect called when checkbox clicked
  </action>
  <verify>pnpm test v2/src/components/cases/__tests__/CaseCard.test.tsx passes</verify>
  <done>All actions work, selection mode toggles correctly</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>CaseCard component with manila folder metaphor, hover animation, and action buttons</what-built>
  <how-to-verify>
    1. Run: cd v2 && pnpm dev
    2. Visit: http://localhost:3000/cases (may need test data)
    3. Verify folder styling:
       - Tab at top with stage color
       - 4px black borders, hard shadow
       - Employer name prominent, position below
       - All badges visible (status, professional, RFI/RFE)
    4. Hover over a card:
       - Card lifts smoothly (-4px)
       - Shadow expands
       - Content slides open revealing dates
       - Animation is smooth (200ms, no jank)
    5. Check action buttons:
       - View and Edit visible
       - More menu opens with Delete/Archive
    6. Check responsive layout (resize window)
    7. Check dark mode compatibility
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm test` passes all CaseCard tests
- [ ] `pnpm build` succeeds without errors
- [ ] No TypeScript errors
- [ ] Framer Motion animations smooth
- [ ] Human verification checkpoint passed
</verification>

<success_criteria>
- All 4 tasks completed (including human checkpoint)
- All verification checks pass
- Manila folder metaphor implemented
- Hover-to-open animation is smooth and delightful
- All badges display correctly
- Action buttons functional
- Selection mode works
- Visual design approved by user
</success_criteria>

<output>
After completion, create `.planning/phases/21-case-list/21-02-SUMMARY.md`:

# Phase 21-02: Case Card Component Summary

**[Substantive one-liner]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Ready for 21-03-PLAN.md (Case List Page & Filters)
</output>
