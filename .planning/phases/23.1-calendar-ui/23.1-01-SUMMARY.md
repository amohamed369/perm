# Phase 23.1 Plan 01: Calendar Data Layer Summary

**react-big-calendar with date-fns localizer, CalendarEvent types with urgency/stage colors, event mapper reusing timeline milestones, Convex calendar queries with preference persistence**

## Performance

- **Duration:** 51 min
- **Started:** 2025-12-28T15:52:42Z
- **Completed:** 2025-12-28T16:44:31Z
- **Tasks:** 3
- **Files modified:** 6

## Accomplishments

- Installed react-big-calendar 1.19.4 with type definitions
- Created date-fns v4 localizer with tree-shaking optimized imports
- Defined CalendarEvent type with stage, urgency, deadlineType fields
- Built caseToCalendarEvents mapper reusing extractMilestones for consistency
- Added 32 TDD tests for event mapper (urgency boundaries, title formatting, filing windows)
- Created Convex getCalendarEvents, getCalendarPreferences, updateCalendarPreferences
- Added calendarHiddenCases and calendarHiddenDeadlineTypes to userProfiles schema
- 16 new Convex calendar tests, all passing

## Files Created/Modified

- `v2/package.json` - Added react-big-calendar 1.19.4, @types/react-big-calendar 1.16.3
- `v2/src/lib/calendar/localizer.ts` - date-fns v4 localizer with en-US locale
- `v2/src/lib/calendar/types.ts` - CalendarEvent, DeadlineType, Urgency types and color mappings
- `v2/src/lib/calendar/event-mapper.ts` - caseToCalendarEvents() using extractMilestones
- `v2/src/lib/calendar/event-mapper.test.ts` - 32 tests for event mapper
- `v2/convex/calendar.ts` - getCalendarEvents, getCalendarPreferences, updateCalendarPreferences
- `v2/convex/calendar.test.ts` - 16 Convex calendar tests
- `v2/convex/schema.ts` - Added calendarHiddenCases, calendarHiddenDeadlineTypes to userProfiles

## Decisions Made

- **date-fns v4 named exports:** Reference pattern showed default imports but date-fns v4 uses named exports - adjusted accordingly
- **Reused extractMilestones:** Event mapper delegates to timeline/milestones.ts for consistency between timeline and calendar views
- **Filing windows as events:** "Ready to File" and "Filing Deadline" calculated milestones become filingWindowOpens/Closes events with isFilingWindow=true
- **Urgency thresholds:** Overdue (<0), Urgent (0-7 days), Soon (8-30 days), Normal (31+ days)
- **Title format:** "Label: LastName FirstInitial." (e.g., "PWD Exp: Smith J.")

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## Next Phase Readiness

Ready for 23.1-02-PLAN.md (Calendar View Component)

---
*Phase: 23.1-calendar-ui*
*Completed: 2025-12-28*
