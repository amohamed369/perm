# Phase 23.1: Calendar View Page - Research

**Researched:** 2025-12-28
**Domain:** React calendar components for deadline visualization
**Confidence:** HIGH

<research_summary>
## Summary

Researched the React calendar ecosystem for building an in-app calendar view for PERM case deadlines. The standard approach uses **react-big-calendar** with the **date-fns localizer** for date handling.

Key findings:
1. react-big-calendar is the most established React calendar library with 164 code examples in Context7
2. date-fns is already in the v2 project - use `dateFnsLocalizer` for seamless integration
3. Custom styling requires CSS overrides on `.rbc-*` classes - can achieve neobrutalist look
4. Mobile is a known weakness - consider list view fallback for small screens
5. Schedule-X is a modern alternative worth considering for cleaner architecture

**Primary recommendation:** Use react-big-calendar with date-fns localizer. Override default styles via Tailwind/CSS to match neobrutalist design. Add custom event/toolbar components for full control. Implement mobile list view fallback.
</research_summary>

<standard_stack>
## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| react-big-calendar | ^1.19.4 | Event calendar component | Most established React calendar, flexbox-based, multiple views |
| date-fns | ^4.1.0 | Date manipulation | Already in v2, lightweight, tree-shakeable |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| @types/react-big-calendar | ^1.12.2 | TypeScript types | TypeScript projects (we use strict mode) |
| framer-motion | ^12.23.26 | Animations | Already in v2, for event transitions |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| react-big-calendar | Schedule-X | Schedule-X is newer/cleaner but less established, uses Temporal API which needs polyfill |
| react-big-calendar | FullCalendar | FullCalendar is larger (~45kb), has licensing concerns for premium features |
| date-fns | dayjs | dayjs is smaller but date-fns already in project |
| date-fns | moment.js | moment is deprecated and large, avoid |

**Installation:**
```bash
pnpm add react-big-calendar @types/react-big-calendar
# date-fns already installed
```
</standard_stack>

<architecture_patterns>
## Architecture Patterns

### Recommended Project Structure
```
v2/src/
├── components/
│   └── calendar/
│       ├── CalendarPage.tsx           # Main page component
│       ├── CalendarView.tsx           # react-big-calendar wrapper
│       ├── CalendarToolbar.tsx        # Custom toolbar (neobrutalist)
│       ├── CalendarEvent.tsx          # Custom event rendering
│       ├── CalendarEventPopover.tsx   # Event detail popover
│       ├── CalendarFilters.tsx        # Filter bar
│       ├── CalendarMobileList.tsx     # Mobile fallback view
│       └── useCalendarEvents.ts       # Hook for event data
├── lib/
│   └── calendar/
│       ├── localizer.ts               # date-fns localizer setup
│       ├── event-formatter.ts         # Case → calendar event mapping
│       └── visibility-filter.ts       # Hidden cases/deadlines logic
└── app/
    └── (authenticated)/
        └── calendar/
            └── page.tsx               # Route entry point
```

### Pattern 1: date-fns Localizer Setup
**What:** Configure react-big-calendar with date-fns for date handling
**When to use:** Always - required for calendar to work
**Example:**
```typescript
// Source: Context7 /jquense/react-big-calendar
import { Calendar, dateFnsLocalizer } from 'react-big-calendar'
import format from 'date-fns/format'
import parse from 'date-fns/parse'
import startOfWeek from 'date-fns/startOfWeek'
import getDay from 'date-fns/getDay'
import enUS from 'date-fns/locale/en-US'
import 'react-big-calendar/lib/css/react-big-calendar.css'

const locales = { 'en-US': enUS }

const localizer = dateFnsLocalizer({
  format,
  parse,
  startOfWeek,
  getDay,
  locales,
})

// Usage
<Calendar
  localizer={localizer}
  events={events}
  startAccessor="start"
  endAccessor="end"
  style={{ height: 600 }}
/>
```

### Pattern 2: Custom Event Rendering
**What:** Replace default event display with custom component
**When to use:** When you need custom styling or additional data display
**Example:**
```typescript
// Source: Context7 /jquense/react-big-calendar
const CustomEvent = ({ event }) => (
  <div className="flex items-center gap-1">
    <span className="w-2 h-2 rounded-full" style={{ backgroundColor: event.stageColor }} />
    <strong className="truncate">{event.title}</strong>
  </div>
)

const components = useMemo(() => ({
  event: CustomEvent,
  toolbar: CustomToolbar,
  agenda: { event: CustomAgendaEvent }
}), [])

<Calendar components={components} />
```

### Pattern 3: Event Styling with eventPropGetter
**What:** Dynamically style events based on their properties
**When to use:** Color-coding by stage, urgency indicators
**Example:**
```typescript
// Source: Context7 /jquense/react-big-calendar
const eventStyleGetter = (event, start, end, isSelected) => {
  const style = {
    backgroundColor: event.stageColor || '#3174ad',
    borderRadius: '0', // neobrutalist: no rounded corners
    border: '2px solid #000',
    boxShadow: isSelected ? '4px 4px 0 #000' : '2px 2px 0 #000',
    color: '#000',
    fontWeight: 'bold',
  }
  return { style, className: `event-${event.deadlineType}` }
}

<Calendar eventPropGetter={eventStyleGetter} />
```

### Pattern 4: View Configuration
**What:** Configure which views are available
**When to use:** Always - define month/week/day views
**Example:**
```typescript
// Source: Context7 /jquense/react-big-calendar
<Calendar
  views={['month', 'week', 'day']}
  defaultView="month"
  toolbar={true}
/>
```

### Anti-Patterns to Avoid
- **Importing entire date-fns:** Use specific imports (`date-fns/format`) for tree-shaking
- **Custom date math:** Let localizer handle all date calculations
- **Inline styles everywhere:** Use eventPropGetter and CSS classes instead
- **Ignoring mobile:** Calendar UX breaks on small screens - need fallback
- **No height on container:** Calendar won't render without explicit height
</architecture_patterns>

<dont_hand_roll>
## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Event positioning/overlap | Custom overlap algorithm | react-big-calendar built-in | Complex algorithm for multi-day events, overlaps |
| View navigation | Manual date math | Calendar navigation callbacks | Edge cases with month boundaries, DST |
| Date formatting | Custom format functions | date-fns format with localizer | i18n, localization, format tokens |
| Week boundaries | Manual calculation | `startOfWeek` from date-fns | First day of week varies by locale |
| Month grid | Custom CSS grid | react-big-calendar Month view | Handles variable weeks per month |
| Drag-to-reschedule | react-beautiful-dnd | Skip entirely | Not needed - deadlines are calculated |

**Key insight:** react-big-calendar has solved calendar layout problems that took years to get right. Positioning overlapping events, handling different month lengths, DST transitions, and locale-specific week starts are all handled. Focus styling efforts on the components prop and CSS overrides, not reimplementing the calendar grid.
</dont_hand_roll>

<common_pitfalls>
## Common Pitfalls

### Pitfall 1: No Height on Container
**What goes wrong:** Calendar renders as 0px height, nothing visible
**Why it happens:** Flexbox needs explicit height to calculate layout
**How to avoid:** Always set `style={{ height: 600 }}` or use CSS `height: 100%` with parent height
**Warning signs:** Empty calendar area, no content rendered

### Pitfall 2: Mobile Touch Events Not Working
**What goes wrong:** `onSelectSlot` doesn't fire on mobile tap
**Why it happens:** Library defaults optimize for mouse, not touch
**How to avoid:** Add `longPressThreshold={1}` prop for mobile responsiveness
**Warning signs:** Desktop works, mobile doesn't respond to taps

### Pitfall 3: Performance with Many Events (40+)
**What goes wrong:** Navigation becomes laggy, UI stutters
**Why it happens:** All events render in Month view without virtualization
**How to avoid:** Paginate events by visible date range, use `onRangeChange` to fetch only needed events
**Warning signs:** Slow next/prev month transitions

### Pitfall 4: Wrong Date Token Usage
**What goes wrong:** Dates formatted incorrectly (e.g., "2018-10-283" instead of "2018-10-28")
**Why it happens:** Confusing `YYYY` (week-based year) with `yyyy` (calendar year)
**How to avoid:** Use lowercase tokens: `yyyy-MM-dd`, not `YYYY-MM-DD`
**Warning signs:** Dates look wrong, especially around year boundaries

### Pitfall 5: Styling Conflicts with Default CSS
**What goes wrong:** Neobrutalist styles clash with react-big-calendar defaults
**Why it happens:** Default CSS has specific selectors that override custom styles
**How to avoid:** Import base CSS first, then override with higher specificity or `!important`
**Warning signs:** Styles not applying, rounded corners appearing

### Pitfall 6: Keyboard Accessibility Gaps
**What goes wrong:** Users can't navigate calendar with keyboard alone
**Why it happens:** `onSelectEvent` only fires on click, not Enter key
**How to avoid:** Add `onKeyPressEvent` handler, ensure tab navigation works
**Warning signs:** Accessibility audit failures, keyboard users can't select events
</common_pitfalls>

<code_examples>
## Code Examples

Verified patterns from official sources:

### Basic Calendar Setup with date-fns
```typescript
// Source: Context7 /jquense/react-big-calendar
import { Calendar, dateFnsLocalizer, Views } from 'react-big-calendar'
import format from 'date-fns/format'
import parse from 'date-fns/parse'
import startOfWeek from 'date-fns/startOfWeek'
import getDay from 'date-fns/getDay'
import enUS from 'date-fns/locale/en-US'
import 'react-big-calendar/lib/css/react-big-calendar.css'

const locales = { 'en-US': enUS }

const localizer = dateFnsLocalizer({
  format,
  parse,
  startOfWeek,
  getDay,
  locales,
})

interface CalendarEvent {
  id: string
  title: string
  start: Date
  end: Date
  stageColor: string
  caseId: string
  deadlineType: string
}

export function DeadlineCalendar({ events }: { events: CalendarEvent[] }) {
  return (
    <Calendar<CalendarEvent>
      localizer={localizer}
      events={events}
      startAccessor="start"
      endAccessor="end"
      views={[Views.MONTH, Views.WEEK, Views.DAY]}
      defaultView={Views.MONTH}
      style={{ height: 600 }}
    />
  )
}
```

### Custom Toolbar Component
```typescript
// Source: Context7 /jquense/react-big-calendar (adapted for neobrutalist)
import { ToolbarProps, Navigate } from 'react-big-calendar'
import { Button } from '@/components/ui/button'

export function CalendarToolbar({ label, onNavigate, onView, view }: ToolbarProps) {
  return (
    <div className="flex items-center justify-between p-4 border-b-2 border-black">
      <div className="flex gap-2">
        <Button
          variant="outline"
          onClick={() => onNavigate(Navigate.PREVIOUS)}
        >
          Previous
        </Button>
        <Button
          variant="outline"
          onClick={() => onNavigate(Navigate.TODAY)}
        >
          Today
        </Button>
        <Button
          variant="outline"
          onClick={() => onNavigate(Navigate.NEXT)}
        >
          Next
        </Button>
      </div>

      <span className="font-heading text-2xl font-bold">{label}</span>

      <div className="flex gap-2">
        <Button
          variant={view === 'month' ? 'default' : 'outline'}
          onClick={() => onView('month')}
        >
          Month
        </Button>
        <Button
          variant={view === 'week' ? 'default' : 'outline'}
          onClick={() => onView('week')}
        >
          Week
        </Button>
        <Button
          variant={view === 'day' ? 'default' : 'outline'}
          onClick={() => onView('day')}
        >
          Day
        </Button>
      </div>
    </div>
  )
}
```

### Event Style Getter for Stage Colors
```typescript
// Source: Context7 /jquense/react-big-calendar (adapted for PERM stages)
import { EventPropGetter } from 'react-big-calendar'

const STAGE_COLORS = {
  pwd: '#0066FF',
  recruitment: '#9333ea',
  eta9089: '#D97706',
  i140: '#059669',
  closed: '#6B7280',
}

const URGENCY_STYLES = {
  urgent: { borderLeft: '4px solid #DC2626' },  // ≤7 days
  soon: { borderLeft: '4px solid #EA580C' },    // 8-30 days
  normal: { borderLeft: '4px solid #059669' },  // 30+ days
}

export const eventStyleGetter: EventPropGetter<CalendarEvent> = (event, start, end, isSelected) => {
  const stageColor = STAGE_COLORS[event.stage] || '#3174ad'

  return {
    style: {
      backgroundColor: stageColor,
      border: '2px solid #000',
      borderRadius: '0',
      boxShadow: isSelected ? '4px 4px 0 #000' : '2px 2px 0 #000',
      color: '#fff',
      fontWeight: 600,
      transform: isSelected ? 'translate(-2px, -2px)' : 'none',
      transition: 'all 150ms ease',
      ...URGENCY_STYLES[event.urgency],
    },
    className: `event-${event.deadlineType}`,
  }
}
```

### Case Deadline to Calendar Event Mapper
```typescript
// Custom utility for PERM deadlines
import { format, parseISO } from 'date-fns'

interface Case {
  _id: string
  caseNumber: string
  beneficiaryIdentifier: string
  caseStatus: string
  pwdExpirationDate?: string
  eta9089FilingDeadline?: string
  i140FilingDeadline?: string
  // ... other fields
}

interface CalendarEvent {
  id: string
  title: string
  start: Date
  end: Date
  allDay: boolean
  caseId: string
  deadlineType: string
  stage: string
  urgency: 'urgent' | 'soon' | 'normal'
}

export function caseToCalendarEvents(caseData: Case): CalendarEvent[] {
  const events: CalendarEvent[] = []

  const addEvent = (type: string, dateStr: string | undefined) => {
    if (!dateStr) return

    const date = parseISO(dateStr)
    const daysUntil = Math.ceil((date.getTime() - Date.now()) / (1000 * 60 * 60 * 24))

    events.push({
      id: `${caseData._id}-${type}`,
      title: `${type}: ${caseData.beneficiaryIdentifier}`,
      start: date,
      end: date,
      allDay: true,
      caseId: caseData._id,
      deadlineType: type,
      stage: caseData.caseStatus,
      urgency: daysUntil <= 7 ? 'urgent' : daysUntil <= 30 ? 'soon' : 'normal',
    })
  }

  addEvent('PWD Exp', caseData.pwdExpirationDate)
  addEvent('ETA Filing', caseData.eta9089FilingDeadline)
  addEvent('I-140', caseData.i140FilingDeadline)
  // ... add other deadline types

  return events
}
```
</code_examples>

<sota_updates>
## State of the Art (2024-2025)

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| moment.js localizer | date-fns localizer | 2022+ | moment is deprecated, date-fns is tree-shakeable |
| CSS-only styling | components prop | Always available | Full control over rendering |
| Manual drag-drop | Skip for read-only | N/A | Deadlines are calculated, not manually set |

**New tools/patterns to consider:**
- **Schedule-X:** Modern alternative with Temporal API, cleaner architecture. Consider for future if react-big-calendar has issues.
- **CSS custom properties:** Requested in GitHub issues for easier theming without SASS

**Deprecated/outdated:**
- **moment.js:** Use date-fns or dayjs instead
- **SASS variables for styling:** Can override with CSS classes instead
- **IE10 support:** No longer needed, can use modern CSS
</sota_updates>

<open_questions>
## Open Questions

Things that couldn't be fully resolved:

1. **Bundle size comparison**
   - What we know: react-big-calendar is ~25kb gzipped, FullCalendar is ~45kb
   - What's unclear: Schedule-X bundle size not found in research
   - Recommendation: Proceed with react-big-calendar, monitor bundle size during implementation

2. **React 19 compatibility**
   - What we know: GitHub issue #2701 requests React 19 support (Dec 2024)
   - What's unclear: Current v1.19.4 compatibility status with React 19
   - Recommendation: v2 currently uses React 19.2.3 - test during implementation, may need to wait for library update

3. **Keyboard accessibility completeness**
   - What we know: Some keyboard navigation works, but gaps exist (Enter on events, "+n more" navigation)
   - What's unclear: Full WCAG compliance status
   - Recommendation: Add custom keyboard handlers, test with screen reader, document limitations
</open_questions>

<sources>
## Sources

### Primary (HIGH confidence)
- Context7 /jquense/react-big-calendar - 164 code examples, setup, customization, localizers
- Context7 /date-fns/date-fns - 58 code examples, formatting, locale handling
- Context7 /schedule-x/schedule-x - 289 code examples, alternative library research

### Secondary (MEDIUM confidence)
- [GitHub: lramos33/big-calendar](https://github.com/lramos33/big-calendar) - Next.js + Tailwind implementation example
- [GitHub: react-big-calendar issues](https://github.com/jquense/react-big-calendar/issues) - Performance, mobile, React 19 discussions
- [Builder.io: Best React calendar components 2025](https://www.builder.io/blog/best-react-calendar-component-ai) - Library comparison

### Tertiary (LOW confidence - needs validation)
- [Medium: React Calendar with Tailwind](https://medium.com/@brunmoira/implementation-and-customization-of-react-calendar-with-tailwind-0cf9f9e7f5f6) - Styling approach (not react-big-calendar specific)
</sources>

<metadata>
## Metadata

**Research scope:**
- Core technology: react-big-calendar
- Ecosystem: date-fns localizer, TypeScript types
- Patterns: Custom components, event styling, view configuration
- Pitfalls: Height, mobile, performance, styling

**Confidence breakdown:**
- Standard stack: HIGH - verified with Context7, npm registry
- Architecture: HIGH - from official docs and examples
- Pitfalls: HIGH - from GitHub issues, community discussions
- Code examples: HIGH - from Context7/official sources

**Research date:** 2025-12-28
**Valid until:** 2026-01-28 (30 days - react-big-calendar ecosystem stable)
</metadata>

---

*Phase: 23.1-calendar-ui*
*Research completed: 2025-12-28*
*Ready for planning: yes*
