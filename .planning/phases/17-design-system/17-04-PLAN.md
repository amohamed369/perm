---
phase: 17-design-system
plan: 04
type: execute
domain: frontend-design
---

<critical_requirement>
**MANDATORY SUBAGENT INSTRUCTION**: When using the Task tool to spawn ANY subagent for frontend/UI work in this plan, you MUST include this instruction in the subagent's prompt:

"BEFORE doing any work, you MUST read /Users/adammohamed/cc/perm-tracker-test/.planning/FRONTEND_DESIGN_SKILL.md in its entirety and apply all design principles from that document. This file contains critical design guidance for PERM Tracker v2 including neobrutalist styling, color tokens, and typography requirements. Do not proceed until you have read and internalized this skill."

This is a BLOCKING requirement. Every Task tool call for UI/frontend work must include this instruction.
</critical_requirement>

<objective>
Set up Storybook 10, create stories for all components, and verify design system via Human Checkpoint.

Purpose: Provide a visual catalog of all components for review and ongoing development. This enables the Human Checkpoint review where the user approves the component library before proceeding.
Output: Working Storybook at localhost:6006 with stories for all UI and status components.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/FRONTEND_DESIGN_SKILL.md
@.planning/phases/17-design-system/17-CONTEXT.md
@.planning/phases/17-design-system/17-RESEARCH.md
@.planning/phases/17-design-system/17-01-SUMMARY.md
@.planning/phases/17-design-system/17-02-SUMMARY.md
@.planning/phases/17-design-system/17-03-SUMMARY.md

**Prior plan completion:**
- 17-01: Foundation (deps, theme, CSS tokens)
- 17-02: Core UI (Button, Card, Badge, Input, Label, Dialog, Toast)
- 17-03: Status components (CaseStageBadge, UrgencyIndicator, DeadlineIndicator, ProgressStatusBadge)

**From RESEARCH.md:**
- Use Storybook 10 (NOT Storybook 9 - doesn't support Next.js 16)
- Install with: `npx storybook@latest init`
- Use `@storybook/nextjs` package
- Stories use CSF format with `satisfies Meta<typeof Component>`
- Dark mode can be toggled via `parameters.backgrounds` or theme addon
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Storybook 10 for Next.js</name>
  <files>v2/.storybook/main.ts, v2/.storybook/preview.ts, v2/package.json</files>
  <action>
Initialize Storybook 10:

```bash
cd v2
npx storybook@latest init --skip-install
npm install
```

This will:
1. Detect Next.js and install @storybook/nextjs
2. Create .storybook/ configuration directory
3. Add storybook scripts to package.json

After initialization, verify and update .storybook/main.ts:

```typescript
// v2/.storybook/main.ts
import type { StorybookConfig } from "@storybook/nextjs"

const config: StorybookConfig = {
  stories: [
    "../src/**/*.mdx",
    "../src/**/*.stories.@(js|jsx|mjs|ts|tsx)",
  ],
  addons: [
    "@storybook/addon-essentials",
    "@storybook/addon-onboarding",
    "@storybook/addon-interactions",
    "@storybook/addon-themes",
  ],
  framework: {
    name: "@storybook/nextjs",
    options: {
      nextConfigPath: "../next.config.ts",
    },
  },
  staticDirs: ["../public"],
}

export default config
```

Update .storybook/preview.ts to include globals.css and theme support:

```typescript
// v2/.storybook/preview.ts
import type { Preview } from "@storybook/nextjs"
import "../src/app/globals.css"

const preview: Preview = {
  parameters: {
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },
    nextjs: {
      appDirectory: true,
    },
    backgrounds: {
      default: "light",
      values: [
        { name: "light", value: "#FAFAFA" },
        { name: "dark", value: "#1A1A1A" },
      ],
    },
  },
  decorators: [
    (Story, context) => {
      // Apply dark class when dark background is selected
      const isDark = context.globals.backgrounds?.value === "#1A1A1A"
      return (
        <div className={isDark ? "dark" : ""}>
          <Story />
        </div>
      )
    },
  ],
}

export default preview
```

Install themes addon if not auto-installed:
```bash
npm install @storybook/addon-themes --save-dev
```
  </action>
  <verify>npm run storybook (should start without errors, may have no stories yet)</verify>
  <done>Storybook 10 initialized with Next.js support, globals.css loaded, dark mode background toggle</done>
</task>

<task type="auto">
  <name>Task 2: Create stories for core UI components</name>
  <files>v2/src/components/ui/button.stories.tsx, v2/src/components/ui/card.stories.tsx, v2/src/components/ui/badge.stories.tsx, v2/src/components/ui/input.stories.tsx</files>
  <action>
Create stories directory structure and write stories for core components.

**Button stories (v2/src/components/ui/button.stories.tsx):**
```typescript
import type { Meta, StoryObj } from "@storybook/nextjs"
import { Button } from "./button"

const meta = {
  title: "UI/Button",
  component: Button,
  parameters: { layout: "centered" },
  tags: ["autodocs"],
  argTypes: {
    variant: {
      control: "select",
      options: ["default", "destructive", "outline", "secondary", "ghost", "link"],
    },
    size: {
      control: "select",
      options: ["default", "sm", "lg", "icon"],
    },
  },
} satisfies Meta<typeof Button>

export default meta
type Story = StoryObj<typeof meta>

export const Default: Story = { args: { children: "Button" } }
export const Secondary: Story = { args: { children: "Secondary", variant: "secondary" } }
export const Destructive: Story = { args: { children: "Delete", variant: "destructive" } }
export const Outline: Story = { args: { children: "Outline", variant: "outline" } }
export const Ghost: Story = { args: { children: "Ghost", variant: "ghost" } }
export const Link: Story = { args: { children: "Link", variant: "link" } }
export const Small: Story = { args: { children: "Small", size: "sm" } }
export const Large: Story = { args: { children: "Large", size: "lg" } }
export const Disabled: Story = { args: { children: "Disabled", disabled: true } }

export const AllVariants: Story = {
  render: () => (
    <div className="flex flex-wrap gap-4">
      <Button>Default</Button>
      <Button variant="secondary">Secondary</Button>
      <Button variant="destructive">Destructive</Button>
      <Button variant="outline">Outline</Button>
      <Button variant="ghost">Ghost</Button>
      <Button variant="link">Link</Button>
    </div>
  ),
}
```

**Card stories (v2/src/components/ui/card.stories.tsx):**
```typescript
import type { Meta, StoryObj } from "@storybook/nextjs"
import { Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter } from "./card"
import { Button } from "./button"

const meta = {
  title: "UI/Card",
  component: Card,
  parameters: { layout: "centered" },
  tags: ["autodocs"],
} satisfies Meta<typeof Card>

export default meta
type Story = StoryObj<typeof meta>

export const Default: Story = {
  render: () => (
    <Card className="w-[350px]">
      <CardHeader>
        <CardTitle>Card Title</CardTitle>
        <CardDescription>Card description goes here</CardDescription>
      </CardHeader>
      <CardContent>
        <p>Card content with neobrutalist hard shadow styling.</p>
      </CardContent>
      <CardFooter>
        <Button>Action</Button>
      </CardFooter>
    </Card>
  ),
}
```

**Badge stories (v2/src/components/ui/badge.stories.tsx):**
```typescript
import type { Meta, StoryObj } from "@storybook/nextjs"
import { Badge } from "./badge"

const meta = {
  title: "UI/Badge",
  component: Badge,
  parameters: { layout: "centered" },
  tags: ["autodocs"],
} satisfies Meta<typeof Badge>

export default meta
type Story = StoryObj<typeof meta>

export const Default: Story = { args: { children: "Badge" } }
export const Secondary: Story = { args: { children: "Secondary", variant: "secondary" } }
export const Destructive: Story = { args: { children: "Error", variant: "destructive" } }
export const Outline: Story = { args: { children: "Outline", variant: "outline" } }
```

**Input stories (v2/src/components/ui/input.stories.tsx):**
```typescript
import type { Meta, StoryObj } from "@storybook/nextjs"
import { Input } from "./input"
import { Label } from "./label"

const meta = {
  title: "UI/Input",
  component: Input,
  parameters: { layout: "centered" },
  tags: ["autodocs"],
} satisfies Meta<typeof Input>

export default meta
type Story = StoryObj<typeof meta>

export const Default: Story = { args: { placeholder: "Enter text..." } }
export const WithLabel: Story = {
  render: () => (
    <div className="grid w-full max-w-sm gap-1.5">
      <Label htmlFor="email">Email</Label>
      <Input type="email" id="email" placeholder="Email" />
    </div>
  ),
}
export const Disabled: Story = { args: { placeholder: "Disabled", disabled: true } }
```
  </action>
  <verify>npm run storybook -- --smoke-test (validates stories compile)</verify>
  <done>4 story files created for Button, Card, Badge, Input with multiple variants each</done>
</task>

<task type="auto">
  <name>Task 3: Create stories for status components</name>
  <files>v2/src/components/status/case-stage-badge.stories.tsx, v2/src/components/status/urgency-indicator.stories.tsx, v2/src/components/status/deadline-indicator.stories.tsx, v2/src/components/status/progress-status-badge.stories.tsx</files>
  <action>
Create stories for all status components.

**CaseStageBadge stories:**
```typescript
import type { Meta, StoryObj } from "@storybook/nextjs"
import { CaseStageBadge } from "./case-stage-badge"

const meta = {
  title: "Status/CaseStageBadge",
  component: CaseStageBadge,
  parameters: { layout: "centered" },
  tags: ["autodocs"],
  argTypes: {
    stage: {
      control: "select",
      options: ["pwd", "recruitment", "eta9089", "i140", "closed"],
    },
  },
} satisfies Meta<typeof CaseStageBadge>

export default meta
type Story = StoryObj<typeof meta>

export const PWD: Story = { args: { stage: "pwd" } }
export const Recruitment: Story = { args: { stage: "recruitment" } }
export const ETA9089: Story = { args: { stage: "eta9089" } }
export const I140: Story = { args: { stage: "i140" } }
export const Closed: Story = { args: { stage: "closed" } }

export const AllStages: Story = {
  render: () => (
    <div className="flex flex-wrap gap-2">
      <CaseStageBadge stage="pwd" />
      <CaseStageBadge stage="recruitment" />
      <CaseStageBadge stage="eta9089" />
      <CaseStageBadge stage="i140" />
      <CaseStageBadge stage="closed" />
    </div>
  ),
}
```

**UrgencyIndicator stories:**
```typescript
import type { Meta, StoryObj } from "@storybook/nextjs"
import { UrgencyIndicator } from "./urgency-indicator"

const meta = {
  title: "Status/UrgencyIndicator",
  component: UrgencyIndicator,
  parameters: { layout: "centered" },
  tags: ["autodocs"],
} satisfies Meta<typeof UrgencyIndicator>

export default meta
type Story = StoryObj<typeof meta>

export const Urgent: Story = { args: { level: "urgent", daysUntil: 3 } }
export const Soon: Story = { args: { level: "soon", daysUntil: 14 } }
export const Normal: Story = { args: { level: "normal", daysUntil: 45 } }
export const UrgentPulsing: Story = {
  args: { level: "urgent", daysUntil: 1 },
  parameters: { docs: { description: { story: "Urgent level pulses to draw attention" } } },
}
```

**DeadlineIndicator stories:**
```typescript
import type { Meta, StoryObj } from "@storybook/nextjs"
import { DeadlineIndicator } from "./deadline-indicator"
import { format, addDays } from "date-fns"

const meta = {
  title: "Status/DeadlineIndicator",
  component: DeadlineIndicator,
  parameters: { layout: "centered" },
  tags: ["autodocs"],
} satisfies Meta<typeof DeadlineIndicator>

export default meta
type Story = StoryObj<typeof meta>

const today = new Date()
const formatDate = (date: Date) => format(date, "yyyy-MM-dd")

export const Urgent: Story = {
  args: { deadline: formatDate(addDays(today, 3)), label: "PWD Expires" },
}
export const Soon: Story = {
  args: { deadline: formatDate(addDays(today, 20)), label: "Filing Window Closes" },
}
export const Normal: Story = {
  args: { deadline: formatDate(addDays(today, 60)), label: "I-140 Deadline" },
}
export const Overdue: Story = {
  args: { deadline: formatDate(addDays(today, -5)), label: "OVERDUE" },
}
```

**ProgressStatusBadge stories:**
```typescript
import type { Meta, StoryObj } from "@storybook/nextjs"
import { ProgressStatusBadge } from "./progress-status-badge"

const meta = {
  title: "Status/ProgressStatusBadge",
  component: ProgressStatusBadge,
  parameters: { layout: "centered" },
  tags: ["autodocs"],
} satisfies Meta<typeof ProgressStatusBadge>

export default meta
type Story = StoryObj<typeof meta>

export const NotStarted: Story = { args: { status: "not_started" } }
export const InProgress: Story = { args: { status: "in_progress" } }
export const Complete: Story = { args: { status: "complete" } }
export const WaitingResponse: Story = { args: { status: "waiting_response" } }
export const RequiresAttention: Story = { args: { status: "requires_attention" } }
export const OnHold: Story = { args: { status: "on_hold" } }

export const AllStatuses: Story = {
  render: () => (
    <div className="flex flex-wrap gap-2">
      <ProgressStatusBadge status="not_started" />
      <ProgressStatusBadge status="in_progress" />
      <ProgressStatusBadge status="complete" />
      <ProgressStatusBadge status="waiting_response" />
      <ProgressStatusBadge status="requires_attention" />
      <ProgressStatusBadge status="on_hold" />
    </div>
  ),
}
```
  </action>
  <verify>npm run storybook -- --smoke-test</verify>
  <done>4 status component story files created with all variants displayed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete design system component library with Storybook catalog</what-built>
  <how-to-verify>
    1. Start Storybook: `cd v2 && npm run storybook`
    2. Visit: http://localhost:6006

    **Review each component category:**

    **UI Components (UI/*):**
    - [ ] Button: All 6 variants visible, hard shadow press effect works (click and hold)
    - [ ] Card: Has hard shadow, hover lifts the card slightly
    - [ ] Badge: Clean with border, readable
    - [ ] Input: Hard shadow on focus, proper styling

    **Status Components (Status/*):**
    - [ ] CaseStageBadge: Correct colors for each stage:
          - PWD = Blue (#0066FF)
          - Recruitment = Purple (#9333ea)
          - ETA 9089 = Orange (#D97706)
          - I-140 = Green (#059669)
          - Closed = Gray (#6B7280)
    - [ ] UrgencyIndicator: Red dot PULSES for urgent level
    - [ ] DeadlineIndicator: Shows days, date, and OVERDUE label
    - [ ] ProgressStatusBadge: All 6 statuses have distinct colors

    **Dark Mode:**
    - [ ] Use background toggle in Storybook toolbar (light/dark)
    - [ ] Colors adapt appropriately
    - [ ] Text remains readable

    **Overall Feel:**
    - [ ] Neobrutalist aesthetic: Hard shadows, black borders
    - [ ] Snappy interactions: 150ms transitions feel responsive
    - [ ] Professional/serious tone appropriate for immigration attorneys
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 17, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run storybook` starts without errors
- [ ] All stories render correctly
- [ ] Dark mode toggle works in Storybook
- [ ] Human checkpoint approved
</verification>

<success_criteria>
- Storybook 10 running at localhost:6006
- 8+ story files covering all components
- UI components show neobrutalist styling
- Status components show correct colors
- Urgent indicator pulses
- Dark mode works
- **Human approval received**
</success_criteria>

<output>
After Human Checkpoint approval, create `.planning/phases/17-design-system/17-04-SUMMARY.md`

When Phase 17 complete, update:
- `.planning/STATE.md` - Mark Phase 17 complete
- `.planning/ROADMAP.md` - Update Phase 17 status
</output>
